/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"4.5.1"};if(typeof exports!=="undefined"){exports.fabric=fabric}else{if(typeof define==="function"&&define.amd){define([],function(){return fabric})}}if(typeof document!=="undefined"&&typeof window!=="undefined"){if(document instanceof (typeof HTMLDocument!=="undefined"?HTMLDocument:Document)){fabric.document=document}else{fabric.document=document.implementation.createHTMLDocument("")}fabric.window=window}fabric.isTouchSupported="ontouchstart" in fabric.window||"ontouchstart" in fabric.document||(fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0);fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path",];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";fabric.commaWsp="(?:\\s+,?\\s*|,\\s*)";fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;fabric.reNonWord=/[ \n\.,;!\?\-]/;fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.svgNS="http://www.w3.org/2000/svg";fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.disableStyleCopyPaste=false;fabric.enableGLFiltering=true;fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.arcToSegmentsCache={};fabric.boundsOfCurveCache={};fabric.cachesBoundsOfCurve=true;fabric.forceGLPutImageData=false;fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)){console.log("max texture size: "+fabric.maxTextureSize);return(new fabric.WebglFilterBackend({tileSize:fabric.textureSize}))}else{if(fabric.Canvas2dFilterBackend){return(new fabric.Canvas2dFilterBackend())}}};if(typeof document!=="undefined"&&typeof window!=="undefined"){window.fabric=fabric}(function(){function d(f,g){if(!this.__eventListeners[f]){return}var e=this.__eventListeners[f];if(g){e[e.indexOf(g)]=false}else{fabric.util.array.fill(e,false)}}function a(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function c(e,f){if(!this.__eventListeners){return this}if(arguments.length===0){for(e in this.__eventListeners){d.call(this,e)}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return this}var f=this.__eventListeners[g];if(!f){return this}for(var j=0,e=f.length;j<e;j++){f[j]&&f[j].call(this,h||{})}this.__eventListeners[g]=f.filter(function(i){return i!==false});return this}fabric.Observable={fire:b,on:a,off:c,}})();fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var a=0,b=arguments.length;a<b;a++){this._onObjectAdded(arguments[a])}}this.renderOnAddRemove&&this.requestRenderAll();return this},insertAt:function(b,a,d){var c=this._objects;if(d){c[a]=b}else{c.splice(a,0,b)}this._onObjectAdded&&this._onObjectAdded(b);this.renderOnAddRemove&&this.requestRenderAll();return this},remove:function(){var e=this._objects,b,a=false;for(var c=0,d=arguments.length;c<d;c++){b=e.indexOf(arguments[c]);if(b!==-1){a=true;e.splice(b,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[c])}}this.renderOnAddRemove&&a&&this.requestRenderAll();return this},forEachObject:function(e,c){var d=this.getObjects();for(var b=0,a=d.length;b<a;b++){e.call(c,d[b],b,d)}return this},getObjects:function(a){if(typeof a==="undefined"){return this._objects.concat()}return this._objects.filter(function(b){return b.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(b,a){if(this._objects.indexOf(b)>-1){return true}else{if(a){return this._objects.some(function(c){return typeof c.contains==="function"&&c.contains(b,true)})}}return false},complexity:function(){return this._objects.reduce(function(a,b){a+=b.complexity?b.complexity():0;return a},0)}};fabric.CommonMethods={_setOptions:function(a){for(var b in a){this.set(b,a[b])}},_initGradient:function(a,b){if(a&&a.colorStops&&!(a instanceof fabric.Gradient)){this.set(b,new fabric.Gradient(a))}},_initPattern:function(a,b,c){if(a&&a.source&&!(a instanceof fabric.Pattern)){this.set(b,new fabric.Pattern(a,c))}else{c&&c()}},_setObject:function(a){for(var b in a){this._set(b,a[b])}},set:function(a,b){if(typeof a==="object"){this._setObject(a)}else{this._set(a,b)}return this},_set:function(a,b){this[a]=b},toggle:function(b){var a=this.get(b);if(typeof a==="boolean"){this.set(b,!a)}return this},get:function(a){return this[a]}};(function(e){var f=Math.sqrt,c=Math.atan2,d=Math.pow,a=Math.PI/180,b=Math.PI/2;fabric.util={cos:function(h){if(h===0){return 1}if(h<0){h=-h}var g=h/b;switch(g){case 1:case 3:return 0;case 2:return -1}return Math.cos(h)},sin:function(i){if(i===0){return 0}var g=i/b,h=1;if(i<0){h=-1}switch(g){case 1:return h;case 2:return 0;case 3:return -h}return Math.sin(i)},removeFromArray:function(i,h){var g=i.indexOf(h);if(g!==-1){i.splice(g,1)}return i},getRandomInt:function(h,g){return Math.floor(Math.random()*(g-h+1))+h},degreesToRadians:function(g){return g*a},radiansToDegrees:function(g){return g/a},rotatePoint:function(g,j,k){var h=new fabric.Point(g.x-j.x,g.y-j.y),i=fabric.util.rotateVector(h,k);return new fabric.Point(i.x,i.y).addEquals(j)},rotateVector:function(g,l){var h=fabric.util.sin(l),j=fabric.util.cos(l),k=g.x*j-g.y*h,i=g.x*h+g.y*j;return{x:k,y:i}},transformPoint:function(i,h,g){if(g){return new fabric.Point(h[0]*i.x+h[2]*i.y,h[1]*i.x+h[3]*i.y)}return new fabric.Point(h[0]*i.x+h[2]*i.y+h[4],h[1]*i.x+h[3]*i.y+h[5])},makeBoundingBoxFromPoints:function(q,l){if(l){for(var o=0;o<q.length;o++){q[o]=fabric.util.transformPoint(q[o],l)}}var j=[q[0].x,q[1].x,q[2].x,q[3].x],n=fabric.util.array.min(j),h=fabric.util.array.max(j),k=h-n,p=[q[0].y,q[1].y,q[2].y,q[3].y],m=fabric.util.array.min(p),g=fabric.util.array.max(p),r=g-m;return{left:n,top:m,width:k,height:r}},invertTransform:function(h){var g=1/(h[0]*h[3]-h[1]*h[2]),i=[g*h[3],-g*h[1],-g*h[2],g*h[0]],j=fabric.util.transformPoint({x:h[4],y:h[5]},i,true);i[4]=-j.x;i[5]=-j.y;return i},toFixed:function(h,g){return parseFloat(Number(h).toFixed(g))},parseUnit:function(j,i){var h=/\D{0,2}$/.exec(j),g=parseFloat(j);if(!i){i=fabric.Text.DEFAULT_SVG_FONT_SIZE}switch(h[0]){case"mm":return g*fabric.DPI/25.4;case"cm":return g*fabric.DPI/2.54;case"in":return g*fabric.DPI;case"pt":return g*fabric.DPI/72;case"pc":return g*fabric.DPI/72*12;case"em":return g*i;default:return g}},falseFunction:function(){return false},getKlass:function(h,g){h=fabric.util.string.camelize(h.charAt(0).toUpperCase()+h.slice(1));return fabric.util.resolveNamespace(g)[h]},getSvgAttributes:function(h){var g=["instantiated_by_use","style","id","class"];switch(h){case"linearGradient":g=g.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":g=g.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":g=g.concat(["offset","stop-color","stop-opacity"]);break}return g},resolveNamespace:function(j){if(!j){return fabric}var l=j.split("."),g=l.length,h,k=e||fabric.window;for(h=0;h<g;++h){k=k[l[h]]}return k},loadImage:function(i,l,j,h){if(!i){l&&l.call(j,i);return}var g=fabric.util.createImage();var k=function(){l&&l.call(j,g,false);g=g.onload=g.onerror=null};g.onload=k;g.onerror=function(){fabric.log("Error loading "+g.src);l&&l.call(j,null,true);g=g.onload=g.onerror=null};if(i.indexOf("data")!==0&&h!==undefined&&h!==null){g.crossOrigin=h}if(i.substring(0,14)==="data:image/svg"){g.onload=null;fabric.util.loadImageInDom(g,k)}g.src=i},loadImageInDom:function(g,h){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px";i.style.left=i.style.top="-100%";i.style.position="absolute";i.appendChild(g);fabric.document.querySelector("body").appendChild(i);g.onload=function(){h();i.parentNode.removeChild(i);i=null}},enlivenObjects:function(k,n,i,h){k=k||[];var l=[],m=0,g=k.length;function j(){if(++m===g){n&&n(l.filter(function(o){return o}))}}if(!g){n&&n(l);return}k.forEach(function(r,q){if(!r||!r.type){j();return}var p=fabric.util.getKlass(r.type,i);p.fromObject(r,function(s,o){o||(l[q]=s);h&&h(r,s,o);j()})})},enlivenPatterns:function(h,l){h=h||[];function j(){if(++g===k){l&&l(i)}}var i=[],g=0,k=h.length;if(!k){l&&l(i);return}h.forEach(function(n,m){if(n&&n.source){new fabric.Pattern(n,function(o){i[m]=o;j()})}else{i[m]=n;j()}})},groupSVGElements:function(i,h,j){var g;if(i&&i.length===1){return i[0]}if(h){if(h.width&&h.height){h.centerPoint={x:h.width/2,y:h.height/2}}else{delete h.width;delete h.height}}g=new fabric.Group(i,h);if(typeof j!=="undefined"){g.sourcePath=j}return g},populateWithProperties:function(l,h,k){if(k&&Object.prototype.toString.call(k)==="[object Array]"){for(var j=0,g=k.length;j<g;j++){if(k[j] in l){h[k[j]]=l[k[j]]}}}},drawDashedLine:function(p,n,k,g,l,r){var s=g-n,q=l-k,i=f(s*s+q*q),h=c(q,s),o=r.length,j=0,m=true;p.save();p.translate(n,k);p.moveTo(0,0);p.rotate(h);n=0;while(i>n){n+=r[j++%o];if(n>i){n=i}p[m?"lineTo":"moveTo"](n,0);m=!m}p.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(g){var h=fabric.util.createCanvasElement();h.width=g.width;h.height=g.height;h.getContext("2d").drawImage(g,0,0);return h},toDataURL:function(g,h,i){return g.toDataURL("image/"+h,i)},createImage:function(){return fabric.document.createElement("img")},multiplyTransformMatrices:function(h,g,i){return[h[0]*g[0]+h[2]*g[1],h[1]*g[0]+h[3]*g[1],h[0]*g[2]+h[2]*g[3],h[1]*g[2]+h[3]*g[3],i?0:h[0]*g[4]+h[2]*g[5]+h[4],i?0:h[1]*g[4]+h[3]*g[5]+h[5]]},qrDecompose:function(g){var l=c(g[1],g[0]),i=d(g[0],2)+d(g[1],2),j=f(i),h=(g[0]*g[3]-g[2]*g[1])/j,k=c(g[0]*g[2]+g[1]*g[3],i);return{angle:l/a,scaleX:j,scaleY:h,skewX:k/a,skewY:0,translateX:g[4],translateY:g[5]}},calcRotateMatrix:function(h){if(!h.angle){return fabric.iMatrix.concat()}var i=fabric.util.degreesToRadians(h.angle),j=fabric.util.cos(i),g=fabric.util.sin(i);return[j,g,-g,j,0,0]},calcDimensionsMatrix:function(k){var j=typeof k.scaleX==="undefined"?1:k.scaleX,i=typeof k.scaleY==="undefined"?1:k.scaleY,l=[k.flipX?-j:j,0,0,k.flipY?-i:i,0,0],h=fabric.util.multiplyTransformMatrices,g=fabric.util.degreesToRadians;if(k.skewX){l=h(l,[1,0,Math.tan(g(k.skewX)),1],true)}if(k.skewY){l=h(l,[1,Math.tan(g(k.skewY)),0,1],true)}return l},composeMatrix:function(i){var h=[1,0,0,1,i.translateX||0,i.translateY||0],g=fabric.util.multiplyTransformMatrices;if(i.angle){h=g(h,fabric.util.calcRotateMatrix(i))}if(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY){h=g(h,fabric.util.calcDimensionsMatrix(i))}return h},resetObjectTransform:function(g){g.scaleX=1;g.scaleY=1;g.skewX=0;g.skewY=0;g.flipX=false;g.flipY=false;g.rotate(0)},saveObjectTransform:function(g){return{scaleX:g.scaleX,scaleY:g.scaleY,skewX:g.skewX,skewY:g.skewY,angle:g.angle,left:g.left,flipX:g.flipX,flipY:g.flipY,top:g.top}},isTransparent:function(q,o,n,m){if(m>0){if(o>m){o-=m}else{o=0}if(n>m){n-=m}else{n=0}}var h=true,k,p,g=q.getImageData(o,n,(m*2)||1,(m*2)||1),j=g.data.length;for(k=3;k<j;k+=4){p=g.data[k];h=p<=0;if(h===false){break}}g=null;return h},parsePreserveAspectRatioAttribute:function(j){var k="meet",h="Mid",g="Mid",i=j.split(" "),l;if(i&&i.length){k=i.pop();if(k!=="meet"&&k!=="slice"){l=k;k="meet"}else{if(i.length){l=i.pop()}}}h=l!=="none"?l.slice(1,4):"none";g=l!=="none"?l.slice(5,8):"none";return{meetOrSlice:k,alignX:h,alignY:g}},clearFabricFontCache:function(g){g=(g||"").toLowerCase();if(!g){fabric.charWidthsCache={}}else{if(fabric.charWidthsCache[g]){delete fabric.charWidthsCache[g]}}},limitDimsByArea:function(h,i){var j=Math.sqrt(i*h),g=Math.floor(i/j);return{x:Math.floor(j),y:g}},capValue:function(h,i,g){return Math.max(h,Math.min(i,g))},findScaleToFit:function(h,g){return Math.min(g.width/h.width,g.height/h.height)},findScaleToCover:function(h,g){return Math.max(g.width/h.width,g.height/h.height)},matrixToSVG:function(g){return"matrix("+g.map(function(h){return fabric.util.toFixed(h,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,h){var g=fabric.util.invertTransform(h),j=fabric.util.multiplyTransformMatrices(g,i.calcOwnMatrix());fabric.util.applyTransformToObject(i,j)},addTransformToObject:function(h,g){fabric.util.applyTransformToObject(h,fabric.util.multiplyTransformMatrices(g,h.calcOwnMatrix()))},applyTransformToObject:function(j,i){var h=fabric.util.qrDecompose(i),g=new fabric.Point(h.translateX,h.translateY);j.flipX=false;j.flipY=false;j.set("scaleX",h.scaleX);j.set("scaleY",h.scaleY);j.skewX=h.skewX;j.skewY=h.skewY;j.angle=h.angle;j.setPositionByOrigin(g,"center","center")},sizeAfterTransform:function(m,g,k){var j=m/2,h=g/2,l=[{x:-j,y:-h},{x:j,y:-h},{x:-j,y:h},{x:j,y:h}],i=fabric.util.calcDimensionsMatrix(k),n=fabric.util.makeBoundingBoxFromPoints(l,i);return{x:n.width,y:n.height,}}}})(typeof exports!=="undefined"?exports:this);(function(){fabric.util.createAccessors=function(a){var e=a.prototype,c,f,g,b,d;for(c=e.stateProperties.length;c--;){f=e.stateProperties[c];g=f.charAt(0).toUpperCase()+f.slice(1);b="set"+g;d="get"+g;if(!e[d]){e[d]=(function(h){return new Function('return this.get("'+h+'")')})(f)}if(!e[b]){e[b]=(function(h){return new Function("value",'return this.set("'+h+'", value)')})(f)}}}})(typeof exports!=="undefined"?exports:this);(function(){var h=Array.prototype.join,n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function C(N,L,R,V,I,H,Q,X,J,P,O){var G=fabric.util.cos(N),T=fabric.util.sin(N),F=fabric.util.cos(L),S=fabric.util.sin(L),E=R*I*F-V*H*S+Q,D=V*I*F+R*H*S+X,M=P+J*(-R*I*T-V*H*G),K=O+J*(-V*I*T+R*H*G),W=E+J*(R*I*S+V*H*F),U=D+J*(V*I*S-R*H*F);return["C",M,K,W,U,E,D]}function A(G,E,L,K,D,U,P){var ab=Math.PI,M=P*ab/180,ah=fabric.util.sin(M),aa=fabric.util.cos(M),V=0,S=0;L=Math.abs(L);K=Math.abs(K);var Z=-aa*G*0.5-ah*E*0.5,W=-aa*E*0.5+ah*G*0.5,ai=L*L,J=K*K,F=W*W,ae=Z*Z,ag=ai*J-ai*F-J*ae,ad=0;if(ag<0){var T=Math.sqrt(1-ag/(ai*J));L*=T;K*=T}else{ad=(D===U?-1:1)*Math.sqrt(ag/(ai*F+J*ae))}var I=ad*L*W/K,H=-ad*K*Z/L,Y=aa*I-ah*H+G*0.5,aj=ah*I+aa*H+E*0.5,ak=e(1,0,(Z-I)/L,(W-H)/K),X=e((Z-I)/L,(W-H)/K,(-Z-I)/L,(-W-H)/K);if(U===0&&X>0){X-=2*ab}else{if(U===1&&X<0){X+=2*ab}}var ac=Math.ceil(Math.abs(X/ab*2)),O=[],R=X/ac,N=8/3*Math.sin(R/4)*Math.sin(R/4)/Math.sin(R/2),Q=ak+R;for(var af=0;af<ac;af++){O[af]=C(ak,Q,aa,ah,L,K,Y,aj,N,V,S);V=O[af][5];S=O[af][6];ak=Q;Q+=R}return O}function e(G,F,I,H){var E=Math.atan2(F,G),D=Math.atan2(H,I);if(D>=E){return D-E}else{return 2*Math.PI-(E-D)}}function a(ab,H,aa,F,Z,E,Y,D){var ag;if(fabric.cachesBoundsOfCurve){ag=h.call(arguments);if(fabric.boundsOfCurveCache[ag]){return fabric.boundsOfCurveCache[ag]}}var af=Math.sqrt,U=Math.min,X=Math.max,R=Math.abs,S=[],I=[[],[]],ae,ad,ac,P,N,L,G,J;ad=6*ab-12*aa+6*Z;ae=-3*ab+9*aa-9*Z+3*Y;ac=3*aa-3*ab;for(var W=0;W<2;++W){if(W>0){ad=6*H-12*F+6*E;ae=-3*H+9*F-9*E+3*D;ac=3*F-3*H}if(R(ae)<1e-12){if(R(ad)<1e-12){continue}P=-ac/ad;if(0<P&&P<1){S.push(P)}continue}G=ad*ad-4*ac*ae;if(G<0){continue}J=af(G);N=(-ad+J)/(2*ae);if(0<N&&N<1){S.push(N)}L=(-ad-J)/(2*ae);if(0<L&&L<1){S.push(L)}}var M,K,V=S.length,Q=V,T;while(V--){P=S[V];T=1-P;M=(T*T*T*ab)+(3*T*T*P*aa)+(3*T*P*P*Z)+(P*P*P*Y);I[0][V]=M;K=(T*T*T*H)+(3*T*T*P*F)+(3*T*P*P*E)+(P*P*P*D);I[1][V]=K}I[0][Q]=ab;I[1][Q]=H;I[0][Q+1]=Y;I[1][Q+1]=D;var O=[{x:U.apply(null,I[0]),y:U.apply(null,I[1])},{x:X.apply(null,I[0]),y:X.apply(null,I[1])}];if(fabric.cachesBoundsOfCurve){fabric.boundsOfCurveCache[ag]=O}return O}function x(I,H,N){var F=N[1],D=N[2],G=N[3],O=N[4],P=N[5],L=N[6],J=N[7],E=A(L-I,J-H,F,D,O,P,G);for(var K=0,M=E.length;K<M;K++){E[K][1]+=I;E[K][2]+=H;E[K][3]+=I;E[K][4]+=H;E[K][5]+=I;E[K][6]+=H}return E}function v(P){var L=0,J=0,H=P.length,E=0,K=0,I,F,N,M=[],G,D,O;for(F=0;F<H;++F){N=false;I=P[F].slice(0);switch(I[0]){case"l":I[0]="L";I[1]+=L;I[2]+=J;case"L":L=I[1];J=I[2];break;case"h":I[1]+=L;case"H":I[0]="L";I[2]=J;L=I[1];break;case"v":I[1]+=J;case"V":I[0]="L";J=I[1];I[1]=L;I[2]=J;break;case"m":I[0]="M";I[1]+=L;I[2]+=J;case"M":L=I[1];J=I[2];E=I[1];K=I[2];break;case"c":I[0]="C";I[1]+=L;I[2]+=J;I[3]+=L;I[4]+=J;I[5]+=L;I[6]+=J;case"C":D=I[3];O=I[4];L=I[5];J=I[6];break;case"s":I[0]="S";I[1]+=L;I[2]+=J;I[3]+=L;I[4]+=J;case"S":if(G==="C"){D=2*L-D;O=2*J-O}else{D=L;O=J}L=I[3];J=I[4];I[0]="C";I[5]=I[3];I[6]=I[4];I[3]=I[1];I[4]=I[2];I[1]=D;I[2]=O;D=I[3];O=I[4];break;case"q":I[0]="Q";I[1]+=L;I[2]+=J;I[3]+=L;I[4]+=J;case"Q":D=I[1];O=I[2];L=I[3];J=I[4];break;case"t":I[0]="T";I[1]+=L;I[2]+=J;case"T":if(G==="Q"){D=2*L-D;O=2*J-O}else{D=L;O=J}I[0]="Q";L=I[1];J=I[2];I[1]=D;I[2]=O;I[3]=L;I[4]=J;break;case"a":I[0]="A";I[6]+=L;I[7]+=J;case"A":N=true;M=M.concat(x(L,J,I));L=I[6];J=I[7];break;case"z":case"Z":L=E;J=K;break;default:}if(!N){M.push(I)}G=I[0]}return M}function d(E,G,D,F){return Math.sqrt((D-E)*(D-E)+(F-G)*(F-G))}function s(D){return D*D*D}function r(D){return 3*D*D*(1-D)}function q(D){return 3*D*(1-D)*(1-D)}function p(D){return(1-D)*(1-D)*(1-D)}function i(E,D,G,F,I,H,K,J){return function(P){var O=s(P),N=r(P),M=q(P),L=p(P);return{x:K*O+I*N+G*M+E*L,y:J*O+H*N+F*M+D*L}}}function w(E,D,G,F,I,H,K,J){return function(N){var L=1-N,O=(3*L*L*(G-E))+(6*L*N*(I-G))+(3*N*N*(K-I)),M=(3*L*L*(F-D))+(6*L*N*(H-F))+(3*N*N*(J-H));return Math.atan2(M,O)}}function k(D){return D*D}function g(D){return 2*D*(1-D)}function c(D){return(1-D)*(1-D)}function b(E,D,G,F,I,H){return function(M){var L=k(M),K=g(M),J=c(M);return{x:I*L+G*K+E*J,y:H*L+F*K+D*J}}}function l(E,D,G,F,I,H){return function(L){var J=1-L,M=(2*J*(G-E))+(2*L*(I-G)),K=(2*J*(F-D))+(2*L*(H-F));return Math.atan2(K,M)}}function t(I,F,H){var D={x:F,y:H},J,E=0,G;for(G=0.01;G<=1;G+=0.01){J=I(G);E+=d(D.x,D.y,J.x,J.y);D=J}return E}function B(N,E){var L=0,J=0,I=N.iterator,M={x:N.x,y:N.y},F,H,G=0.01,D=N.angleFinder,K;while(J<E&&L<=1&&G>0.0001){F=I(L);K=L;H=d(M.x,M.y,F.x,F.y);if((H+J)>E){G/=2;L-=G}else{M=F;L+=G;J+=H}}F.angle=D(K);return F}function f(P){var O=0,K=P.length,L,F=0,N=0,E=0,M=0,G=[],J,H,D;for(var I=0;I<K;I++){L=P[I];H={x:F,y:N,command:L[0],};switch(L[0]){case"M":H.length=0;E=F=L[1];M=N=L[2];break;case"L":H.length=d(F,N,L[1],L[2]);F=L[1];N=L[2];break;case"C":J=i(F,N,L[1],L[2],L[3],L[4],L[5],L[6]);D=w(F,N,L[1],L[2],L[3],L[4],L[5],L[6]);H.iterator=J;H.angleFinder=D;H.length=t(J,F,N);F=L[5];N=L[6];break;case"Q":J=b(F,N,L[1],L[2],L[3],L[4]);D=l(F,N,L[1],L[2],L[3],L[4]);H.iterator=J;H.angleFinder=D;H.length=t(J,F,N);F=L[3];N=L[4];break;case"Z":case"z":H.destX=E;H.destY=M;H.length=d(F,N,E,M);F=E;N=M;break}O+=H.length;G.push(H)}G.push({length:O,x:F,y:N});return G}function z(L,D,I){if(!I){I=f(L)}var G=0;while((D-I[G].length>0)&&G<(I.length-2)){D-=I[G].length;G++}var K=I[G],J=D/K.length,F=K.command,H=L[G],E;switch(F){case"M":return{x:K.x,y:K.y,angle:0};case"Z":case"z":E=new fabric.Point(K.x,K.y).lerp(new fabric.Point(K.destX,K.destY),J);E.angle=Math.atan2(K.destY-K.y,K.destX-K.x);return E;case"L":E=new fabric.Point(K.x,K.y).lerp(new fabric.Point(H[1],H[2]),J);E.angle=Math.atan2(H[2]-K.y,H[1]-K.x);return E;case"C":return B(K,D);case"Q":return B(K,D)}}function y(R){var N=[],W=[],F,M,S=fabric.rePathCommand,I="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",G="("+I+")"+fabric.commaWsp,Q="([01])"+fabric.commaWsp+"?",Z=G+"?"+G+"?"+G+Q+Q+G+"?("+I+")",D=new RegExp(Z,"g"),L,J,P;if(!R||!R.match){return N}P=R.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var X=0,ab,Y=P.length;X<Y;X++){F=P[X];J=F.slice(1).trim();W.length=0;var K=F.charAt(0);ab=[K];if(K.toLowerCase()==="a"){for(var H;(H=D.exec(J));){for(var V=1;V<H.length;V++){W.push(H[V])}}}else{while((L=S.exec(J))){W.push(L[0])}}for(var V=0,O=W.length;V<O;V++){M=parseFloat(W[V]);if(!isNaN(M)){ab.push(M)}}var aa=n[K.toLowerCase()],E=u[K]||K;if(ab.length-1>aa){for(var U=1,T=ab.length;U<T;U+=aa){N.push([K].concat(ab.slice(U,U+aa)));K=E}}else{N.push(ab)}}return N}function j(K,H){var N=[],E,L=new fabric.Point(K[0].x,K[0].y),J=new fabric.Point(K[1].x,K[1].y),F=K.length,D=1,M=0,G=F>2;H=H||0;if(G){D=K[2].x<J.x?-1:K[2].x===J.x?0:1;M=K[2].y<J.y?-1:K[2].y===J.y?0:1}N.push(["M",L.x-D*H,L.y-M*H]);for(E=1;E<F;E++){if(!L.eq(J)){var I=L.midPointFrom(J);N.push(["Q",L.x,L.y,I.x,I.y])}L=K[E];if((E+1)<K.length){J=K[E+1]}}if(G){D=L.x>K[E-2].x?1:L.x===K[E-2].x?0:-1;M=L.y>K[E-2].y?1:L.y===K[E-2].y?0:-1}N.push(["L",L.x+D*H,L.y+M*H]);return N}function o(J,I,G,E,H,R,S,N,L){var Q=0,P=0,K,D=[],F=A(N-J,L-I,G,E,R,S,H);for(var M=0,O=F.length;M<O;M++){K=a(Q,P,F[M][1],F[M][2],F[M][3],F[M][4],F[M][5],F[M][6]);D.push({x:K[0].x+J,y:K[0].y+I});D.push({x:K[1].x+J,y:K[1].y+I});Q=F[M][5];P=F[M][6]}return D}function m(D,G,F,H){H=H.slice(0).unshift("X");var E=x(G,F,H);E.forEach(function(I){D.bezierCurveTo.apply(D,I.slice(1))})}fabric.util.parsePath=y;fabric.util.makePathSimpler=v;fabric.util.getSmoothPathFromPoints=j;fabric.util.getPathSegmentsInfo=f;fabric.util.fromArcToBeziers=x;fabric.util.fromArcToBeizers=x;fabric.util.getBoundsOfCurve=a;fabric.util.getPointOnPath=z;fabric.util.getBoundsOfArc=o;fabric.util.drawArc=m})();(function(){var f=Array.prototype.slice;function b(m,l){var j=f.call(arguments,2),h=[];for(var k=0,g=m.length;k<g;k++){h[k]=j.length?m[k][l].apply(m[k],j):m[k][l].call(m[k])}return h}function a(h,g){return e(h,g,function(j,i){return j>=i})}function c(h,g){return e(h,g,function(j,i){return j<i})}function d(i,h){var g=i.length;while(g--){i[g]=h}return i}function e(l,j,k){if(!l||l.length===0){return}var h=l.length-1,g=j?l[h][j]:l[h];if(j){while(h--){if(k(l[h][j],g)){g=l[h][j]}}}else{while(h--){if(k(l[h],g)){g=l[h]}}}return g}fabric.util.array={fill:d,invoke:b,min:c,max:a}})();(function(){function b(d,h,e){if(e){if(!fabric.isLikelyNode&&h instanceof Element){d=h}else{if(h instanceof Array){d=[];for(var f=0,c=h.length;f<c;f++){d[f]=b({},h[f],e)}}else{if(h&&typeof h==="object"){for(var g in h){if(g==="canvas"||g==="group"){d[g]=null}else{if(h.hasOwnProperty(g)){d[g]=b({},h[g],e)}}}}else{d=h}}}}else{for(var g in h){d[g]=h[g]}}return d}function a(d,c){return b({},d,c)}fabric.util.object={extend:b,clone:a};fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function b(f){return f.replace(/-+(.)?/g,function(g,h){return h?h.toUpperCase():""})}function d(f,g){return f.charAt(0).toUpperCase()+(g?f.slice(1):f.slice(1).toLowerCase())}function a(f){return f.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(h){var g=0,j,f=[];for(g=0,j;g<h.length;g++){if((j=e(h,g))===false){continue}f.push(j)}return f}function e(k,f){var j=k.charCodeAt(f);if(isNaN(j)){return""}if(j<55296||j>57343){return k.charAt(f)}if(55296<=j&&j<=56319){if(k.length<=(f+1)){throw"High surrogate without following low surrogate"}var g=k.charCodeAt(f+1);if(56320>g||g>57343){throw"High surrogate without following low surrogate"}return k.charAt(f)+k.charAt(f+1)}if(f===0){throw"Low surrogate without preceding high surrogate"}var h=k.charCodeAt(f-1);if(55296>h||h>56319){throw"Low surrogate without preceding high surrogate"}return false}fabric.util.string={camelize:b,capitalize:d,escapeXml:a,graphemeSplit:c}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=null,k=this;while(k.constructor.superclass){var j=k.constructor.superclass.prototype[h];if(k[h]!==j){i=j;break}k=k.constructor.superclass.prototype}if(!i){return console.log("tried to callSuper "+h+", method not found in prototype chain",this)}return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}fabric.util.createClass=e})();(function(){var c=!!fabric.document.createElement("div").attachEvent,b=["touchstart","touchmove","touchend"];fabric.util.addListener=function(f,d,g,e){f&&f.addEventListener(d,g,c?false:e)};fabric.util.removeListener=function(f,d,g,e){f&&f.removeEventListener(d,g,c?false:e)};function a(d){var e=d.changedTouches;if(e&&e[0]){return e[0]}return d}fabric.util.getPointer=function(g){var f=g.target,d=fabric.util.getScrollLeftTop(f),e=a(g);return{x:e.clientX+d.left,y:e.clientY+d.top}};fabric.util.isTouchEvent=function(d){return b.indexOf(d.type)>-1||d.pointerType==="touch"}})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var m=Array.prototype.slice;function l(o){return typeof o==="string"?fabric.document.getElementById(o):o}var n,e=function(o){return m.call(o,0)};try{n=e(fabric.document.childNodes) instanceof Array}catch(d){}if(!n){e=function(p){var o=new Array(p.length),q=p.length;while(q--){o[q]=p[q]}return o}}function f(p,o){var q=fabric.document.createElement(p);for(var r in o){if(r==="class"){q.className=o[r]}else{if(r==="for"){q.htmlFor=o[r]}else{q.setAttribute(r,o[r])}}}return q}function j(o,p){if(o&&(" "+o.className+" ").indexOf(" "+p+" ")===-1){o.className+=(o.className?" ":"")+p}}function i(p,q,o){if(typeof q==="string"){q=f(q,o)}if(p.parentNode){p.parentNode.replaceChild(q,p)}q.appendChild(p);return q}function a(q){var s=0,r=0,p=fabric.document.documentElement,o=fabric.document.body||{scrollLeft:0,scrollTop:0};while(q&&(q.parentNode||q.host)){q=q.parentNode||q.host;if(q===fabric.document){s=o.scrollLeft||p.scrollLeft||0;r=o.scrollTop||p.scrollTop||0}else{s+=q.scrollLeft||0;r+=q.scrollTop||0}if(q.nodeType===1&&q.style.position==="fixed"){break}}return{left:s,top:r}}function h(r){var p,u=r&&r.ownerDocument,s={left:0,top:0},v={left:0,top:0},t,q={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!u){return v}for(var o in q){v[q[o]]+=parseInt(g(r,o),10)||0}p=u.documentElement;if(typeof r.getBoundingClientRect!=="undefined"){s=r.getBoundingClientRect()}t=a(r);return{left:s.left+t.left-(p.clientLeft||0)+v.left,top:s.top+t.top-(p.clientTop||0)+v.top}}var g;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){g=function(p,o){var q=fabric.document.defaultView.getComputedStyle(p,null);return q?q[o]:undefined}}else{g=function(p,o){var q=p.style[o];if(!q&&p.currentStyle){q=p.currentStyle[o]}return q}}(function(){var p=fabric.document.documentElement.style,q="userSelect" in p?"userSelect":"MozUserSelect" in p?"MozUserSelect":"WebkitUserSelect" in p?"WebkitUserSelect":"KhtmlUserSelect" in p?"KhtmlUserSelect":"";function r(s){if(typeof s.onselectstart!=="undefined"){s.onselectstart=fabric.util.falseFunction}if(q){s.style[q]="none"}else{if(typeof s.unselectable==="string"){s.unselectable="on"}}return s}function o(s){if(typeof s.onselectstart!=="undefined"){s.onselectstart=null}if(q){s.style[q]=""}else{if(typeof s.unselectable==="string"){s.unselectable=""}}return s}fabric.util.makeElementUnselectable=r;fabric.util.makeElementSelectable=o})();function k(p){var o=fabric.jsdomImplForWrapper(p);return o._canvas||o._image}function c(p){if(!fabric.isLikelyNode){return}var o=fabric.jsdomImplForWrapper(p);if(o){o._image=null;o._canvas=null;o._currentSrc=null;o._attributes=null;o._classList=null}}function b(o,p){o.imageSmoothingEnabled=o.imageSmoothingEnabled||o.webkitImageSmoothingEnabled||o.mozImageSmoothingEnabled||o.msImageSmoothingEnabled||o.oImageSmoothingEnabled;o.imageSmoothingEnabled=p}fabric.util.setImageSmoothing=b;fabric.util.getById=l;fabric.util.toArray=e;fabric.util.addClass=j;fabric.util.makeElement=f;fabric.util.wrapElement=i;fabric.util.getScrollLeftTop=a;fabric.util.getElementOffset=h;fabric.util.getNodeCanvas=k;fabric.util.cleanUpJsdomNode=c})();(function(){function c(d,e){return d+(/\?/.test(d)?"&":"?")+e}function a(){}function b(f,e){e||(e={});var i=e.method?e.method.toUpperCase():"GET",g=e.onComplete||function(){},h=new fabric.window.XMLHttpRequest(),d=e.body||e.parameters;h.onreadystatechange=function(){if(h.readyState===4){g(h);h.onreadystatechange=a}};if(i==="GET"){d=null;if(typeof e.parameters==="string"){f=c(f,e.parameters)}}h.open(i,f,true);if(i==="POST"||i==="PUT"){h.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}h.send(d);return h}fabric.util.request=b})();fabric.log=console.log;fabric.warn=console.warn;(function(){function f(){return false}function g(i,h,k,j){return -k*Math.cos(i/j*(Math.PI/2))+k+h}function b(h){c(function(p){h||(h={});var j=p||+new Date(),m=h.duration||500,t=j+m,k,q=h.onChange||f,n=h.abort||f,l=h.onComplete||f,r=h.easing||g,i="startValue" in h?h.startValue:0,s="endValue" in h?h.endValue:100,u=h.byValue||s-i;h.onStart&&h.onStart();(function o(v){k=v||+new Date();var x=k>t?m:(k-j),w=x/m,y=r(x,i,u,m),z=Math.abs((y-i)/u);if(n()){l(s,1,1);return}if(k>t){q(s,1,1);l(s,1,1);return}else{q(y,z,w);c(o)}})(j)})}var d=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(h){return fabric.window.setTimeout(h,1000/60)};var e=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function c(){return d.apply(fabric.window,arguments)}function a(){return e.apply(fabric.window,arguments)}fabric.util.animate=b;fabric.util.requestAnimFrame=c;fabric.util.cancelAnimFrame=a})();(function(){function a(e,c,f){var d="rgba("+parseInt((e[0]+f*(c[0]-e[0])),10)+","+parseInt((e[1]+f*(c[1]-e[1])),10)+","+parseInt((e[2]+f*(c[2]-e[2])),10);d+=","+(e&&c?parseFloat(e[3]+f*(c[3]-e[3])):1);d+=")";return d}function b(e,h,j,d){var i=new fabric.Color(e).getSource(),f=new fabric.Color(h).getSource(),c=d.onComplete,g=d.onChange;d=d||{};fabric.util.animate(fabric.util.object.extend(d,{duration:j||500,startValue:i,endValue:f,byValue:f,easing:function(l,k,n,o){var m=d.colorEasing?d.colorEasing(l,o):1-Math.cos(l/o*(Math.PI/2));return a(k,n,m)},onComplete:function(l,m,k){if(c){return c(a(f,f,0),m,k)}},onChange:function(l,m,k){if(g){if(Array.isArray(l)){return g(a(l,l,0),m,k)}g(l,m,k)}}}))}fabric.util.animateColor=b})();(function(){function y(C,F,E,D){if(C<Math.abs(F)){C=F;D=E/4}else{if(F===0&&C===0){D=E/(2*Math.PI)*Math.asin(1)}else{D=E/(2*Math.PI)*Math.asin(F/C)}}return{a:C,c:F,p:E,s:D}}function p(D,C,E){return D.a*Math.pow(2,10*(C-=1))*Math.sin((C*E-D.s)*(2*Math.PI)/D.p)}function o(D,C,F,E){return F*((D=D/E-1)*D*D+1)+C}function s(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D+C}return F/2*((D-=2)*D*D+2)+C}function r(D,C,F,E){return F*(D/=E)*D*D*D+C}function f(D,C,F,E){return -F*((D=D/E-1)*D*D*D-1)+C}function j(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D+C}return -F/2*((D-=2)*D*D*D-2)+C}function w(D,C,F,E){return F*(D/=E)*D*D*D*D+C}function i(D,C,F,E){return F*((D=D/E-1)*D*D*D*D+1)+C}function l(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D*D+C}return F/2*((D-=2)*D*D*D*D+2)+C}function e(D,C,F,E){return -F*Math.cos(D/E*(Math.PI/2))+F+C}function m(D,C,F,E){return F*Math.sin(D/E*(Math.PI/2))+C}function t(D,C,F,E){return -F/2*(Math.cos(Math.PI*D/E)-1)+C}function B(D,C,F,E){return(D===0)?C:F*Math.pow(2,10*(D/E-1))+C}function c(D,C,F,E){return(D===E)?C+F:F*(-Math.pow(2,-10*D/E)+1)+C}function h(D,C,F,E){if(D===0){return C}if(D===E){return C+F}D/=E/2;if(D<1){return F/2*Math.pow(2,10*(D-1))+C}return F/2*(-Math.pow(2,-10*--D)+2)+C}function g(D,C,F,E){return -F*(Math.sqrt(1-(D/=E)*D)-1)+C}function n(D,C,F,E){return F*Math.sqrt(1-(D=D/E-1)*D)+C}function v(D,C,F,E){D/=E/2;if(D<1){return -F/2*(Math.sqrt(1-D*D)-1)+C}return F/2*(Math.sqrt(1-(D-=2)*D)+1)+C}function q(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return -p(G,E,I)+C}function x(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return G.a*Math.pow(2,-10*E)*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)+G.c+C}function a(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I/2;if(E===2){return C+J}if(!H){H=I*(0.3*1.5)}var G=y(D,J,H,F);if(E<1){return -0.5*p(G,E,I)+C}return G.a*Math.pow(2,-10*(E-=1))*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)*0.5+G.c+C}function k(D,C,G,F,E){if(E===undefined){E=1.70158}return G*(D/=F)*D*((E+1)*D-E)+C}function u(D,C,G,F,E){if(E===undefined){E=1.70158}return G*((D=D/F-1)*D*((E+1)*D+E)+1)+C}function z(D,C,G,F,E){if(E===undefined){E=1.70158}D/=F/2;if(D<1){return G/2*(D*D*(((E*=(1.525))+1)*D-E))+C}return G/2*((D-=2)*D*(((E*=(1.525))+1)*D+E)+2)+C}function d(D,C,F,E){return F-b(E-D,0,F,E)+C}function b(D,C,F,E){if((D/=E)<(1/2.75)){return F*(7.5625*D*D)+C}else{if(D<(2/2.75)){return F*(7.5625*(D-=(1.5/2.75))*D+0.75)+C}else{if(D<(2.5/2.75)){return F*(7.5625*(D-=(2.25/2.75))*D+0.9375)+C}else{return F*(7.5625*(D-=(2.625/2.75))*D+0.984375)+C}}}}function A(D,C,F,E){if(D<E/2){return d(D*2,0,F,E)*0.5+C}return b(D*2-E,0,F,E)*0.5+F*0.5+C}fabric.util.ease={easeInQuad:function(D,C,F,E){return F*(D/=E)*D+C},easeOutQuad:function(D,C,F,E){return -F*(D/=E)*(D-2)+C},easeInOutQuad:function(D,C,F,E){D/=(E/2);if(D<1){return F/2*D*D+C}return -F/2*((--D)*(D-2)-1)+C},easeInCubic:function(D,C,F,E){return F*(D/=E)*D*D+C},easeOutCubic:o,easeInOutCubic:s,easeInQuart:r,easeOutQuart:f,easeInOutQuart:j,easeInQuint:w,easeOutQuint:i,easeInOutQuint:l,easeInSine:e,easeOutSine:m,easeInOutSine:t,easeInExpo:B,easeOutExpo:c,easeInOutExpo:h,easeInCirc:g,easeOutCirc:n,easeInOutCirc:v,easeInElastic:q,easeOutElastic:x,easeInOutElastic:a,easeInBack:k,easeOutBack:u,easeInOutBack:z,easeInBounce:d,easeOutBounce:b,easeInOutBounce:A}})();(function(v){var q=v.fabric||(v.fabric={}),C=q.util.object.extend,E=q.util.object.clone,p=q.util.toFixed,s=q.util.parseUnit,y=q.util.multiplyTransformMatrices,e=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],G=["symbol","image","marker","pattern","view","svg"],g=["pattern","defs","symbol","metadata","clipPath","mask","desc"],D=["symbol","g","a","svg","clipPath","defs"],z={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing",},i={stroke:"strokeOpacity",fill:"fillOpacity"},A="font-size",F="clip-path";q.svgValidTagNamesRegEx=h(e);q.svgViewBoxElementsRegEx=h(G);q.svgInvalidAncestorsRegEx=h(g);q.svgValidParentsRegEx=h(D);q.cssRules={};q.gradientDefs={};q.clipPaths={};function b(H){if(H in z){return z[H]}return H}function k(I,N,L,M){var J=Object.prototype.toString.call(N)==="[object Array]",K;if((I==="fill"||I==="stroke")&&N==="none"){N=""}else{if(I==="strokeUniform"){return(N==="non-scaling-stroke")}else{if(I==="strokeDashArray"){if(N==="none"){N=null}else{N=N.replace(/,/g," ").split(/\s+/).map(parseFloat)}}else{if(I==="transformMatrix"){if(L&&L.transformMatrix){N=y(L.transformMatrix,q.parseTransformAttribute(N))}else{N=q.parseTransformAttribute(N)}}else{if(I==="visible"){N=N!=="none"&&N!=="hidden";if(L&&L.visible===false){N=false}}else{if(I==="opacity"){N=parseFloat(N);if(L&&typeof L.opacity!=="undefined"){N*=L.opacity}}else{if(I==="textAnchor"){N=N==="start"?"left":N==="end"?"right":"center"}else{if(I==="charSpacing"){K=s(N,M)/M*1000}else{if(I==="paintFirst"){var H=N.indexOf("fill");var O=N.indexOf("stroke");var N="fill";if(H>-1&&O>-1&&O<H){N="stroke"}else{if(H===-1&&O>-1){N="stroke"}}}else{if(I==="href"||I==="xlink:href"||I==="font"){return N}else{if(I==="imageSmoothing"){return(N==="optimizeQuality")}else{K=J?N.map(s):s(N,M)}}}}}}}}}}}return(!J&&isNaN(K)?N:K)}function h(H){return new RegExp("^("+H.join("|")+")\\b","i")}function d(J){for(var H in i){if(typeof J[i[H]]==="undefined"||J[H]===""){continue}if(typeof J[H]==="undefined"){if(!q.Object.prototype[H]){continue}J[H]=q.Object.prototype[H]}if(J[H].indexOf("url(")===0){continue}var I=new q.Color(J[H]);J[H]=I.setAlpha(p(I.getAlpha()*J[i[H]],2)).toRgba()}return J}function u(M,K){var N,L=[],I,J,H;for(J=0,H=K.length;J<H;J++){N=K[J];I=M.getElementsByTagName(N);L=L.concat(Array.prototype.slice.call(I))}return L}q.parseTransformAttribute=(function(){function H(ab,ac){var ad=q.util.cos(ac[0]),aa=q.util.sin(ac[0]),Z=0,ae=0;if(ac.length===3){Z=ac[1];ae=ac[2]}ab[0]=ad;ab[1]=aa;ab[2]=-aa;ab[3]=ad;ab[4]=Z-(ad*Z-aa*ae);ab[5]=ae-(aa*Z+ad*ae)}function K(ab,ac){var aa=ac[0],Z=(ac.length===2)?ac[1]:ac[0];ab[0]=aa;ab[3]=Z}function X(Z,aa,ab){Z[ab]=Math.tan(q.util.degreesToRadians(aa[0]))}function S(Z,aa){Z[4]=aa[0];if(aa.length===2){Z[5]=aa[1]}}var M=q.iMatrix,I=q.reNum,U=q.commaWsp,N="(?:(skewX)\\s*\\(\\s*("+I+")\\s*\\))",L="(?:(skewY)\\s*\\(\\s*("+I+")\\s*\\))",V="(?:(rotate)\\s*\\(\\s*("+I+")(?:"+U+"("+I+")"+U+"("+I+"))?\\s*\\))",Y="(?:(scale)\\s*\\(\\s*("+I+")(?:"+U+"("+I+"))?\\s*\\))",Q="(?:(translate)\\s*\\(\\s*("+I+")(?:"+U+"("+I+"))?\\s*\\))",T="(?:(matrix)\\s*\\(\\s*("+I+")"+U+"("+I+")"+U+"("+I+")"+U+"("+I+")"+U+"("+I+")"+U+"("+I+")\\s*\\))",R="(?:"+T+"|"+Q+"|"+Y+"|"+V+"|"+N+"|"+L+")",O="(?:"+R+"(?:"+U+"*"+R+")*)",W="^\\s*(?:"+O+"?)\\s*$",P=new RegExp(W),J=new RegExp(R,"g");return function(ac){var Z=M.concat(),aa=[];if(!ac||(ac&&!P.test(ac))){return Z}ac.replace(J,function(ag){var ad=new RegExp(R).exec(ag).filter(function(ah){return(!!ah)}),ae=ad[1],af=ad.slice(2).map(parseFloat);switch(ae){case"translate":S(Z,af);break;case"rotate":af[0]=q.util.degreesToRadians(af[0]);H(Z,af);break;case"scale":K(Z,af);break;case"skewX":X(Z,af,2);break;case"skewY":X(Z,af,1);break;case"matrix":Z=af;break}aa.push(Z.concat());Z=M.concat()});var ab=aa[0];while(aa.length>1){aa.shift();ab=q.util.multiplyTransformMatrices(ab,aa[0])}return ab}})();function r(J,I){var H,K;J.replace(/;\s*$/,"").split(";").forEach(function(L){var M=L.split(":");H=M[0].trim().toLowerCase();K=M[1].trim();I[H]=K})}function o(J,I){var H,K;for(var L in J){if(typeof J[L]==="undefined"){continue}H=L.toLowerCase();K=J[L];I[H]=K}}function B(I,H){var J={};for(var L in q.cssRules[H]){if(x(I,L.split(" "))){for(var K in q.cssRules[H][L]){J[K]=q.cssRules[H][L][K]}}}return J}function x(J,I){var H,K=true;H=m(J,I.pop());if(H&&I.length){K=n(J,I)}return H&&K&&(I.length===0)}function n(J,I){var H,K=true;while(J.parentNode&&J.parentNode.nodeType===1&&I.length){if(K){H=I.pop()}J=J.parentNode;K=m(J,H)}return I.length===0}function m(J,H){var N=J.nodeName,L=J.getAttribute("class"),M=J.getAttribute("id"),K,I;K=new RegExp("^"+N,"i");H=H.replace(K,"");if(M&&H.length){K=new RegExp("#"+M+"(?![a-zA-Z\\-]+)","i");H=H.replace(K,"")}if(L&&H.length){L=L.split(" ");for(I=L.length;I--;){K=new RegExp("\\."+L[I]+"(?![a-zA-Z\\-]+)","i");H=H.replace(K,"")}}return H.length===0}function t(M,N){var J;M.getElementById&&(J=M.getElementById(N));if(J){return J}var L,I,H,K=M.getElementsByTagName("*");for(I=0,H=K.length;I<H;I++){L=K[I];if(N===L.getAttribute("id")){return L}}}function f(X){var P=u(X,["use","svg:use"]),T=0;while(P.length&&T<P.length){var H=P[T],V=H.getAttribute("xlink:href")||H.getAttribute("href");if(V===null){return}var J=V.substr(1),L=H.getAttribute("x")||0,K=H.getAttribute("y")||0,O=t(X,J).cloneNode(true),W=(O.getAttribute("transform")||"")+" translate("+L+", "+K+")",I,Y=P.length,R,S,Q,U,M=q.svgNS;j(O);if(/^svg$/i.test(O.nodeName)){var N=O.ownerDocument.createElementNS(M,"g");for(S=0,Q=O.attributes,U=Q.length;S<U;S++){R=Q.item(S);N.setAttributeNS(M,R.nodeName,R.nodeValue)}while(O.firstChild){N.appendChild(O.firstChild)}O=N}for(S=0,Q=H.attributes,U=Q.length;S<U;S++){R=Q.item(S);if(R.nodeName==="x"||R.nodeName==="y"||R.nodeName==="xlink:href"||R.nodeName==="href"){continue}if(R.nodeName==="transform"){W=R.nodeValue+" "+W}else{O.setAttribute(R.nodeName,R.nodeValue)}}O.setAttribute("transform",W);O.setAttribute("instantiated_by_use","1");O.removeAttribute("id");I=H.parentNode;I.replaceChild(O,H);if(P.length===Y){T++}}}var l=new RegExp("^\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*$");function j(I){if(!q.svgViewBoxElementsRegEx.test(I.nodeName)){return{}}var J=I.getAttribute("viewBox"),ab=1,Z=1,aa=0,Y=0,M,T,W,H,S=I.getAttribute("width"),U=I.getAttribute("height"),N=I.getAttribute("x")||0,L=I.getAttribute("y")||0,P=I.getAttribute("preserveAspectRatio")||"",ac=(!J||!(J=J.match(l))),R=(!S||!U||S==="100%"||U==="100%"),V=ac&&R,X={},Q="",K=0,O=0;X.width=0;X.height=0;X.toBeParsed=V;if(ac){if(((N||L)&&I.parentNode&&I.parentNode.nodeName!=="#document")){Q=" translate("+s(N)+" "+s(L)+") ";W=(I.getAttribute("transform")||"")+Q;I.setAttribute("transform",W);I.removeAttribute("x");I.removeAttribute("y")}}if(V){return X}if(ac){X.width=s(S);X.height=s(U);return X}aa=-parseFloat(J[1]);Y=-parseFloat(J[2]);M=parseFloat(J[3]);T=parseFloat(J[4]);X.minX=aa;X.minY=Y;X.viewBoxWidth=M;X.viewBoxHeight=T;if(!R){X.width=s(S);X.height=s(U);ab=X.width/M;Z=X.height/T}else{X.width=M;X.height=T}P=q.util.parsePreserveAspectRatioAttribute(P);if(P.alignX!=="none"){if(P.meetOrSlice==="meet"){Z=ab=(ab>Z?Z:ab)}if(P.meetOrSlice==="slice"){Z=ab=(ab>Z?ab:Z)}K=X.width-M*ab;O=X.height-T*ab;if(P.alignX==="Mid"){K/=2}if(P.alignY==="Mid"){O/=2}if(P.alignX==="Min"){K=0}if(P.alignY==="Min"){O=0}}if(ab===1&&Z===1&&aa===0&&Y===0&&N===0&&L===0){return X}if((N||L)&&I.parentNode.nodeName!=="#document"){Q=" translate("+s(N)+" "+s(L)+") "}W=Q+" matrix("+ab+" 0 0 "+Z+" "+(aa*ab+K)+" "+(Y*Z+O)+") ";if(I.nodeName==="svg"){H=I.ownerDocument.createElementNS(q.svgNS,"g");while(I.firstChild){H.appendChild(I.firstChild)}I.appendChild(H)}else{H=I;H.removeAttribute("x");H.removeAttribute("y");W=H.getAttribute("transform")+W}H.setAttribute("transform",W);return X}function a(H,I){while(H&&(H=H.parentNode)){if(H.nodeName&&I.test(H.nodeName.replace("svg:",""))&&!H.getAttribute("instantiated_by_use")){return true}}return false}q.parseSVGDocument=function(Q,R,O,J){if(!Q){return}f(Q);var P=q.Object.__uid++,K,M,S=j(Q),I=q.util.toArray(Q.getElementsByTagName("*"));S.crossOrigin=J&&J.crossOrigin;S.svgUid=P;if(I.length===0&&q.isLikelyNode){I=Q.selectNodes('//*[name(.)!="svg"]');var L=[];for(K=0,M=I.length;K<M;K++){L[K]=I[K]}I=L}var H=I.filter(function(T){j(T);return q.svgValidTagNamesRegEx.test(T.nodeName.replace("svg:",""))&&!a(T,q.svgInvalidAncestorsRegEx)});if(!H||(H&&!H.length)){R&&R([],{});return}var N={};I.filter(function(T){return T.nodeName.replace("svg:","")==="clipPath"}).forEach(function(T){var U=T.getAttribute("id");N[U]=q.util.toArray(T.getElementsByTagName("*")).filter(function(V){return q.svgValidTagNamesRegEx.test(V.nodeName.replace("svg:",""))})});q.gradientDefs[P]=q.getGradientDefs(Q);q.cssRules[P]=q.getCSSRules(Q);q.clipPaths[P]=N;q.parseElements(H,function(U,T){if(R){R(U,S,T,I);delete q.gradientDefs[P];delete q.cssRules[P];delete q.clipPaths[P]}},E(S),O,J)};function w(N,M){var I=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],J="xlink:href",L=M.getAttribute(J).substr(1),K=t(N,L);if(K&&K.getAttribute(J)){w(N,K)}I.forEach(function(O){if(K&&!M.hasAttribute(O)&&K.hasAttribute(O)){M.setAttribute(O,K.getAttribute(O))}});if(!M.children.length){var H=K.cloneNode(true);while(H.firstChild){M.appendChild(H.firstChild)}}M.removeAttribute(J)}var c=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+q.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+q.reNum+"))?\\s+(.*)");C(q,{parseFontDeclaration:function(N,I){var K=N.match(c);if(!K){return}var O=K[1],J=K[3],M=K[4],L=K[5],H=K[6];if(O){I.fontStyle=O}if(J){I.fontWeight=isNaN(parseFloat(J))?J:parseFloat(J)}if(M){I.fontSize=s(M)}if(H){I.fontFamily=H}if(L){I.lineHeight=L==="normal"?1:L}},getGradientDefs:function(M){var H=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],J=u(M,H),K,I=0,L={};I=J.length;while(I--){K=J[I];if(K.getAttribute("xlink:href")){w(M,K)}L[K.getAttribute("id")]=K}return L},parseAttributes:function(L,J,O){if(!L){return}var Q,K={},U,I;if(typeof O==="undefined"){O=L.getAttribute("svgUid")}if(L.parentNode&&q.svgValidParentsRegEx.test(L.parentNode.nodeName)){K=q.parseAttributes(L.parentNode,J,O)}var T=J.reduce(function(W,V){Q=L.getAttribute(V);if(Q){W[V]=Q}return W},{});var M=C(B(L,O),q.parseStyleAttribute(L));T=C(T,M);if(M[F]){L.setAttribute(F,M[F])}U=I=K.fontSize||q.Text.DEFAULT_SVG_FONT_SIZE;if(T[A]){T[A]=U=s(T[A],I)}var R,P,H={};for(var N in T){R=b(N);P=k(R,T[N],K,U);H[R]=P}if(H&&H.font){q.parseFontDeclaration(H.font,H)}var S=C(K,H);return q.svgValidParentsRegEx.test(L.nodeName)?S:d(S)},parseElements:function(K,L,I,H,J){new q.ElementsParser(K,L,I,H,J).parse()},parseStyleAttribute:function(I){var H={},J=I.getAttribute("style");if(!J){return H}if(typeof J==="string"){r(J,H)}else{o(J,H)}return H},parsePointsAttribute:function(K){if(!K){return null}K=K.replace(/,/g," ").trim();K=K.split(/\s+/);var I=[],J,H;for(J=0,H=K.length;J<H;J+=2){I.push({x:parseFloat(K[J]),y:parseFloat(K[J+1])})}return I},getCSSRules:function(M){var K=M.getElementsByTagName("style"),J,H,I={},N;for(J=0,H=K.length;J<H;J++){var L=K[J].textContent;L=L.replace(/\/\*[\s\S]*?\*\//g,"");if(L.trim()===""){continue}N=L.match(/[^{]*\{[\s\S]*?\}/g);N=N.map(function(O){return O.trim()});N.forEach(function(T){var O=T.match(/([\s\S]*?)\s*\{([^}]*)\}/),P={},V=O[2].trim(),S=V.replace(/;$/,"").split(/\s*;\s*/);for(J=0,H=S.length;J<H;J++){var U=S[J].split(/\s*:\s*/),R=U[0],Q=U[1];P[R]=Q}T=O[1];T.split(",").forEach(function(W){W=W.replace(/^svg/i,"").trim();if(W===""){return}if(I[W]){q.util.object.extend(I[W],P)}else{I[W]=q.util.object.clone(P)}})})}return I},loadSVGFromURL:function(J,L,H,I){J=J.replace(/^\n\s*/,"").trim();new q.util.request(J,{method:"get",onComplete:K});function K(N){var M=N.responseXML;if(!M||!M.documentElement){L&&L(null);return false}q.parseSVGDocument(M.documentElement,function(P,O,R,Q){L&&L(P,O,R,Q)},H,I)}},loadSVGFromString:function(J,M,H,I){var L=new q.window.DOMParser(),K=L.parseFromString(J.trim(),"text/xml");q.parseSVGDocument(K.documentElement,function(O,N,Q,P){M(O,N,Q,P)},H,I)}})})(typeof exports!=="undefined"?exports:this);fabric.ElementsParser=function(d,f,b,a,c,e){this.elements=d;this.callback=f;this.options=b;this.reviver=a;this.svgUid=(b&&b.svgUid)||0;this.parsingOptions=c;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g;this.doc=e};(function(a){a.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};a.createObjects=function(){var b=this;this.elements.forEach(function(d,c){d.setAttribute("svgUid",b.svgUid);b.createObject(d,c)})};a.findTag=function(b){return fabric[fabric.util.string.capitalize(b.tagName.replace("svg:",""))]};a.createObject=function(d,c){var b=this.findTag(d);if(b&&b.fromElement){try{b.fromElement(d,this.createCallback(c,d),this.options)}catch(e){fabric.log(e)}}else{this.checkIfDone()}};a.createCallback=function(b,c){var d=this;return function(f){var e;d.resolveGradient(f,c,"fill");d.resolveGradient(f,c,"stroke");if(f instanceof fabric.Image&&f._originalElement){e=f.parsePreserveAspectRatioAttribute(c)}f._removeTransformMatrix(e);d.resolveClipPath(f,c);d.reviver&&d.reviver(c,f);d.instances[b]=f;d.checkIfDone()}};a.extractPropertyDefinition=function(e,d,g){var c=e[d],b=this.regexUrl;if(!b.test(c)){return}b.lastIndex=0;var f=b.exec(c)[1];b.lastIndex=0;return fabric[g][this.svgUid][f]};a.resolveGradient=function(f,b,c){var e=this.extractPropertyDefinition(f,c,"gradientDefs");if(e){var g=b.getAttribute(c+"-opacity");var d=fabric.Gradient.fromElement(e,f,g,this.options);f.set(c,d)}};a.createClipPathCallback=function(c,b){return function(d){d._removeTransformMatrix();d.fillRule=d.clipRule;b.push(d)}};a.resolveClipPath=function(e,k){var j=this.extractPropertyDefinition(e,"clipPath","clipPaths"),f,h,b,c,g,n;if(j){c=[];b=fabric.util.invertTransform(e.calcTransformMatrix());var l=j[0].parentNode;var m=k;while(m.parentNode&&m.getAttribute("clip-path")!==e.clipPath){m=m.parentNode}m.parentNode.appendChild(l);for(var d=0;d<j.length;d++){f=j[d];h=this.findTag(f);h.fromElement(f,this.createClipPathCallback(e,c),this.options)}if(c.length===1){j=c[0]}else{j=new fabric.Group(c)}g=fabric.util.multiplyTransformMatrices(b,j.calcTransformMatrix());if(j.clipPath){this.resolveClipPath(j,m)}var n=fabric.util.qrDecompose(g);j.flipX=false;j.flipY=false;j.set("scaleX",n.scaleX);j.set("scaleY",n.scaleY);j.angle=n.angle;j.skewX=n.skewX;j.skewY=0;j.setPositionByOrigin({x:n.translateX,y:n.translateY},"center","center");e.clipPath=j}else{delete e.clipPath}};a.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(b){return b!=null});this.callback(this.instances,this.elements)}}})(fabric.ElementsParser.prototype);(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){this.x=d;this.y=e}a.prototype={type:"point",constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){if(typeof d==="undefined"){d=0.5}d=Math.max(Math.min(1,d),0);return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return this.lerp(d)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e;return this},setX:function(d){this.x=d;return this},setY:function(d){this.y=d;return this},setFromPoint:function(d){this.x=d.x;this.y=d.y;return this},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f},clone:function(){return new a(this.x,this.y)}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){this.status=d;this.points=[]}b.Intersection=c;b.Intersection.prototype={constructor:c,appendPoint:function(d){this.points.push(d);return this},appendPoints:function(d){this.points=this.points.concat(d);return this}};b.Intersection.intersectLineLine=function(h,g,l,k){var m,e=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(g.x-h.x)*(h.y-l.y)-(g.y-h.y)*(h.x-l.x),i=(k.y-l.y)*(g.x-h.x)-(k.x-l.x)*(g.y-h.y);if(i!==0){var f=e/i,d=j/i;if(0<=f&&f<=1&&0<=d&&d<=1){m=new c("Intersection");m.appendPoint(new b.Point(h.x+f*(g.x-h.x),h.y+f*(g.y-h.y)))}else{m=new c()}}else{if(e===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c(),f=l.length,k,j,g,h;for(h=0;h<f;h++){k=l[h];j=l[(h+1)%f];g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c(),l=j.length,k;for(k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c();o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Color){c.warn("fabric.Color is already defined.");return}function d(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}c.Color=d;c.Color.prototype={_tryParsingColor:function(e){var f;if(e in d.colorNameMap){e=d.colorNameMap[e]}if(e==="transparent"){f=[255,255,255,0]}if(!f){f=d.sourceFromHex(e)}if(!f){f=d.sourceFromRgb(e)}if(!f){f=d.sourceFromHsl(e)}if(!f){f=[0,0,0,1]}if(f){this.setSource(f)}},_rgbToHsl:function(e,k,n){e/=255;k/=255;n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);f=(o+i)/2;if(o===i){j=p=0}else{var m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break}j/=6}return[Math.round(j*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var i=this.getSource(),h,f,e;h=i[0].toString(16);h=(h.length===1)?("0"+h):h;f=i[1].toString(16);f=(f.length===1)?("0"+f):f;e=i[2].toString(16);e=(e.length===1)?("0"+e):e;return h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},toHexa:function(){var f=this.getSource(),e;e=Math.round(f[3]*255);e=e.toString(16);e=(e.length===1)?("0"+e):e;return this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();e[3]=f;this.setSource(e);return this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),e=g[3];this.setSource([f,f,f,e]);return this},toBlackWhite:function(e){var h=this.getSource(),g=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0),f=h[3];e=e||127;g=(Number(g)<Number(e))?0:255;this.setSource([g,g,g,f]);return this},overlayWith:function(l){if(!(l instanceof d)){l=new d(l)}var e=[],k=this.getAlpha(),h=0.5,j=this.getSource(),f=l.getSource(),g;for(g=0;g<3;g++){e.push(Math.round((j[g]*(1-h))+(f[g]*h)))}e[3]=k;this.setSource(e);return this}};c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i;c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i;c.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;c.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function a(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g}c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))};c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}};c.Color.fromRgba=d.fromRgb;c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))};c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(!n){return}var m=(((parseFloat(n[1])%360)+360)%360)/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1),e,o,t;if(u===0){e=o=t=j}else{var f=j<=0.5?j*(u+1):j+u-j*u,i=j*2-f;e=a(i,f,m+1/3);o=a(i,f,m);t=a(i,f,m-1/3)}return[Math.round(e*255),Math.round(o*255),Math.round(t*255),n[4]?parseFloat(n[4]):1]};c.Color.fromHsla=d.fromHsl;c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))};c.Color.sourceFromHex=function(i){if(i.match(d.reHex)){var m=i.slice(i.indexOf("#")+1),f=(m.length===3||m.length===4),j=(m.length===8||m.length===4),l=f?(m.charAt(0)+m.charAt(0)):m.substring(0,2),k=f?(m.charAt(1)+m.charAt(1)):m.substring(2,4),e=f?(m.charAt(2)+m.charAt(2)):m.substring(4,6),h=j?(f?(m.charAt(3)+m.charAt(3)):m.substring(6,8)):"FF";return[parseInt(l,16),parseInt(k,16),parseInt(e,16),parseFloat((parseInt(h,16)/255).toFixed(2))]}};c.Color.fromSource=function(e){var f=new d();f.setSource(e);return f}})(typeof exports!=="undefined"?exports:this);(function(a){var K=a.fabric||(a.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],O=["ns","nesw","ew","nwse"],y={},w="left",E="top",N="right",B="bottom",A="center",x={top:B,bottom:E,left:N,right:w,center:A,},e=K.util.radiansToDegrees,o=(Math.sign||function(Q){return((Q>0)-(Q<0))||+Q});function G(S,R){var Q=S.angle+e(Math.atan2(R.y,R.x))+360;return Math.round((Q%360)/45)}function J(R,T){var U=T.transform.target,S=U.canvas,Q=K.util.object.clone(T);Q.target=U;S&&S.fire("object:"+R,Q);U.fire(R,T)}function t(S,U){var Q=U.canvas,R=Q.uniScaleKey,T=S[R];return(Q.uniformScaling&&!T)||(!Q.uniformScaling&&T)}function j(Q){return Q.originX===A&&Q.originY===A}function D(S,R,T){var Q=S.lockScalingX,U=S.lockScalingY;if(Q&&U){return true}if(!R&&(Q||U)&&T){return true}if(Q&&R==="x"){return true}if(U&&R==="y"){return true}return false}function n(R,U,T){var Q="not-allowed",V=t(R,T),S="";if(U.x!==0&&U.y===0){S="x"}else{if(U.x===0&&U.y!==0){S="y"}}if(D(T,S,V)){return Q}var W=G(T,U);return u[W]+"-resize"}function b(R,T,S){var Q="not-allowed";if(T.x!==0&&S.lockSkewingY){return Q}if(T.y!==0&&S.lockSkewingX){return Q}var U=G(S,T)%4;return O[U]+"-resize"}function i(Q,S,R){if(Q[R.canvas.altActionKey]){return y.skewCursorStyleHandler(Q,S,R)}return y.scaleCursorStyleHandler(Q,S,R)}function f(R,T,S){var Q=R[S.canvas.altActionKey];if(T.x===0){return Q?"skewX":"scaleY"}if(T.y===0){return Q?"skewY":"scaleX"}}function q(Q,S,R){if(R.lockRotation){return"not-allowed"}return S.cursorStyle}function F(S,R,Q,T){return{e:S,transform:R,pointer:{x:Q,y:T,}}}function d(Q){return function(T,S,R,Y){var V=S.target,X=V.getCenterPoint(),U=V.translateToOriginPoint(X,S.originX,S.originY),W=Q(T,S,R,Y);V.setPositionByOrigin(U,S.originX,S.originY);return W}}function r(Q,R){return function(U,T,S,W){var V=R(U,T,S,W);if(V){J(Q,F(U,T,S,W))}return V}}function v(Q,Z,W,V,T){var S=Q.target,R=S.controls[Q.corner],Y=S.canvas.getZoom(),U=S.padding/Y,X=S.toLocalPoint(new K.Point(V,T),Z,W);if(X.x>=U){X.x-=U}if(X.x<=-U){X.x+=U}if(X.y>=U){X.y-=U}if(X.y<=U){X.y+=U}X.x-=R.offsetX;X.y-=R.offsetY;return X}function C(Q){return Q.flipX!==Q.flipY}function P(W,U,S,T,Q){if(W[U]!==0){var R=W._getTransformedDimensions()[T];var V=Q/R*W[S];W.set(S,V)}}function I(aa,S,X,W){var U=S.target,R=U._getTransformedDimensions(0,U.skewY),ab=v(S,S.originX,S.originY,X,W),Z=Math.abs(ab.x*2)-R.x,Y=U.skewX,T;if(Z<2){T=0}else{T=e(Math.atan2((Z/U.scaleX),(R.y/U.scaleY)));if(S.originX===w&&S.originY===B){T=-T}if(S.originX===N&&S.originY===E){T=-T}if(C(U)){T=-T}}var Q=Y!==T;if(Q){var V=U._getTransformedDimensions().y;U.set("skewX",T);P(U,"skewY","scaleY","y",V)}return Q}function H(aa,S,X,W){var U=S.target,R=U._getTransformedDimensions(U.skewX,0),ab=v(S,S.originX,S.originY,X,W),Z=Math.abs(ab.y*2)-R.y,Y=U.skewY,T;if(Z<2){T=0}else{T=e(Math.atan2((Z/U.scaleY),(R.x/U.scaleX)));if(S.originX===w&&S.originY===B){T=-T}if(S.originX===N&&S.originY===E){T=-T}if(C(U)){T=-T}}var Q=Y!==T;if(Q){var V=U._getTransformedDimensions().x;U.set("skewY",T);P(U,"skewX","scaleX","x",V)}return Q}function h(X,R,V,U){var S=R.target,W=S.skewX,Z,Y=R.originY;if(S.lockSkewingX){return false}if(W===0){var T=v(R,A,A,V,U);if(T.x>0){Z=w}else{Z=N}}else{if(W>0){Z=Y===E?w:N}if(W<0){Z=Y===E?N:w}if(C(S)){Z=Z===w?N:w}}R.originX=Z;var Q=r("skewing",d(I));return Q(X,R,V,U)}function g(X,R,V,U){var S=R.target,W=S.skewY,Y,Z=R.originX;if(S.lockSkewingY){return false}if(W===0){var T=v(R,A,A,V,U);if(T.y>0){Y=E}else{Y=B}}else{if(W>0){Y=Z===w?E:B}if(W<0){Y=Z===w?B:E}if(C(S)){Y=Y===E?B:E}}R.originY=Y;var Q=r("skewing",d(H));return Q(X,R,V,U)}function z(ab,S,Z,Y){var ad=S,W=ad.target,X=W.translateToOriginPoint(W.getCenterPoint(),ad.originX,ad.originY);if(W.lockRotation){return false}var T=Math.atan2(ad.ey-X.y,ad.ex-X.x),aa=Math.atan2(Y-X.y,Z-X.x),U=e(aa-T+ad.theta),ac=true;if(W.snapAngle>0){var R=W.snapAngle,V=W.snapThreshold||R,Q=Math.ceil(U/R)*R,ae=Math.floor(U/R)*R;if(Math.abs(U-ae)<V){U=ae}else{if(Math.abs(U-Q)<V){U=Q}}}if(U<0){U=360+U}U%=360;ac=W.angle!==U;W.angle=U;return ac}function c(W,ab,Y,X,V){V=V||{};var an=ab.target,aa=an.lockScalingX,Z=an.lockScalingY,aj=V.by,ac,al,ak,ai,ad=t(W,an),Q=D(an,aj,ad),T,S,ae=ab.gestureScale;if(Q){return false}if(ae){al=ab.scaleX*ae;ak=ab.scaleY*ae}else{ac=v(ab,ab.originX,ab.originY,Y,X);T=aj!=="y"?o(ac.x):1;S=aj!=="x"?o(ac.y):1;if(!ab.signX){ab.signX=T}if(!ab.signY){ab.signY=S}if(an.lockScalingFlip&&(ab.signX!==T||ab.signY!==S)){return false}ai=an._getTransformedDimensions();if(ad&&!aj){var U=Math.abs(ac.x)+Math.abs(ac.y),ag=ab.original,R=Math.abs(ai.x*ag.scaleX/an.scaleX)+Math.abs(ai.y*ag.scaleY/an.scaleY),am=U/R;al=ag.scaleX*am;ak=ag.scaleY*am}else{al=Math.abs(ac.x*an.scaleX/ai.x);ak=Math.abs(ac.y*an.scaleY/ai.y)}if(j(ab)){al*=2;ak*=2}if(ab.signX!==T&&aj!=="y"){ab.originX=x[ab.originX];al*=-1;ab.signX=T}if(ab.signY!==S&&aj!=="x"){ab.originY=x[ab.originY];ak*=-1;ab.signY=S}}var ah=an.scaleX,af=an.scaleY;if(!aj){!aa&&an.set("scaleX",al);!Z&&an.set("scaleY",ak)}else{aj==="x"&&an.set("scaleX",al);aj==="y"&&an.set("scaleY",ak)}return ah!==an.scaleX||af!==an.scaleY}function p(S,R,Q,T){return c(S,R,Q,T)}function m(S,R,Q,T){return c(S,R,Q,T,{by:"x"})}function k(S,R,Q,T){return c(S,R,Q,T,{by:"y"})}function L(S,R,Q,T){if(S[R.target.canvas.altActionKey]){return y.skewHandlerX(S,R,Q,T)}return y.scalingY(S,R,Q,T)}function s(S,R,Q,T){if(S[R.target.canvas.altActionKey]){return y.skewHandlerY(S,R,Q,T)}return y.scalingX(S,R,Q,T)}function M(X,R,W,V){var U=R.target,Z=v(R,R.originX,R.originY,W,V),Q=U.strokeWidth/(U.strokeUniform?U.scaleX:1),Y=j(R)?2:1,S=U.width,T=Math.abs(Z.x*Y/U.scaleX)-Q;U.set("width",Math.max(T,0));return S!==T}function l(Y,R,W,V){var T=R.target,X=W-R.offsetX,U=V-R.offsetY,S=!T.get("lockMovementX")&&T.left!==X,Q=!T.get("lockMovementY")&&T.top!==U;S&&T.set("left",X);Q&&T.set("top",U);if(S||Q){J("moving",F(Y,R,W,V))}return S||Q}y.scaleCursorStyleHandler=n;y.skewCursorStyleHandler=b;y.scaleSkewCursorStyleHandler=i;y.rotationWithSnapping=r("rotating",d(z));y.scalingEqually=r("scaling",d(p));y.scalingX=r("scaling",d(m));y.scalingY=r("scaling",d(k));y.scalingYOrSkewingX=L;y.scalingXOrSkewingY=s;y.changeWidth=r("resizing",d(M));y.skewHandlerX=h;y.skewHandlerY=g;y.dragHandler=l;y.scaleOrSkewActionName=f;y.rotationStyleHandler=q;y.fireEvent=J;y.wrapWithFixedAnchor=d;y.wrapWithFireEvent=r;y.getLocalPoint=v;K.controlsUtils=y})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),b=d.util.degreesToRadians,a=d.controlsUtils;function e(r,g,k,m,o){m=m||{};var p=this.sizeX||m.cornerSize||o.cornerSize,n=this.sizeY||m.cornerSize||o.cornerSize,h=typeof m.transparentCorners!=="undefined"?m.transparentCorners:o.transparentCorners,l=h?"stroke":"fill",q=!h&&(m.cornerStrokeColor||o.cornerStrokeColor),i=g,j=k,s;r.save();r.fillStyle=m.cornerColor||o.cornerColor;r.strokeStyle=m.cornerStrokeColor||o.cornerStrokeColor;if(p>n){s=p;r.scale(1,n/p);j=k*p/n}else{if(n>p){s=n;r.scale(p/n,1);i=g*n/p}else{s=p}}r.lineWidth=1;r.beginPath();r.arc(i,j,s/2,0,2*Math.PI,false);r[l]();if(q){r.stroke()}r.restore()}function f(r,g,j,l,o){l=l||{};var p=this.sizeX||l.cornerSize||o.cornerSize,m=this.sizeY||l.cornerSize||o.cornerSize,h=typeof l.transparentCorners!=="undefined"?l.transparentCorners:o.transparentCorners,k=h?"stroke":"fill",q=!h&&(l.cornerStrokeColor||o.cornerStrokeColor),n=p/2,i=m/2;r.save();r.fillStyle=l.cornerColor||o.cornerColor;r.strokeStyle=l.cornerStrokeColor||o.cornerStrokeColor;r.lineWidth=1;r.translate(g,j);r.rotate(b(o.angle));r[k+"Rect"](-n,-i,p,m);if(q){r.strokeRect(-n,-i,p,m)}r.restore()}a.renderCircleControl=e;a.renderSquareControl=f})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});function a(d){for(var e in d){this[e]=d[e]}}c.Control=a;c.Control.prototype={visible:true,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:false,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(d,e){return e.cursorStyle},getActionName:function(d,e){return e.actionName},getVisibility:function(f,e){var d=f._controlsVisibility;if(d&&typeof d[e]!=="undefined"){return d[e]}return this.visible},setVisibility:function(d){this.visible=d},positionHandler:function(f,e){var d=c.util.transformPoint({x:this.x*f.x+this.offsetX,y:this.y*f.y+this.offsetY},e);return d},calcCornerCoords:function(i,g,l,h,j){var s,e,q,o,r=(j)?this.touchSizeX:this.sizeX,p=(j)?this.touchSizeY:this.sizeY;if(r&&p&&r!==p){var n=Math.atan2(p,r);var d=Math.sqrt(r*r+p*p)/2;var m=n-c.util.degreesToRadians(i);var k=Math.PI/2-n-c.util.degreesToRadians(i);s=d*c.util.cos(m);e=d*c.util.sin(m);q=d*c.util.cos(k);o=d*c.util.sin(k)}else{var f=(r&&p)?r:g;d=f*0.7071067812;var m=c.util.degreesToRadians(45-i);s=q=d*c.util.cos(m);e=o=d*c.util.sin(m)}return{tl:{x:l-o,y:h-q,},tr:{x:l+s,y:h-e,},bl:{x:l-s,y:h+e,},br:{x:l+o,y:h+q,},}},render:function(d,h,g,e,f){e=e||{};switch(e.cornerStyle||f.cornerStyle){case"circle":c.controlsUtils.renderCircleControl.call(this,d,h,g,e,f);break;default:c.controlsUtils.renderSquareControl.call(this,d,h,g,e,f)}},}})(typeof exports!=="undefined"?exports:this);(function(){function d(g,r){var f=g.getAttribute("style"),j=g.getAttribute("offset")||0,h,n,m,k;j=parseFloat(j)/(/%$/.test(j)?100:1);j=j<0?0:j>1?1:j;if(f){var l=f.split(/\s*;\s*/);if(l[l.length-1]===""){l.pop()}for(k=l.length;k--;){var o=l[k].split(/\s*:\s*/),q=o[0].trim(),p=o[1].trim();if(q==="stop-color"){h=p}else{if(q==="stop-opacity"){m=p}}}}if(!h){h=g.getAttribute("stop-color")||"rgb(0,0,0)"}if(!m){m=g.getAttribute("stop-opacity")}h=new fabric.Color(h);n=h.getAlpha();m=isNaN(parseFloat(m))?1:parseFloat(m);m*=n*r;return{offset:j,color:h.toRgb(),opacity:m}}function b(f){return{x1:f.getAttribute("x1")||0,y1:f.getAttribute("y1")||0,x2:f.getAttribute("x2")||"100%",y2:f.getAttribute("y2")||0}}function c(f){return{x1:f.getAttribute("fx")||f.getAttribute("cx")||"50%",y1:f.getAttribute("fy")||f.getAttribute("cy")||"50%",r1:0,x2:f.getAttribute("cx")||"50%",y2:f.getAttribute("cy")||"50%",r2:f.getAttribute("r")||"50%"}}var e=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(f){f||(f={});f.coords||(f.coords={});var g,h=this;Object.keys(f).forEach(function(i){h[i]=f[i]});if(this.id){this.id+="_"+fabric.Object.__uid++}else{this.id=fabric.Object.__uid++}g={x1:f.coords.x1||0,y1:f.coords.y1||0,x2:f.coords.x2||0,y2:f.coords.y2||0};if(this.type==="radial"){g.r1=f.coords.r1||0;g.r2=f.coords.r2||0}this.coords=g;this.colorStops=f.colorStops.slice()},addColorStop:function(h){for(var f in h){var g=new fabric.Color(h[f]);this.colorStops.push({offset:parseFloat(f),color:g.toRgb(),opacity:g.getAlpha()})}return this},toObject:function(g){var f={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,f,g);return f},toSVG:function(x,f){var q=e(this.coords,true),r,s,f=f||{},t,g,h=e(this.colorStops,true),u=q.r1>q.r2,p=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),w=-this.offsetX,v=-this.offsetY,l=!!f.additionalTransform,o=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";h.sort(function(y,i){return y.offset-i.offset});if(o==="objectBoundingBox"){w/=x.width;v/=x.height}else{w+=x.width/2;v+=x.height/2}if(x.type==="path"&&this.gradientUnits!=="percentage"){w-=x.pathOffset.x;v-=x.pathOffset.y}p[4]-=w;p[5]-=v;g='id="SVGID_'+this.id+'" gradientUnits="'+o+'"';g+=' gradientTransform="'+(l?f.additionalTransform+" ":"")+fabric.util.matrixToSVG(p)+'" ';if(this.type==="linear"){t=["<linearGradient ",g,' x1="',q.x1,'" y1="',q.y1,'" x2="',q.x2,'" y2="',q.y2,'">\n']}else{if(this.type==="radial"){t=["<radialGradient ",g,' cx="',u?q.x1:q.x2,'" cy="',u?q.y1:q.y2,'" r="',u?q.r1:q.r2,'" fx="',u?q.x2:q.x1,'" fy="',u?q.y2:q.y1,'">\n']}}if(this.type==="radial"){if(u){h=h.concat();h.reverse();for(r=0,s=h.length;r<s;r++){h[r].offset=1-h[r].offset}}var k=Math.min(q.r1,q.r2);if(k>0){var j=Math.max(q.r1,q.r2),m=k/j;for(r=0,s=h.length;r<s;r++){h[r].offset+=m*(1-h[r].offset)}}}for(r=0,s=h.length;r<s;r++){var n=h[r];t.push("<stop ",'offset="',(n.offset*100)+"%",'" style="stop-color:',n.color,(typeof n.opacity!=="undefined"?";stop-opacity: "+n.opacity:";"),'"/>\n')}t.push((this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n"));return t.join("")},toLive:function(g){var m,l=fabric.util.object.clone(this.coords),k,f;if(!this.type){return}if(this.type==="linear"){m=g.createLinearGradient(l.x1,l.y1,l.x2,l.y2)}else{if(this.type==="radial"){m=g.createRadialGradient(l.x1,l.y1,l.r1,l.x2,l.y2,l.r2)}}for(k=0,f=this.colorStops.length;k<f;k++){var h=this.colorStops[k].color,j=this.colorStops[k].opacity,n=this.colorStops[k].offset;if(typeof j!=="undefined"){h=new fabric.Color(h).setAlpha(j).toRgba()}m.addColorStop(n,h)}return m}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(j,u,g,l){var v=parseFloat(g)/(/%$/.test(g)?100:1);v=v<0?0:v>1?1:v;if(isNaN(v)){v=1}var t=j.getElementsByTagName("stop"),q,k=j.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",f=j.getAttribute("gradientTransform")||"",h=[],s,o,p=0,n=0,m;if(j.nodeName==="linearGradient"||j.nodeName==="LINEARGRADIENT"){q="linear";s=b(j)}else{q="radial";s=c(j)}for(o=t.length;o--;){h.push(d(t[o],v))}m=fabric.parseTransformAttribute(f);a(u,s,l,k);if(k==="pixels"){p=-u.left;n=-u.top}var r=new fabric.Gradient({id:j.getAttribute("id"),type:q,coords:s,colorStops:h,gradientUnits:k,gradientTransform:m,offsetX:p,offsetY:n,});return r}});function a(f,h,i,g){var k,j;Object.keys(h).forEach(function(l){k=h[l];if(k==="Infinity"){j=1}else{if(k==="-Infinity"){j=0}else{j=parseFloat(h[l],10);if(typeof k==="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(k)){j*=0.01;if(g==="pixels"){if(l==="x1"||l==="x2"||l==="r2"){j*=i.viewBoxWidth||i.width}if(l==="y1"||l==="y2"){j*=i.viewBoxHeight||i.height}}}}}h[l]=j})}})();(function(){var a=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(b,d){b||(b={});this.id=fabric.Object.__uid++;this.setOptions(b);if(!b.source||(b.source&&typeof b.source!=="string")){d&&d(this);return}else{var c=this;this.source=fabric.util.createImage();fabric.util.loadImage(b.source,function(e,f){c.source=e;d&&d(c,f)},null,this.crossOrigin)}},toObject:function(e){var c=fabric.Object.NUM_FRACTION_DIGITS,d,b;if(typeof this.source.src==="string"){d=this.source.src}else{if(typeof this.source==="object"&&this.source.toDataURL){d=this.source.toDataURL()}}b={type:"pattern",source:d,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:a(this.offsetX,c),offsetY:a(this.offsetY,c),patternTransform:this.patternTransform?this.patternTransform.concat():null};fabric.util.populateWithProperties(this,b,e);return b},toSVG:function(c){var b=typeof this.source==="function"?this.source():this.source,g=b.width/c.width,e=b.height/c.height,f=this.offsetX/c.width,d=this.offsetY/c.height,h="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat"){e=1;if(d){e+=Math.abs(d)}}if(this.repeat==="repeat-y"||this.repeat==="no-repeat"){g=1;if(f){g+=Math.abs(f)}}if(b.src){h=b.src}else{if(b.toDataURL){h=b.toDataURL()}}return'<pattern id="SVGID_'+this.id+'" x="'+f+'" y="'+d+'" width="'+g+'" height="'+e+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+h+'"></image>\n</pattern>\n'},setOptions:function(b){for(var c in b){this[c]=b[c]}},toLive:function(b){var c=this.source;if(!c){return""}if(typeof c.src!=="undefined"){if(!c.complete){return""}if(c.naturalWidth===0||c.naturalHeight===0){return""}}return b.createPattern(c,this.repeat)}})})();(function(b){var c=b.fabric||(b.fabric={}),a=c.util.toFixed;if(c.Shadow){c.warn("fabric.Shadow is already defined.");return}c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,nonScaling:false,initialize:function(d){if(typeof d==="string"){d=this._parseShadow(d)}for(var e in d){this[e]=d[e]}this.id=c.Object.__uid++},_parseShadow:function(g){var f=g.trim(),e=c.Shadow.reOffsetsAndBlur.exec(f)||[],d=f.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:d.trim(),offsetX:parseFloat(e[1],10)||0,offsetY:parseFloat(e[2],10)||0,blur:parseFloat(e[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var d=40,j=40,g=c.Object.NUM_FRACTION_DIGITS,i=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-f.angle)),h=20,e=new c.Color(this.color);if(f.width&&f.height){d=a((Math.abs(i.x)+this.blur)/f.width,g)*100+h;j=a((Math.abs(i.y)+this.blur)/f.height,g)*100+h}if(f.flipX){i.x*=-1}if(f.flipY){i.y*=-1}return('<filter id="SVGID_'+this.id+'" y="-'+j+'%" height="'+(100+2*j)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+a(this.blur?this.blur/2:0,g)+'"></feGaussianBlur>\n\t<feOffset dx="'+a(i.x,g)+'" dy="'+a(i.y,g)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+e.toRgb()+'" flood-opacity="'+e.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling}}var e={},d=c.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(f){if(this[f]!==d[f]){e[f]=this[f]}},this);return e}});c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,c=fabric.util.getElementOffset,f=fabric.util.removeFromArray,a=fabric.util.toFixed,d=fabric.util.transformPoint,g=fabric.util.invertTransform,i=fabric.util.getNodeCanvas,h=fabric.util.createCanvasElement,b=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(k,j){j||(j={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(k,j)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:true,stateful:false,renderOnAddRemove:true,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:true,overlayVpt:true,enableRetinaScaling:true,vptCoords:{},skipOffscreen:true,clipPath:undefined,_initStatic:function(l,k){var j=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(l);this._initOptions(k);if(!this.interactive){this._initRetinaScaling()}if(k.overlayImage){this.setOverlayImage(k.overlayImage,j)}if(k.backgroundImage){this.setBackgroundImage(k.backgroundImage,j)}if(k.backgroundColor){this.setBackgroundColor(k.backgroundColor,j)}if(k.overlayColor){this.setOverlayColor(k.overlayColor,j)}this.calcOffset()},_isRetinaScaling:function(){return(fabric.devicePixelRatio!==1&&this.enableRetinaScaling)},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){if(!this._isRetinaScaling()){return}var j=fabric.devicePixelRatio;this.__initRetinaScaling(j,this.lowerCanvasEl,this.contextContainer);if(this.upperCanvasEl){this.__initRetinaScaling(j,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(l,j,k){j.setAttribute("width",this.width*l);j.setAttribute("height",this.height*l);k.scale(l,l)},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(k,l,j){return this.__setBgOverlayImage("overlayImage",k,l,j)},setBackgroundImage:function(k,l,j){return this.__setBgOverlayImage("backgroundImage",k,l,j)},setOverlayColor:function(k,j){return this.__setBgOverlayColor("overlayColor",k,j)},setBackgroundColor:function(j,k){return this.__setBgOverlayColor("backgroundColor",j,k)},__setBgOverlayImage:function(k,l,m,j){if(typeof l==="string"){fabric.util.loadImage(l,function(o,p){if(o){var n=new fabric.Image(o,j);this[k]=n;n.canvas=this}m&&m(o,p)},this,j&&j.crossOrigin)}else{j&&l.setOptions(j);this[k]=l;l&&(l.canvas=this);m&&m(l,false)}return this},__setBgOverlayColor:function(k,j,l){this[k]=j;this._initGradient(j,k);this._initPattern(j,k,l);return this},_createCanvasElement:function(){var j=h();if(!j){throw b}if(!j.style){j.style={}}if(typeof j.getContext==="undefined"){throw b}return j},_initOptions:function(j){var k=this.lowerCanvasEl;this._setOptions(j);this.width=this.width||parseInt(k.width,10)||0;this.height=this.height||parseInt(k.height,10)||0;if(!this.lowerCanvasEl.style){return}k.width=this.width;k.height=this.height;k.style.width=this.width+"px";k.style.height=this.height+"px";this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(j){if(j&&j.getContext){this.lowerCanvasEl=j}else{this.lowerCanvasEl=fabric.util.getById(j)||this._createCanvasElement()}fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this._originalCanvasStyle=this.lowerCanvasEl.style;if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(k,j){return this.setDimensions({width:k},j)},setHeight:function(k,j){return this.setDimensions({height:k},j)},setDimensions:function(l,k){var j;k=k||{};for(var m in l){j=l[m];if(!k.cssOnly){this._setBackstoreDimension(m,l[m]);j+="px";this.hasLostContext=true}if(!k.backstoreOnly){this._setCssDimension(m,j)}}if(this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles()}this._initRetinaScaling();this.calcOffset();if(!k.cssOnly){this.requestRenderAll()}return this},_setBackstoreDimension:function(k,j){this.lowerCanvasEl[k]=j;if(this.upperCanvasEl){this.upperCanvasEl[k]=j}if(this.cacheCanvasEl){this.cacheCanvasEl[k]=j}this[k]=j;return this},_setCssDimension:function(k,j){this.lowerCanvasEl.style[k]=j;if(this.upperCanvasEl){this.upperCanvasEl.style[k]=j}if(this.wrapperEl){this.wrapperEl.style[k]=j}return this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(p){var o=this._activeObject,n=this.backgroundImage,k=this.overlayImage,l,m,j;this.viewportTransform=p;for(m=0,j=this._objects.length;m<j;m++){l=this._objects[m];l.group||l.setCoords(true)}if(o){o.setCoords()}if(n){n.setCoords(true)}if(k){k.setCoords(true)}this.calcViewportBoundaries();this.renderOnAddRemove&&this.requestRenderAll();return this},zoomToPoint:function(j,l){var k=j,n=this.viewportTransform.slice(0);j=d(j,g(this.viewportTransform));n[0]=l;n[3]=l;var m=d(j,n);n[4]+=k.x-m.x;n[5]+=k.y-m.y;return this.setViewportTransform(n)},setZoom:function(j){this.zoomToPoint(new fabric.Point(0,0),j);return this},absolutePan:function(j){var k=this.viewportTransform.slice(0);k[4]=-j.x;k[5]=-j.y;return this.setViewportTransform(k)},relativePan:function(j){return this.absolutePan(new fabric.Point(-j.x-this.viewportTransform[4],-j.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(j){this.stateful&&j.setupState();j._set("canvas",this);j.setCoords();this.fire("object:added",{target:j});j.fire("added")},_onObjectRemoved:function(j){this.fire("object:removed",{target:j});j.fire("removed");delete j.canvas},clearContext:function(j){j.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.backgroundImage=null;this.overlayImage=null;this.backgroundColor="";this.overlayColor="";if(this._hasITextHandlers){this.off("mouse:up",this._mouseUpITextHandler);this._iTextInstances=null;this._hasITextHandlers=false}this.clearContext(this.contextContainer);this.fire("canvas:cleared");this.renderOnAddRemove&&this.requestRenderAll();return this},renderAll:function(){var j=this.contextContainer;this.renderCanvas(j,this._objects);return this},renderAndReset:function(){this.isRendering=0;this.renderAll()},requestRenderAll:function(){if(!this.isRendering){this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)}return this},calcViewportBoundaries:function(){var l={},k=this.width,j=this.height,m=g(this.viewportTransform);l.tl=d({x:0,y:0},m);l.br=d({x:k,y:j},m);l.tr=new fabric.Point(l.br.x,l.tl.y);l.bl=new fabric.Point(l.tl.x,l.br.y);this.vptCoords=l;return l},cancelRequestedRender:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0}},renderCanvas:function(j,l){var k=this.viewportTransform,m=this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(j);fabric.util.setImageSmoothing(j,this.imageSmoothingEnabled);this.fire("before:render",{ctx:j,});this._renderBackground(j);j.save();j.transform(k[0],k[1],k[2],k[3],k[4],k[5]);this._renderObjects(j,l);j.restore();if(!this.controlsAboveOverlay&&this.interactive){this.drawControls(j)}if(m){m.canvas=this;m.shouldCache();m._transformDone=true;m.renderCache({forClipping:true});this.drawClipPathOnCanvas(j)}this._renderOverlay(j);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(j)}this.fire("after:render",{ctx:j,})},drawClipPathOnCanvas:function(j){var k=this.viewportTransform,l=this.clipPath;j.save();j.transform(k[0],k[1],k[2],k[3],k[4],k[5]);j.globalCompositeOperation="destination-in";l.transform(j);j.scale(1/l.zoomX,1/l.zoomY);j.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY);j.restore()},_renderObjects:function(k,m){var l,j;for(l=0,j=m.length;l<j;++l){m[l]&&m[l].render(k)}},_renderBackgroundOrOverlay:function(k,o){var p=this[o+"Color"],n=this[o+"Image"],l=this.viewportTransform,q=this[o+"Vpt"];if(!p&&!n){return}if(p){k.save();k.beginPath();k.moveTo(0,0);k.lineTo(this.width,0);k.lineTo(this.width,this.height);k.lineTo(0,this.height);k.closePath();k.fillStyle=p.toLive?p.toLive(k,this):p;if(q){k.transform(l[0],l[1],l[2],l[3],l[4],l[5])}k.transform(1,0,0,1,p.offsetX||0,p.offsetY||0);var j=p.gradientTransform||p.patternTransform;j&&k.transform(j[0],j[1],j[2],j[3],j[4],j[5]);k.fill();k.restore()}if(n){k.save();if(q){k.transform(l[0],l[1],l[2],l[3],l[4],l[5])}n.render(k);k.restore()}},_renderBackground:function(j){this._renderBackgroundOrOverlay(j,"background")},_renderOverlay:function(j){this._renderBackgroundOrOverlay(j,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(j){return this._centerObject(j,new fabric.Point(this.getCenter().left,j.getCenterPoint().y))},centerObjectV:function(j){return this._centerObject(j,new fabric.Point(j.getCenterPoint().x,this.getCenter().top))},centerObject:function(k){var j=this.getCenter();return this._centerObject(k,new fabric.Point(j.left,j.top))},viewportCenterObject:function(j){var k=this.getVpCenter();return this._centerObject(j,k)},viewportCenterObjectH:function(j){var k=this.getVpCenter();this._centerObject(j,new fabric.Point(k.x,j.getCenterPoint().y));return this},viewportCenterObjectV:function(j){var k=this.getVpCenter();return this._centerObject(j,new fabric.Point(j.getCenterPoint().x,k.y))},getVpCenter:function(){var j=this.getCenter(),k=g(this.viewportTransform);return d({x:j.left,y:j.top},k)},_centerObject:function(k,j){k.setPositionByOrigin(j,"center","center");k.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this},toDatalessJSON:function(j){return this.toDatalessObject(j)},toObject:function(j){return this._toObjectMethod("toObject",j)},toDatalessObject:function(j){return this._toObjectMethod("toDatalessObject",j)},_toObjectMethod:function(j,m){var k=this.clipPath,l={version:fabric.version,objects:this._toObjects(j,m),};if(k&&!k.excludeFromExport){l.clipPath=this._toObject(this.clipPath,j,m)}e(l,this.__serializeBgOverlay(j,m));fabric.util.populateWithProperties(this,l,m);return l},_toObjects:function(j,k){return this._objects.filter(function(l){return !l.excludeFromExport}).map(function(l){return this._toObject(l,j,k)},this)},_toObject:function(j,l,n){var k;if(!this.includeDefaultValues){k=j.includeDefaultValues;j.includeDefaultValues=false}var m=j[l](n);if(!this.includeDefaultValues){j.includeDefaultValues=k}return m},__serializeBgOverlay:function(k,p){var n={},j=this.backgroundImage,l=this.overlayImage,m=this.backgroundColor,o=this.overlayColor;if(m&&m.toObject){if(!m.excludeFromExport){n.background=m.toObject(p)}}else{if(m){n.background=m}}if(o&&o.toObject){if(!o.excludeFromExport){n.overlay=o.toObject(p)}}else{if(o){n.overlay=o}}if(j&&!j.excludeFromExport){n.backgroundImage=this._toObject(j,k,p)}if(l&&!l.excludeFromExport){n.overlayImage=this._toObject(l,k,p)}return n},svgViewportTransformation:true,toSVG:function(l,j){l||(l={});l.reviver=j;var k=[];this._setSVGPreamble(k,l);this._setSVGHeader(k,l);if(this.clipPath){k.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n')}this._setSVGBgOverlayColor(k,"background");this._setSVGBgOverlayImage(k,"backgroundImage",j);this._setSVGObjects(k,j);if(this.clipPath){k.push("</g>\n")}this._setSVGBgOverlayColor(k,"overlay");this._setSVGBgOverlayImage(k,"overlayImage",j);k.push("</svg>");return k.join("")},_setSVGPreamble:function(j,k){if(k.suppressPreamble){return}j.push('<?xml version="1.0" encoding="',(k.encoding||"UTF-8"),'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(k,l){var n=l.width||this.width,j=l.height||this.height,p,o='viewBox="0 0 '+this.width+" "+this.height+'" ',m=fabric.Object.NUM_FRACTION_DIGITS;if(l.viewBox){o='viewBox="'+l.viewBox.x+" "+l.viewBox.y+" "+l.viewBox.width+" "+l.viewBox.height+'" '}else{if(this.svgViewportTransformation){p=this.viewportTransform;o='viewBox="'+a(-p[4]/p[0],m)+" "+a(-p[5]/p[3],m)+" "+a(this.width/p[0],m)+" "+a(this.height/p[3],m)+'" '}}k.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',j,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(l),"</defs>\n")},createSVGClipPathMarkup:function(j){var k=this.clipPath;if(k){k.clipPathId="CLIPPATH_"+fabric.Object.__uid++;return'<clipPath id="'+k.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(j.reviver)+"</clipPath>\n"}return""},createSVGRefElementsMarkup:function(){var k=this,j=["background","overlay"].map(function(p){var n=k[p+"Color"];if(n&&n.toLive){var l=k[p+"Vpt"],o=k.viewportTransform,m={width:k.width/(l?o[0]:1),height:k.height/(l?o[3]:1)};return n.toSVG(m,{additionalTransform:l?fabric.util.matrixToSVG(o):""})}});return j.join("")},createSVGFontFacesMarkup:function(){var x="",r={},p,s,l,y,t,u,k,o,q,m=fabric.fontPaths,w=[];this._objects.forEach(function v(j){w.push(j);if(j._objects){j._objects.forEach(v)}});for(o=0,q=w.length;o<q;o++){p=w[o];s=p.fontFamily;if(p.type.indexOf("text")===-1||r[s]||!m[s]){continue}r[s]=true;if(!p.styles){continue}l=p.styles;for(t in l){y=l[t];for(k in y){u=y[k];s=u.fontFamily;if(!r[s]&&m[s]){r[s]=true}}}}for(var n in r){x+=["\t\t@font-face {\n","\t\t\tfont-family: '",n,"';\n","\t\t\tsrc: url('",m[n],"');\n","\t\t}\n"].join("")}if(x){x=['\t<style type="text/css">',"<![CDATA[\n",x,"]]>","</style>\n"].join("")}return x},_setSVGObjects:function(m,l){var k,n,j,o=this._objects;for(n=0,j=o.length;n<j;n++){k=o[n];if(k.excludeFromExport){continue}this._setSVGObject(m,k,l)}},_setSVGObject:function(l,k,j){l.push(k.toSVG(j))},_setSVGBgOverlayImage:function(k,l,j){if(this[l]&&!this[l].excludeFromExport&&this[l].toSVG){k.push(this[l].toSVG(j))}},_setSVGBgOverlayColor:function(r,q){var n=this[q+"Color"],o=this.viewportTransform,m=this.width,k=this.height;if(!n){return}if(n.toLive){var j=n.repeat,l=fabric.util.invertTransform(o),s=this[q+"Vpt"],p=s?fabric.util.matrixToSVG(l):"";r.push('<rect transform="'+p+" translate(",m/2,",",k/2,')"',' x="',n.offsetX-m/2,'" y="',n.offsetY-k/2,'" ','width="',(j==="repeat-y"||j==="no-repeat"?n.source.width:m),'" height="',(j==="repeat-x"||j==="no-repeat"?n.source.height:k),'" fill="url(#SVGID_'+n.id+')"',"></rect>\n")}else{r.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',"></rect>\n")}},sendToBack:function(j){if(!j){return this}var n=this._activeObject,k,l,m;if(j===n&&j.type==="activeSelection"){m=n._objects;for(k=m.length;k--;){l=m[k];f(this._objects,l);this._objects.unshift(l)}}else{f(this._objects,j);this._objects.unshift(j)}this.renderOnAddRemove&&this.requestRenderAll();return this},bringToFront:function(j){if(!j){return this}var n=this._activeObject,k,l,m;if(j===n&&j.type==="activeSelection"){m=n._objects;for(k=0;k<m.length;k++){l=m[k];f(this._objects,l);this._objects.push(l)}}else{f(this._objects,j);this._objects.push(j)}this.renderOnAddRemove&&this.requestRenderAll();return this},sendBackwards:function(j,o){if(!j){return this}var r=this._activeObject,l,k,q,p,m,n=0;if(j===r&&j.type==="activeSelection"){m=r._objects;for(l=0;l<m.length;l++){k=m[l];q=this._objects.indexOf(k);if(q>0+n){p=q-1;f(this._objects,k);this._objects.splice(p,0,k)}n++}}else{q=this._objects.indexOf(j);if(q!==0){p=this._findNewLowerIndex(j,q,o);f(this._objects,j);this._objects.splice(p,0,j)}}this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewLowerIndex:function(l,j,n){var o,m;if(n){o=j;for(m=j-1;m>=0;--m){var k=l.intersectsWithObject(this._objects[m])||l.isContainedWithinObject(this._objects[m])||this._objects[m].isContainedWithinObject(l);if(k){o=m;break}}}else{o=j-1}return o},bringForward:function(j,o){if(!j){return this}var r=this._activeObject,l,k,q,p,m,n=0;if(j===r&&j.type==="activeSelection"){m=r._objects;for(l=m.length;l--;){k=m[l];q=this._objects.indexOf(k);if(q<this._objects.length-1-n){p=q+1;f(this._objects,k);this._objects.splice(p,0,k)}n++}}else{q=this._objects.indexOf(j);if(q!==this._objects.length-1){p=this._findNewUpperIndex(j,q,o);f(this._objects,j);this._objects.splice(p,0,j)}}this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewUpperIndex:function(m,k,o){var p,n,j;if(o){p=k;for(n=k+1,j=this._objects.length;n<j;++n){var l=m.intersectsWithObject(this._objects[n])||m.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(m);if(l){p=n;break}}}else{p=k+1}return p},moveTo:function(k,j){f(this._objects,k);this._objects.splice(j,0,k);return this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0}this.forEachObject(function(j){j.dispose&&j.dispose()});this._objects=[];if(this.backgroundImage&&this.backgroundImage.dispose){this.backgroundImage.dispose()}this.backgroundImage=null;if(this.overlayImage&&this.overlayImage.dispose){this.overlayImage.dispose()}this.overlayImage=null;this._iTextInstances=null;this.contextContainer=null;this.lowerCanvasEl.classList.remove("lower-canvas");this.lowerCanvasEl.style=this._originalCanvasStyle;delete this._originalCanvasStyle;this.lowerCanvasEl.setAttribute("width",this.width);this.lowerCanvasEl.setAttribute("height",this.height);fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);this.lowerCanvasEl=undefined;return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(k){var l=h();if(!l||!l.getContext){return null}var j=l.getContext("2d");if(!j){return null}switch(k){case"setLineDash":return typeof j.setLineDash!=="undefined";default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;if(fabric.isLikelyNode){fabric.StaticCanvas.prototype.createPNGStream=function(){var j=i(this.lowerCanvasEl);return j&&j.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(k){var j=i(this.lowerCanvasEl);return j&&j.createJPEGStream(k)}}})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:false,_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color;a.lineWidth=this.width;a.lineCap=this.strokeLineCap;a.miterLimit=this.strokeMiterLimit;a.lineJoin=this.strokeLineJoin;a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var b=this.canvas.viewportTransform;a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5])},_setShadow:function(){if(!this.shadow){return}var b=this.canvas,d=this.shadow,a=b.contextTop,c=b.getZoom();if(b&&b._isRetinaScaling()){c*=fabric.devicePixelRatio}a.shadowColor=d.color;a.shadowBlur=d.blur*c;a.shadowOffsetX=d.offsetX*c;a.shadowOffsetY=d.offsetY*c},needsFullRender:function(){var a=new fabric.Color(this.color);return a.getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_isOutSideCanvas:function(a){return a.x<0||a.x>this.canvas.getWidth()||a.y<0||a.y>this.canvas.getHeight()}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:0.4,initialize:function(a){this.canvas=a;this._points=[]},_drawSegment:function(a,c,b){var d=c.midPointFrom(b);a.quadraticCurveTo(c.x,c.y,d.x,d.y);return d},onMouseDown:function(b,a){if(!this.canvas._isMainEvent(a.e)){return}this._prepareForDrawing(b);this._captureDrawingPath(b);this._render()},onMouseMove:function(e,b){if(!this.canvas._isMainEvent(b.e)){return}if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(e)){return}if(this._captureDrawingPath(e)&&this._points.length>1){if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this._render()}else{var c=this._points,d=c.length,a=this.canvas.contextTop;this._saveAndTransform(a);if(this.oldEnd){a.beginPath();a.moveTo(this.oldEnd.x,this.oldEnd.y)}this.oldEnd=this._drawSegment(a,c[d-2],c[d-1],true);a.stroke();a.restore()}}},onMouseUp:function(a){if(!this.canvas._isMainEvent(a.e)){return true}this.oldEnd=undefined;this._finalizeAndAddPath();return false},_prepareForDrawing:function(b){var a=new fabric.Point(b.x,b.y);this._reset();this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){if(this._points.length>1&&a.eq(this._points[this._points.length-1])){return false}this._points.push(a);return true},_reset:function(){this._points=[];this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);return this._addPoint(b)},_render:function(){var b=this.canvas.contextTop,c,a,f=this._points[0],e=this._points[1];this._saveAndTransform(b);b.beginPath();if(this._points.length===2&&f.x===e.x&&f.y===e.y){var d=this.width/1000;f=new fabric.Point(f.x,f.y);e=new fabric.Point(e.x,e.y);f.x-=d;e.x+=d}b.moveTo(f.x,f.y);for(c=1,a=this._points.length;c<a;c++){this._drawSegment(b,f,e);f=this._points[c];e=this._points[c+1]}b.lineTo(f.x,f.y);b.stroke();b.restore()},convertPointsToSVGPath:function(b){var a=this.width/1000;return fabric.util.getSmoothPathFromPoints(b,a)},_isEmptySVGPath:function(b){var a=b.map(function(c){return c.join(" ")}).join(" ");return a==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(b){var a=new fabric.Path(b,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,});if(this.shadow){this.shadow.affectStroke=true;a.shadow=new fabric.Shadow(this.shadow)}return a},decimatePoints:function(g,a){if(g.length<=2){return g}var h=this.canvas.getZoom(),c=Math.pow(a/h,2),d,b=g.length-1,f=g[0],j=[f],e;for(d=1;d<b-1;d++){e=Math.pow(f.x-g[d].x,2)+Math.pow(f.y-g[d].y,2);if(e>=c){f=g[d];j.push(f)}}j.push(g[b]);return j},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();if(this.decimate){this._points=this.decimatePoints(this._points,this.decimate)}var c=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(c)){this.canvas.requestRenderAll();return}var b=this.createPath(c);this.canvas.clearContext(this.canvas.contextTop);this.canvas.fire("before:path:created",{path:b});this.canvas.add(b);this.canvas.requestRenderAll();b.setCoords();this._resetShadow();this.canvas.fire("path:created",{path:b})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a;this.points=[]},drawDot:function(c){var a=this.addPoint(c),b=this.canvas.contextTop;this._saveAndTransform(b);this.dot(b,a);b.restore()},dot:function(b,a){b.fillStyle=a.fill;b.beginPath();b.arc(a.x,a.y,a.radius,0,Math.PI*2,false);b.closePath();b.fill()},onMouseDown:function(a){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(a)},_render:function(){var b=this.canvas.contextTop,c,a,d=this.points;this._saveAndTransform(b);for(c=0,a=d.length;c<a;c++){this.dot(b,d[c])}b.restore()},onMouseMove:function(a){if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(a)){return}if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this.addPoint(a);this._render()}else{this.drawDot(a)}},onMouseUp:function(){var g=this.canvas.renderOnAddRemove,c,b;this.canvas.renderOnAddRemove=false;var f=[];for(c=0,b=this.points.length;c<b;c++){var a=this.points[c],e=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&(e.shadow=new fabric.Shadow(this.shadow));f.push(e)}var d=new fabric.Group(f);d.canvas=this.canvas;this.canvas.fire("before:path:created",{path:d});this.canvas.add(d);this.canvas.fire("path:created",{path:d});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=g;this.canvas.requestRenderAll()},addPoint:function(c){var d=new fabric.Point(c.x,c.y),a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=b;this.points.push(d);return d}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(a){this.canvas=a;this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(a);this.render(this.sprayChunkPoints)},onMouseMove:function(a){if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(a)){return}this.addSprayChunk(a);this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var h=[];for(var c=0,a=this.sprayChunks.length;c<a;c++){var d=this.sprayChunks[c];for(var b=0,k=d.length;b<k;b++){var f=new fabric.Rect({width:d[b].width,height:d[b].width,left:d[b].x+1,top:d[b].y+1,originX:"center",originY:"center",fill:this.color});h.push(f)}}if(this.optimizeOverlapping){h=this._getOptimizedRects(h)}var g=new fabric.Group(h);this.shadow&&g.set("shadow",new fabric.Shadow(this.shadow));this.canvas.fire("before:path:created",{path:g});this.canvas.add(g);this.canvas.fire("path:created",{path:g});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.requestRenderAll()},_getOptimizedRects:function(c){var b={},e,d,a;for(d=0,a=c.length;d<a;d++){e=c[d].left+""+c[d].top;if(!b[e]){b[e]=c[d]}}var f=[];for(e in b){f.push(b[e])}return f},render:function(e){var c=this.canvas.contextTop,d,b;c.fillStyle=this.color;this._saveAndTransform(c);for(d=0,b=e.length;d<b;d++){var a=e[d];if(typeof a.opacity!=="undefined"){c.globalAlpha=a.opacity}c.fillRect(a.x,a.y,a.width,a.width)}c.restore()},_render:function(){var a=this.canvas.contextTop,c,b;a.fillStyle=this.color;this._saveAndTransform(a);for(c=0,b=this.sprayChunks.length;c<b;c++){this.render(this.sprayChunks[c])}a.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var c,g,e,b=this.width/2,d;for(d=0;d<this.density;d++){c=fabric.util.getRandomInt(f.x-b,f.x+b);g=fabric.util.getRandomInt(f.y-b,f.y+b);if(this.dotWidthVariance){e=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{e=this.dotWidth}var a=new fabric.Point(c,g);a.width=e;if(this.randomOpacity){a.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=20,b=5,c=fabric.util.createCanvasElement(),a=c.getContext("2d");c.width=c.height=d+b;a.fillStyle=this.color;a.beginPath();a.arc(d/2,d/2,d/2,0,Math.PI*2,false);a.closePath();a.fill();return c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(c){var b=this.callSuper("createPath",c),a=b._getLeftTopCoords().scalarAdd(b.strokeWidth/2);b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-a.x,offsetY:-a.y});return b}});(function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.isTouchEvent;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(f,e){e||(e={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(f,e);this._initInteractive();this._createCacheCanvas()},uniformScaling:true,uniScaleKey:"shiftKey",centeredScaling:false,centeredRotation:false,centeredKey:"altKey",altActionKey:"shiftKey",interactive:true,selection:true,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:false,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,preserveObjectStacking:false,snapAngle:0,snapThreshold:null,stopContextMenu:false,fireRightClick:false,fireMiddleClick:false,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_chooseObjectsToRender:function(){var j=this.getActiveObjects(),f,k,e;if(j.length>0&&!this.preserveObjectStacking){k=[];e=[];for(var g=0,h=this._objects.length;g<h;g++){f=this._objects[g];if(j.indexOf(f)===-1){k.push(f)}else{e.push(f)}}if(j.length>1){this._activeObject._objects=e}k.push.apply(k,e)}else{k=this._objects}return k},renderAll:function(){if(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop);this.contextTopDirty=false}if(this.hasLostContext){this.renderTopLayer(this.contextTop)}var e=this.contextContainer;this.renderCanvas(e,this._chooseObjectsToRender());return this},renderTopLayer:function(e){e.save();if(this.isDrawingMode&&this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._render();this.contextTopDirty=true}if(this.selection&&this._groupSelector){this._drawSelection(e);this.contextTopDirty=true}e.restore()},renderTop:function(){var e=this.contextTop;this.clearContext(e);this.renderTopLayer(e);this.fire("after:render");return this},_normalizePointer:function(g,i){var f=g.calcTransformMatrix(),e=fabric.util.invertTransform(f),h=this.restorePointerVpt(i);return fabric.util.transformPoint(h,e)},isTargetTransparent:function(i,k,j){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var m=this._normalizePointer(i,{x:k,y:j}),f=Math.max(i.cacheTranslationX+(m.x*i.zoomX),0),e=Math.max(i.cacheTranslationY+(m.y*i.zoomY),0);var h=fabric.util.isTransparent(i._cacheContext,Math.round(f),Math.round(e),this.targetFindTolerance);return h}var n=this.contextCache,g=i.selectionBackgroundColor,l=this.viewportTransform;i.selectionBackgroundColor="";this.clearContext(n);n.save();n.transform(l[0],l[1],l[2],l[3],l[4],l[5]);i.render(n);n.restore();i.selectionBackgroundColor=g;var h=fabric.util.isTransparent(n,k,j,this.targetFindTolerance);return h},_isSelectionKeyPressed:function(f){var g=false;if(Object.prototype.toString.call(this.selectionKey)==="[object Array]"){g=!!this.selectionKey.find(function(e){return f[e]===true})}else{g=f[this.selectionKey]}return g},_shouldClearSelection:function(h,g){var i=this.getActiveObjects(),f=this._activeObject;return(!g||(g&&f&&i.length>1&&i.indexOf(g)===-1&&f!==g&&!this._isSelectionKeyPressed(h))||(g&&!g.evented)||(g&&!g.selectable&&f&&f!==g))},_shouldCenterTransform:function(h,g,f){if(!h){return}var e;if(g==="scale"||g==="scaleX"||g==="scaleY"||g==="resizing"){e=this.centeredScaling||h.centeredScaling}else{if(g==="rotate"){e=this.centeredRotation||h.centeredRotation}}return e?!f:f},_getOriginFromCorner:function(g,f){var e={x:g.originX,y:g.originY};if(f==="ml"||f==="tl"||f==="bl"){e.x="right"}else{if(f==="mr"||f==="tr"||f==="br"){e.x="left"}}if(f==="tl"||f==="mt"||f==="tr"){e.y="bottom"}else{if(f==="bl"||f==="mb"||f==="br"){e.y="top"}}return e},_getActionFromCorner:function(f,g,j,i){if(!g||!f){return"drag"}var h=i.controls[g];return h.getActionName(j,h,i)},_setupCurrentTransform:function(m,n,l){if(!n){return}var g=this.getPointer(m),p=n.__corner,k=n.controls[p],h=(l&&p)?k.getActionHandler(m,n,k):fabric.controlsUtils.dragHandler,j=this._getActionFromCorner(l,p,m,n),o=this._getOriginFromCorner(n,p),f=m[this.centeredKey],i={target:n,action:j,actionHandler:h,corner:p,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:g.x-n.left,offsetY:g.y-n.top,originX:o.x,originY:o.y,ex:g.x,ey:g.y,lastX:g.x,lastY:g.y,theta:b(n.angle),width:n.width*n.scaleX,shiftKey:m.shiftKey,altKey:f,original:fabric.util.saveObjectTransform(n),};if(this._shouldCenterTransform(n,j,f)){i.originX="center";i.originY="center"}i.original.originX=o.x;i.original.originY=o.y;this._currentTransform=i;this._beforeTransform(m)},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(o){var i=this._groupSelector,m=new fabric.Point(i.ex,i.ey),g=fabric.util.transformPoint(m,this.viewportTransform),l=new fabric.Point(i.ex+i.left,i.ey+i.top),n=fabric.util.transformPoint(l,this.viewportTransform),j=Math.min(g.x,n.x),h=Math.min(g.y,n.y),f=Math.max(g.x,n.x),e=Math.max(g.y,n.y),k=this.selectionLineWidth/2;if(this.selectionColor){o.fillStyle=this.selectionColor;o.fillRect(j,h,f-j,e-h)}if(!this.selectionLineWidth||!this.selectionBorderColor){return}o.lineWidth=this.selectionLineWidth;o.strokeStyle=this.selectionBorderColor;j+=k;h+=k;f-=k;e-=k;fabric.Object.prototype._setLineDash.call(this,o,this.selectionDashArray);o.strokeRect(j,h,f-j,e-h)},findTarget:function(n,k){if(this.skipTargetFind){return}var p=true,f=this.getPointer(n,p),h=this._activeObject,g=this.getActiveObjects(),j,o,i=c(n),l=(g.length>1&&!k)||g.length===1;this.targets=[];if(l&&h._findTargetCorner(f,i)){return h}if(g.length>1&&!k&&h===this._searchPossibleTargets([h],f)){return h}if(g.length===1&&h===this._searchPossibleTargets([h],f)){if(!this.preserveObjectStacking){return h}else{j=h;o=this.targets;this.targets=[]}}var m=this._searchPossibleTargets(this._objects,f);if(n[this.altSelectionKey]&&m&&j&&m!==j){m=j;this.targets=o}return m},_checkTarget:function(h,g,e){if(g&&g.visible&&g.evented&&g.containsPoint(h)){if((this.perPixelTargetFind||g.perPixelTargetFind)&&!g.isEditing){var f=this.isTargetTransparent(g,e.x,e.y);if(!f){return true}}else{return true}}},_searchPossibleTargets:function(h,l){var j,e=h.length,f;while(e--){var k=h[e];var g=k.group?this._normalizePointer(k.group,l):l;if(this._checkTarget(g,k,l)){j=h[e];if(j.subTargetCheck&&j instanceof fabric.Group){f=this._searchPossibleTargets(j._objects,l);f&&this.targets.push(f)}break}}return j},restorePointerVpt:function(e){return fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(j,l){if(this._absolutePointer&&!l){return this._absolutePointer}if(this._pointer&&l){return this._pointer}var f=a(j),i=this.upperCanvasEl,g=i.getBoundingClientRect(),h=g.width||0,m=g.height||0,n;if(!h||!m){if("top" in g&&"bottom" in g){m=Math.abs(g.top-g.bottom)}if("right" in g&&"left" in g){h=Math.abs(g.right-g.left)}}this.calcOffset();f.x=f.x-this._offset.left;f.y=f.y-this._offset.top;if(!l){f=this.restorePointerVpt(f)}var k=this.getRetinaScaling();if(k!==1){f.x/=k;f.y/=k}if(h===0||m===0){n={width:1,height:1}}else{n={width:i.width/h,height:i.height/m}}return{x:f.x*n.width,y:f.y*n.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),g=this.lowerCanvasEl,f=this.upperCanvasEl;if(f){f.className=""}else{f=this._createCanvasElement();this.upperCanvasEl=f}fabric.util.addClass(f,"upper-canvas "+e);this.wrapperEl.appendChild(f);this._copyCanvasStyle(g,f);this._applyCanvasStyle(f);this.contextTop=f.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(f){var g=this.width||f.width,e=this.height||f.height;fabric.util.setStyle(f,{position:"absolute",width:g+"px",height:e+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"});f.width=g;f.height=e;fabric.util.makeElementUnselectable(f)},_copyCanvasStyle:function(f,e){e.style.cssText=f.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;if(e){if(e.type==="activeSelection"&&e._objects){return e._objects.slice(0)}else{return[e]}}return[]},_onObjectRemoved:function(e){if(e===this._activeObject){this.fire("before:selection:cleared",{target:e});this._discardActiveObject();this.fire("selection:cleared",{target:e});e.fire("deselected")}if(e===this._hoveredTarget){this._hoveredTarget=null;this._hoveredTargets=[]}this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(h,k){var f=false,i=this.getActiveObjects(),g=[],j=[];h.forEach(function(e){if(i.indexOf(e)===-1){f=true;e.fire("deselected",{e:k,target:e});j.push(e)}});i.forEach(function(e){if(h.indexOf(e)===-1){f=true;e.fire("selected",{e:k,target:e});g.push(e)}});if(h.length>0&&i.length>0){f&&this.fire("selection:updated",{e:k,selected:g,deselected:j,updated:g[0]||j[0],target:this._activeObject,})}else{if(i.length>0){this.fire("selection:created",{e:k,selected:g,target:this._activeObject,})}else{if(h.length>0){this.fire("selection:cleared",{e:k,deselected:j,})}}}},setActiveObject:function(f,h){var g=this.getActiveObjects();this._setActiveObject(f,h);this._fireSelectionEvents(g,h);return this},_setActiveObject:function(f,g){if(this._activeObject===f){return false}if(!this._discardActiveObject(g,f)){return false}if(f.onSelect({e:g})){return false}this._activeObject=f;return true},_discardActiveObject:function(h,f){var g=this._activeObject;if(g){if(g.onDeselect({e:h,object:f})){return false}this._activeObject=null}return true},discardActiveObject:function(h){var g=this.getActiveObjects(),f=this.getActiveObject();if(g.length){this.fire("before:selection:cleared",{target:f,e:h})}this._discardActiveObject(h);this._fireSelectionEvents(g,h);return this},dispose:function(){var e=this.wrapperEl;this.removeListeners();e.removeChild(this.upperCanvasEl);e.removeChild(this.lowerCanvasEl);this.contextCache=null;this.contextTop=null;["upperCanvasEl","cacheCanvasEl"].forEach((function(f){fabric.util.cleanUpJsdomNode(this[f]);this[f]=undefined}).bind(this));if(e.parentNode){e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl)}delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this},clear:function(){this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper("clear")},drawControls:function(e){var f=this._activeObject;if(f){f._renderControls(e)}},_toObject:function(e,f,i){var h=this._realizeGroupTransformOnObject(e),g=this.callSuper("_toObject",e,f,i);this._unwindGroupTransformOnObject(e,h);return g},_realizeGroupTransformOnObject:function(e){if(e.group&&e.group.type==="activeSelection"&&this._activeObject===e.group){var f=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"];var g={};f.forEach(function(h){g[h]=e[h]});fabric.util.addTransformToObject(e,this._activeObject.calcOwnMatrix());return g}else{return null}},_unwindGroupTransformOnObject:function(e,f){if(f){e.set(f)}},_setSVGObject:function(g,f,e){var h=this._realizeGroupTransformOnObject(f);this.callSuper("_setSVGObject",g,f,e);this._unwindGroupTransformOnObject(f,h)},setViewportTransform:function(e){if(this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing){this._activeObject.clearContextTop()}fabric.StaticCanvas.prototype.setViewportTransform.call(this,e)}});for(var d in fabric.StaticCanvas){if(d!=="prototype"){fabric.Canvas[d]=fabric.StaticCanvas[d]}}})();(function(){var d=fabric.util.addListener,e=fabric.util.removeListener,a=3,g=2,f=1,c={passive:false};function b(i,h){return i.button&&(i.button===h-1)}fabric.util.object.extend(fabric.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners();this._bindEvents();this.addOrRemove(d,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(j,i){var h=this.upperCanvasEl,k=this._getEventPrefix();j(fabric.window,"resize",this._onResize);j(h,k+"down",this._onMouseDown);j(h,k+"move",this._onMouseMove,c);j(h,k+"out",this._onMouseOut);j(h,k+"enter",this._onMouseEnter);j(h,"wheel",this._onMouseWheel);j(h,"contextmenu",this._onContextMenu);j(h,"dblclick",this._onDoubleClick);j(h,"dragover",this._onDragOver);j(h,"dragenter",this._onDragEnter);j(h,"dragleave",this._onDragLeave);j(h,"drop",this._onDrop);if(!this.enablePointerEvents){j(h,"touchstart",this._onTouchStart,c)}if(typeof eventjs!=="undefined"&&i in eventjs){eventjs[i](h,"gesture",this._onGesture);eventjs[i](h,"drag",this._onDrag);eventjs[i](h,"orientation",this._onOrientationChange);eventjs[i](h,"shake",this._onShake);eventjs[i](h,"longpress",this._onLongPress)}},removeListeners:function(){this.addOrRemove(e,"remove");var h=this._getEventPrefix();e(fabric.document,h+"up",this._onMouseUp);e(fabric.document,"touchend",this._onTouchEnd,c);e(fabric.document,h+"move",this._onMouseMove,c);e(fabric.document,"touchmove",this._onMouseMove,c)},_bindEvents:function(){if(this.eventsBound){return}this._onMouseDown=this._onMouseDown.bind(this);this._onTouchStart=this._onTouchStart.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this);this._onMouseEnter=this._onMouseEnter.bind(this);this._onContextMenu=this._onContextMenu.bind(this);this._onDoubleClick=this._onDoubleClick.bind(this);this._onDragOver=this._onDragOver.bind(this);this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter");this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave");this._onDrop=this._simpleEventHandler.bind(this,"drop");this.eventsBound=true},_onGesture:function(i,h){this.__onTransformGesture&&this.__onTransformGesture(i,h)},_onDrag:function(i,h){this.__onDrag&&this.__onDrag(i,h)},_onMouseWheel:function(h){this.__onMouseWheel(h)},_onMouseOut:function(i){var h=this._hoveredTarget;this.fire("mouse:out",{target:h,e:i});this._hoveredTarget=null;h&&h.fire("mouseout",{e:i});var j=this;this._hoveredTargets.forEach(function(k){j.fire("mouse:out",{target:h,e:i});k&&h.fire("mouseout",{e:i})});this._hoveredTargets=[];if(this._iTextInstances){this._iTextInstances.forEach(function(k){if(k.isEditing){k.hiddenTextarea.focus()}})}},_onMouseEnter:function(h){if(!this._currentTransform&&!this.findTarget(h)){this.fire("mouse:over",{target:null,e:h});this._hoveredTarget=null;this._hoveredTargets=[]}},_onOrientationChange:function(i,h){this.__onOrientationChange&&this.__onOrientationChange(i,h)},_onShake:function(i,h){this.__onShake&&this.__onShake(i,h)},_onLongPress:function(i,h){this.__onLongPress&&this.__onLongPress(i,h)},_onDragOver:function(i){i.preventDefault();var h=this._simpleEventHandler("dragover",i);this._fireEnterLeaveEvents(h,i)},_onContextMenu:function(h){if(this.stopContextMenu){h.stopPropagation();h.preventDefault()}return false},_onDoubleClick:function(h){this._cacheTransformEventData(h);this._handleEvent(h,"dblclick");this._resetTransformEventData(h)},getPointerId:function(h){var i=h.changedTouches;if(i){return i[0]&&i[0].identifier}if(this.enablePointerEvents){return h.pointerId}return -1},_isMainEvent:function(h){if(h.isPrimary===true){return true}if(h.isPrimary===false){return false}if(h.type==="touchend"&&h.touches.length===0){return true}if(h.changedTouches){return h.changedTouches[0].identifier===this.mainTouchId}return true},_onTouchStart:function(j){j.preventDefault();if(this.mainTouchId===null){this.mainTouchId=this.getPointerId(j)}this.__onMouseDown(j);this._resetTransformEventData();var h=this.upperCanvasEl,i=this._getEventPrefix();d(fabric.document,"touchend",this._onTouchEnd,c);d(fabric.document,"touchmove",this._onMouseMove,c);e(h,i+"down",this._onMouseDown)},_onMouseDown:function(j){this.__onMouseDown(j);this._resetTransformEventData();var h=this.upperCanvasEl,i=this._getEventPrefix();e(h,i+"move",this._onMouseMove,c);d(fabric.document,i+"up",this._onMouseUp);d(fabric.document,i+"move",this._onMouseMove,c)},_onTouchEnd:function(i){if(i.touches.length>0){return}this.__onMouseUp(i);this._resetTransformEventData();this.mainTouchId=null;var h=this._getEventPrefix();e(fabric.document,"touchend",this._onTouchEnd,c);e(fabric.document,"touchmove",this._onMouseMove,c);var j=this;if(this._willAddMouseDown){clearTimeout(this._willAddMouseDown)}this._willAddMouseDown=setTimeout(function(){d(j.upperCanvasEl,h+"down",j._onMouseDown);j._willAddMouseDown=0},400)},_onMouseUp:function(j){this.__onMouseUp(j);this._resetTransformEventData();var h=this.upperCanvasEl,i=this._getEventPrefix();if(this._isMainEvent(j)){e(fabric.document,i+"up",this._onMouseUp);e(fabric.document,i+"move",this._onMouseMove,c);d(h,i+"move",this._onMouseMove,c)}},_onMouseMove:function(h){!this.allowTouchScrolling&&h.preventDefault&&h.preventDefault();this.__onMouseMove(h)},_onResize:function(){this.calcOffset()},_shouldRender:function(i){var h=this._activeObject;if(!!h!==!!i||(h&&i&&(h!==i))){return true}else{if(h&&h.isEditing){return false}}return false},__onMouseUp:function(m){var n,j=this._currentTransform,i=this._groupSelector,r=false,p=(!i||(i.left===0&&i.top===0));this._cacheTransformEventData(m);n=this._target;this._handleEvent(m,"up:before");if(b(m,a)){if(this.fireRightClick){this._handleEvent(m,"up",a,p)}return}if(b(m,g)){if(this.fireMiddleClick){this._handleEvent(m,"up",g,p)}this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(m);return}if(!this._isMainEvent(m)){return}if(j){this._finalizeCurrentTransform(m);r=j.actionPerformed}if(!p){var k=n===this._activeObject;this._maybeGroupObjects(m);if(!r){r=(this._shouldRender(n)||(!k&&n===this._activeObject))}}if(n){if(n.selectable&&n!==this._activeObject&&n.activeOn==="up"){this.setActiveObject(n,m);r=true}else{var o=n._findTargetCorner(this.getPointer(m,true),fabric.util.isTouchEvent(m));var l=n.controls[o],q=l&&l.getMouseUpHandler(m,n,l);if(q){var h=this.getPointer(m);q(m,j,h.x,h.y)}}n.isMoving=false}this._setCursorFromEvent(m,n);this._handleEvent(m,"up",f,p);this._groupSelector=null;this._currentTransform=null;n&&(n.__corner=0);if(r){this.requestRenderAll()}else{if(!p){this.renderTop()}}},_simpleEventHandler:function(l,n){var m=this.findTarget(n),h=this.targets,j={e:n,target:m,subTargets:h,};this.fire(l,j);m&&m.fire(l,j);if(!h){return m}for(var k=0;k<h.length;k++){h[k].fire(l,j)}return m},_handleEvent:function(p,m,l,o){var n=this._target,h=this.targets||[],j={e:p,target:n,subTargets:h,button:l||f,isClick:o||false,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};if(m==="up"){j.currentTarget=this.findTarget(p);j.currentSubTargets=this.targets}this.fire("mouse:"+m,j);n&&n.fire("mouse"+m,j);for(var k=0;k<h.length;k++){h[k].fire("mouse"+m,j)}},_finalizeCurrentTransform:function(l){var j=this._currentTransform,k=j.target,h,i={e:l,target:k,transform:j,action:j.action,};if(k._scaling){k._scaling=false}k.setCoords();if(j.actionPerformed||(this.stateful&&k.hasStateChanged())){if(j.actionPerformed){h=this._addEventOptions(i,j);this._fire(h,i)}this._fire("modified",i)}},_addEventOptions:function(j,i){var h,k;switch(i.action){case"scaleX":h="scaled";k="x";break;case"scaleY":h="scaled";k="y";break;case"skewX":h="skewed";k="x";break;case"skewY":h="skewed";k="y";break;case"scale":h="scaled";k="equally";break;case"rotate":h="rotated";break;case"drag":h="moved";break}j.by=k;return h},_onMouseDownInDrawingMode:function(h){this._isCurrentlyDrawing=true;if(this.getActiveObject()){this.discardActiveObject(h).requestRenderAll()}var i=this.getPointer(h);this.freeDrawingBrush.onMouseDown(i,{e:h,pointer:i});this._handleEvent(h,"down")},_onMouseMoveInDrawingMode:function(h){if(this._isCurrentlyDrawing){var i=this.getPointer(h);this.freeDrawingBrush.onMouseMove(i,{e:h,pointer:i})}this.setCursor(this.freeDrawingCursor);this._handleEvent(h,"move")},_onMouseUpInDrawingMode:function(h){var i=this.getPointer(h);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:h,pointer:i});this._handleEvent(h,"up")},__onMouseDown:function(l){this._cacheTransformEventData(l);this._handleEvent(l,"down:before");var m=this._target;if(b(l,a)){if(this.fireRightClick){this._handleEvent(l,"down",a)}return}if(b(l,g)){if(this.fireMiddleClick){this._handleEvent(l,"down",g)}return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(l);return}if(!this._isMainEvent(l)){return}if(this._currentTransform){return}var h=this._pointer;this._previousPointer=h;var p=this._shouldRender(m),j=this._shouldGroup(l,m);if(this._shouldClearSelection(l,m)){this.discardActiveObject(l)}else{if(j){this._handleGrouping(l,m);m=this._activeObject}}if(this.selection&&(!m||(!m.selectable&&!m.isEditing&&m!==this._activeObject))){this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}}if(m){var k=m===this._activeObject;if(m.selectable&&m.activeOn==="down"){this.setActiveObject(m,l)}var o=m._findTargetCorner(this.getPointer(l,true),fabric.util.isTouchEvent(l));m.__corner=o;if(m===this._activeObject&&(o||!j)){this._setupCurrentTransform(l,m,k);var i=m.controls[o],h=this.getPointer(l),n=i&&i.getMouseDownHandler(l,m,i);if(n){n(l,this._currentTransform,h.x,h.y)}}}this._handleEvent(l,"down");(p||j)&&this.requestRenderAll()},_resetTransformEventData:function(){this._target=null;this._pointer=null;this._absolutePointer=null},_cacheTransformEventData:function(h){this._resetTransformEventData();this._pointer=this.getPointer(h,true);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(h)||null},_beforeTransform:function(i){var h=this._currentTransform;this.stateful&&h.target.saveState();this.fire("before:transform",{e:i,transform:h,})},__onMouseMove:function(j){this._handleEvent(j,"move:before");this._cacheTransformEventData(j);var i,k;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(j);return}if(!this._isMainEvent(j)){return}var h=this._groupSelector;if(h){k=this._absolutePointer;h.left=k.x-h.ex;h.top=k.y-h.ey;this.renderTop()}else{if(!this._currentTransform){i=this.findTarget(j)||null;this._setCursorFromEvent(j,i);this._fireOverOutEvents(i,j)}else{this._transformObject(j)}}this._handleEvent(j,"move");this._resetTransformEventData()},_fireOverOutEvents:function(o,n){var h=this._hoveredTarget,m=this._hoveredTargets,j=this.targets,l=Math.max(m.length,j.length);this.fireSyntheticInOutEvents(o,n,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over",});for(var k=0;k<l;k++){this.fireSyntheticInOutEvents(j[k],n,{oldTarget:m[k],evtOut:"mouseout",evtIn:"mouseover",})}this._hoveredTarget=o;this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,n){var k=this._draggedoverTarget,m=this._hoveredTargets,h=this.targets,l=Math.max(m.length,h.length);this.fireSyntheticInOutEvents(o,n,{oldTarget:k,evtOut:"dragleave",evtIn:"dragenter",});for(var j=0;j<l;j++){this.fireSyntheticInOutEvents(h[j],n,{oldTarget:m[j],evtOut:"dragleave",evtIn:"dragenter",})}this._draggedoverTarget=o},fireSyntheticInOutEvents:function(n,o,h){var i,q,p=h.oldTarget,j,r,m=p!==n,l=h.canvasEvtIn,k=h.canvasEvtOut;if(m){i={e:o,target:n,previousTarget:p};q={e:o,target:p,nextTarget:n}}r=n&&m;j=p&&m;if(j){k&&this.fire(k,q);p.fire(h.evtOut,q)}if(r){l&&this.fire(l,i);n.fire(h.evtIn,i)}},__onMouseWheel:function(h){this._cacheTransformEventData(h);this._handleEvent(h,"wheel");this._resetTransformEventData()},_transformObject:function(i){var j=this.getPointer(i),h=this._currentTransform;h.reset=false;h.shiftKey=i.shiftKey;h.altKey=i[this.centeredKey];this._performTransformAction(i,h,j);h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(l,i,n){var h=n.x,o=n.y,j=i.action,m=false,k=i.actionHandler;if(k){m=k(l,i,h,o)}if(j==="drag"&&m){i.target.isMoving=true;this.setCursor(i.target.moveCursor||this.moveCursor)}i.actionPerformed=i.actionPerformed||m},_fire:fabric.controlsUtils.fireEvent,_setCursorFromEvent:function(j,i){if(!i){this.setCursor(this.defaultCursor);return false}var k=i.hoverCursor||this.hoverCursor,l=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,h=(!l||!l.contains(i))&&i._findTargetCorner(this.getPointer(j,true));if(!h){if(i.subTargetCheck){this.targets.concat().reverse().map(function(m){k=m.hoverCursor||k})}this.setCursor(k)}else{this.setCursor(this.getCornerCursor(h,i,j))}},getCornerCursor:function(h,k,j){var i=k.controls[h];return i.cursorStyleHandler(j,i,k)}})})();(function(){var b=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(f,d){var c=this._activeObject;return c&&this._isSelectionKeyPressed(f)&&d&&d.selectable&&this.selection&&(c!==d||c.type==="activeSelection")&&!d.onSelect({e:f})},_handleGrouping:function(f,d){var c=this._activeObject;if(c.__corner){return}if(d===c){d=this.findTarget(f,true);if(!d||!d.selectable){return}}if(c&&c.type==="activeSelection"){this._updateActiveSelection(d,f)}else{this._createActiveSelection(d,f)}},_updateActiveSelection:function(d,c){var g=this._activeObject,f=g._objects.slice(0);if(g.contains(d)){g.removeWithUpdate(d);this._hoveredTarget=d;this._hoveredTargets=this.targets.concat();if(g.size()===1){this._setActiveObject(g.item(0),c)}}else{g.addWithUpdate(d);this._hoveredTarget=g;this._hoveredTargets=this.targets.concat()}this._fireSelectionEvents(f,c)},_createActiveSelection:function(g,f){var c=this.getActiveObjects(),d=this._createGroup(g);this._hoveredTarget=d;this._setActiveObject(d,f);this._fireSelectionEvents(c,f)},_createGroup:function(f){var e=this._objects,c=e.indexOf(this._activeObject)<e.indexOf(f),d=c?[this._activeObject,f]:[f,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(d,{canvas:this})},_groupSelectedObjects:function(f){var d=this._collectObjects(f),c;if(d.length===1){this.setActiveObject(d[0],f)}else{if(d.length>1){c=new fabric.ActiveSelection(d.reverse(),{canvas:this});this.setActiveObject(c,f)}}},_collectObjects:function(h){var p=[],k,d=this._groupSelector.ex,n=this._groupSelector.ey,c=d+this._groupSelector.left,l=n+this._groupSelector.top,j=new fabric.Point(b(d,c),b(n,l)),m=new fabric.Point(a(d,c),a(n,l)),g=!this.selectionFullyContained,o=d===c&&n===l;for(var f=this._objects.length;f--;){k=this._objects[f];if(!k||!k.selectable||!k.visible){continue}if((g&&k.intersectsWithRect(j,m,true))||k.isContainedWithinRect(j,m,true)||(g&&k.containsPoint(j,null,true))||(g&&k.containsPoint(m,null,true))){p.push(k);if(o){break}}}if(p.length>1){p=p.filter(function(e){return !e.onSelect({e:h})})}return p},_maybeGroupObjects:function(c){if(this.selection&&this._groupSelector){this._groupSelectedObjects(c)}this.setCursor(this.defaultCursor);this._groupSelector=null}})})();(function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var c=a.format||"png",e=a.quality||1,d=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),b=this.toCanvasElement(d,a);return fabric.util.toDataURL(b,c,e)},toCanvasElement:function(n,d){n=n||1;d=d||{};var i=(d.width||this.width)*n,k=(d.height||this.height)*n,o=this.getZoom(),c=this.width,h=this.height,j=o*n,a=this.viewportTransform,f=(a[4]-(d.left||0))*n,b=(a[5]-(d.top||0))*n,p=this.interactive,e=[j,0,0,j,f,b],m=this.enableRetinaScaling,g=fabric.util.createCanvasElement(),l=this.contextTop;g.width=i;g.height=k;this.contextTop=null;this.enableRetinaScaling=false;this.interactive=false;this.viewportTransform=e;this.width=i;this.height=k;this.calcViewportBoundaries();this.renderCanvas(g.getContext("2d"),this._objects);this.viewportTransform=a;this.width=c;this.height=h;this.calcViewportBoundaries();this.interactive=p;this.enableRetinaScaling=m;this.contextTop=l;return g},})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromJSON:function(b,g,a){if(!b){return}var d=(typeof b==="string")?JSON.parse(b):fabric.util.object.clone(b);var f=this,c=d.clipPath,e=this.renderOnAddRemove;this.renderOnAddRemove=false;delete d.clipPath;this._enlivenObjects(d.objects,function(h){f.clear();f._setBgOverlay(d,function(){if(c){f._enlivenObjects([c],function(i){f.clipPath=i[0];f.__setupCanvas.call(f,d,h,e,g)})}else{f.__setupCanvas.call(f,d,h,e,g)}})},a);return this},__setupCanvas:function(b,a,c,e){var d=this;a.forEach(function(g,f){d.insertAt(g,f)});this.renderOnAddRemove=c;delete b.objects;delete b.backgroundImage;delete b.overlayImage;delete b.background;delete b.overlay;this._setOptions(b);this.renderAll();e&&e()},_setBgOverlay:function(c,d){var b={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!c.backgroundImage&&!c.overlayImage&&!c.background&&!c.overlay){d&&d();return}var a=function(){if(b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor){d&&d()}};this.__setBgOverlay("backgroundImage",c.backgroundImage,b,a);this.__setBgOverlay("overlayImage",c.overlayImage,b,a);this.__setBgOverlay("backgroundColor",c.background,b,a);this.__setBgOverlay("overlayColor",c.overlay,b,a)},__setBgOverlay:function(c,b,a,e){var d=this;if(!b){a[c]=true;e&&e();return}if(c==="backgroundImage"||c==="overlayImage"){fabric.util.enlivenObjects([b],function(f){d[c]=f[0];a[c]=true;e&&e()})}else{this["set"+fabric.util.string.capitalize(c,true)](b,function(){a[c]=true;e&&e()})}},_enlivenObjects:function(b,c,a){if(!b||b.length===0){c&&c([]);return}fabric.util.enlivenObjects(b,function(d){c&&c(d)},null,a)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(c,a){var b=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(b,function(){c&&c(d)})})},cloneWithoutData:function(c){var a=fabric.util.createCanvasElement();a.width=this.width;a.height=this.height;var b=new fabric.Canvas(a);if(this.backgroundImage){b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();c&&c(b)});b.backgroundImageOpacity=this.backgroundImageOpacity;b.backgroundImageStretch=this.backgroundImageStretch}else{c&&c(b)}}});(function(b){var e=b.fabric||(b.fabric={}),h=e.util.object.extend,i=e.util.object.clone,d=e.util.toFixed,g=e.util.string.capitalize,c=e.util.degreesToRadians,a=!e.isLikelyNode,f=2;if(e.Object){return}e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,minScaleLimit:0,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,perPixelTargetFind:false,includeDefaultValues:true,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,objectCaching:a,statefullCache:false,noScaleCache:true,strokeUniform:false,dirty:true,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform").split(" "),cacheProperties:("fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath").split(" "),colorProperties:("fill stroke backgroundColor").split(" "),clipPath:undefined,inverted:false,absolutePositioned:false,initialize:function(j){if(j){this.setOptions(j)}},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=e.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext("2d");this._updateCacheCanvas();this.dirty=true},_limitCacheSize:function(s){var j=e.perfLimitSizeTotal,k=s.width,t=s.height,q=e.maxCacheSideLimit,m=e.minCacheSideLimit;if(k<=q&&t<=q&&k*t<=j){if(k<m){s.width=m}if(t<m){s.height=m}return s}var l=k/t,n=e.util.limitDimsByArea(l,j),o=e.util.capValue,r=o(m,n.x,q),p=o(m,n.y,q);if(k>r){s.zoomX/=k/r;s.width=r;s.capped=true}if(t>p){s.zoomY/=t/p;s.height=p;s.capped=true}return s},_getCacheCanvasDimensions:function(){var k=this.getTotalObjectScaling(),m=this._getTransformedDimensions(0,0),l=m.x*k.scaleX/this.scaleX,j=m.y*k.scaleY/this.scaleY;return{width:l+f,height:j+f,zoomX:k.scaleX,zoomY:k.scaleY,x:l,y:j}},_updateCacheCanvas:function(){var C=this.canvas;if(this.noScaleCache&&C&&C._currentTransform){var E=C._currentTransform.target,A=C._currentTransform.action;if(this===E&&A.slice&&A.slice(0,5)==="scale"){return false}}var m=this._cacheCanvas,x=this._limitCacheSize(this._getCacheCanvasDimensions()),j=e.minCacheSideLimit,y=x.width,w=x.height,n,t,r=x.zoomX,o=x.zoomY,B=y!==this.cacheWidth||w!==this.cacheHeight,p=this.zoomX!==r||this.zoomY!==o,v=B||p,s=0,z=0,q=false;if(B){var D=this._cacheCanvas.width,l=this._cacheCanvas.height,u=y>D||w>l,k=(y<D*0.9||w<l*0.9)&&D>j&&l>j;q=u||k;if(u&&!x.capped&&(y>j||w>j)){s=y*0.1;z=w*0.1}}if(v){if(q){m.width=Math.ceil(y+s);m.height=Math.ceil(w+z)}else{this._cacheContext.setTransform(1,0,0,1,0,0);this._cacheContext.clearRect(0,0,m.width,m.height)}n=x.x/2;t=x.y/2;this.cacheTranslationX=Math.round(m.width/2-n)+n;this.cacheTranslationY=Math.round(m.height/2-t)+t;this.cacheWidth=y;this.cacheHeight=w;this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY);this._cacheContext.scale(r,o);this.zoomX=r;this.zoomY=o;return true}return false},setOptions:function(j){this._setOptions(j);this._initGradient(j.fill,"fill");this._initGradient(j.stroke,"stroke");this._initPattern(j.fill,"fill");this._initPattern(j.stroke,"stroke")},transform:function(k){var l=(this.group&&!this.group._transformDone)||(this.group&&this.canvas&&k===this.canvas.contextTop);var j=this.calcTransformMatrix(!l);k.transform(j[0],j[1],j[2],j[3],j[4],j[5])},toObject:function(l){var k=e.Object.NUM_FRACTION_DIGITS,j={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:d(this.left,k),top:d(this.top,k),width:d(this.width,k),height:d(this.height,k),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,k),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:d(this.strokeMiterLimit,k),scaleX:d(this.scaleX,k),scaleY:d(this.scaleY,k),angle:d(this.angle,k),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,k),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:d(this.skewX,k),skewY:d(this.skewY,k),};if(this.clipPath&&!this.clipPath.excludeFromExport){j.clipPath=this.clipPath.toObject(l);j.clipPath.inverted=this.clipPath.inverted;j.clipPath.absolutePositioned=this.clipPath.absolutePositioned}e.util.populateWithProperties(this,j,l);if(!this.includeDefaultValues){j=this._removeDefaultValues(j)}return j},toDatalessObject:function(j){return this.toObject(j)},_removeDefaultValues:function(k){var j=e.util.getKlass(k.type).prototype,l=j.stateProperties;l.forEach(function(n){if(n==="left"||n==="top"){return}if(k[n]===j[n]){delete k[n]}var m=Object.prototype.toString.call(k[n])==="[object Array]"&&Object.prototype.toString.call(j[n])==="[object Array]";if(m&&k[n].length===0&&j[n].length===0){delete k[n]}});return k},toString:function(){return"#<fabric."+g(this.type)+">"},getObjectScaling:function(){if(!this.group){return{scaleX:this.scaleX,scaleY:this.scaleY,}}var j=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(j.scaleX),scaleY:Math.abs(j.scaleY)}},getTotalObjectScaling:function(){var n=this.getObjectScaling(),l=n.scaleX,k=n.scaleY;if(this.canvas){var m=this.canvas.getZoom();var j=this.canvas.getRetinaScaling();l*=m*j;k*=m*j}return{scaleX:l,scaleY:k}},getObjectOpacity:function(){var j=this.opacity;if(this.group){j*=this.group.getObjectOpacity()}return j},_set:function(l,m){var n=(l==="scaleX"||l==="scaleY"),j=this[l]!==m,k=false;if(n){m=this._constrainScale(m)}if(l==="scaleX"&&m<0){this.flipX=!this.flipX;m*=-1}else{if(l==="scaleY"&&m<0){this.flipY=!this.flipY;m*=-1}else{if(l==="shadow"&&m&&!(m instanceof e.Shadow)){m=new e.Shadow(m)}else{if(l==="dirty"&&this.group){this.group.set("dirty",m)}}}}this[l]=m;if(j){k=this.group&&this.group.isOnACache();if(this.cacheProperties.indexOf(l)>-1){this.dirty=true;k&&this.group.set("dirty",true)}else{if(k&&this.stateProperties.indexOf(l)>-1){this.group.set("dirty",true)}}}return this},setOnGroup:function(){},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||(!this.width&&!this.height&&this.strokeWidth===0)||!this.visible},render:function(j){if(this.isNotVisible()){return}if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return}j.save();this._setupCompositeOperation(j);this.drawSelectionBackground(j);this.transform(j);this._setOpacity(j);this._setShadow(j,this);if(this.shouldCache()){this.renderCache();this.drawCacheOnCanvas(j)}else{this._removeCacheCanvas();this.dirty=false;this.drawObject(j);if(this.objectCaching&&this.statefullCache){this.saveState({propertySet:"cacheProperties"})}}j.restore()},renderCache:function(j){j=j||{};if(!this._cacheCanvas){this._createCacheCanvas()}if(this.isCacheDirty()){this.statefullCache&&this.saveState({propertySet:"cacheProperties"});this.drawObject(this._cacheContext,j.forClipping);this.dirty=false}},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheWidth=0;this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){if(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow==="object"){return true}if(this.clipPath){return true}return false},shouldCache:function(){this.ownCaching=this.needsItsOwnCache()||(this.objectCaching&&(!this.group||!this.group.isOnACache()));return this.ownCaching},willDrawShadow:function(){return !!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(k){var l=this.clipPath;k.save();if(l.inverted){k.globalCompositeOperation="destination-out"}else{k.globalCompositeOperation="destination-in"}if(l.absolutePositioned){var j=e.util.invertTransform(this.calcTransformMatrix());k.transform(j[0],j[1],j[2],j[3],j[4],j[5])}l.transform(k);k.scale(1/l.zoomX,1/l.zoomY);k.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY);k.restore()},drawObject:function(k,j){var m=this.fill,l=this.stroke;if(j){this.fill="black";this.stroke="";this._setClippingProperties(k)}else{this._renderBackground(k)}this._render(k);this._drawClipPath(k);this.fill=m;this.stroke=l},_drawClipPath:function(j){var k=this.clipPath;if(!k){return}k.canvas=this.canvas;k.shouldCache();k._transformDone=true;k.renderCache({forClipping:true});this.drawClipPathOnCache(j)},drawCacheOnCanvas:function(j){j.scale(1/this.zoomX,1/this.zoomY);j.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(k){if(this.isNotVisible()){return false}if(this._cacheCanvas&&!k&&this._updateCacheCanvas()){return true}else{if(this.dirty||(this.clipPath&&this.clipPath.absolutePositioned)||(this.statefullCache&&this.hasStateChanged("cacheProperties"))){if(this._cacheCanvas&&!k){var l=this.cacheWidth/this.zoomX;var j=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-j/2,l,j)}return true}}return false},_renderBackground:function(j){if(!this.backgroundColor){return}var k=this._getNonTransformedDimensions();j.fillStyle=this.backgroundColor;j.fillRect(-k.x/2,-k.y/2,k.x,k.y);this._removeShadow(j)},_setOpacity:function(j){if(this.group&&!this.group._transformDone){j.globalAlpha=this.getObjectOpacity()}else{j.globalAlpha*=this.opacity}},_setStrokeStyles:function(k,j){var l=j.stroke;if(l){k.lineWidth=j.strokeWidth;k.lineCap=j.strokeLineCap;k.lineDashOffset=j.strokeDashOffset;k.lineJoin=j.strokeLineJoin;k.miterLimit=j.strokeMiterLimit;if(l.toLive){if(l.gradientUnits==="percentage"||l.gradientTransform||l.patternTransform){this._applyPatternForTransformedGradient(k,l)}else{k.strokeStyle=l.toLive(k,this);this._applyPatternGradientTransform(k,l)}}else{k.strokeStyle=j.stroke}}},_setFillStyles:function(k,j){var l=j.fill;if(l){if(l.toLive){k.fillStyle=l.toLive(k,this);this._applyPatternGradientTransform(k,j.fill)}else{k.fillStyle=l}}},_setClippingProperties:function(j){j.globalAlpha=1;j.strokeStyle="transparent";j.fillStyle="#000000"},_setLineDash:function(j,k){if(!k||k.length===0){return}if(1&k.length){k.push.apply(k,k)}j.setLineDash(k)},_renderControls:function(l,o){var p=this.getViewportTransform(),m=this.calcTransformMatrix(),n,j,k;o=o||{};j=typeof o.hasBorders!=="undefined"?o.hasBorders:this.hasBorders;k=typeof o.hasControls!=="undefined"?o.hasControls:this.hasControls;m=e.util.multiplyTransformMatrices(p,m);n=e.util.qrDecompose(m);l.save();l.translate(n.translateX,n.translateY);l.lineWidth=1*this.borderScaleFactor;if(!this.group){l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1}if(o.forActiveSelection){l.rotate(c(n.angle));j&&this.drawBordersInGroup(l,n,o)}else{l.rotate(c(this.angle));j&&this.drawBorders(l,o)}k&&this.drawControls(l,o);l.restore()},_setShadow:function(j){if(!this.shadow){return}var o=this.shadow,m=this.canvas,n,l=(m&&m.viewportTransform[0])||1,k=(m&&m.viewportTransform[3])||1;if(o.nonScaling){n={scaleX:1,scaleY:1}}else{n=this.getObjectScaling()}if(m&&m._isRetinaScaling()){l*=e.devicePixelRatio;k*=e.devicePixelRatio}j.shadowColor=o.color;j.shadowBlur=o.blur*e.browserShadowBlurConstant*(l+k)*(n.scaleX+n.scaleY)/4;j.shadowOffsetX=o.offsetX*l*n.scaleX;j.shadowOffsetY=o.offsetY*k*n.scaleY},_removeShadow:function(j){if(!this.shadow){return}j.shadowColor="";j.shadowBlur=j.shadowOffsetX=j.shadowOffsetY=0},_applyPatternGradientTransform:function(k,m){if(!m||!m.toLive){return{offsetX:0,offsetY:0}}var l=m.gradientTransform||m.patternTransform;var j=-this.width/2+m.offsetX||0,n=-this.height/2+m.offsetY||0;if(m.gradientUnits==="percentage"){k.transform(this.width,0,0,this.height,j,n)}else{k.transform(1,0,0,1,j,n)}if(l){k.transform(l[0],l[1],l[2],l[3],l[4],l[5])}return{offsetX:j,offsetY:n}},_renderPaintInOrder:function(j){if(this.paintFirst==="stroke"){this._renderStroke(j);this._renderFill(j)}else{this._renderFill(j);this._renderStroke(j)}},_render:function(){},_renderFill:function(j){if(!this.fill){return}j.save();this._setFillStyles(j,this);if(this.fillRule==="evenodd"){j.fill("evenodd")}else{j.fill()}j.restore()},_renderStroke:function(j){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(j)}j.save();if(this.strokeUniform&&this.group){var k=this.getObjectScaling();j.scale(1/k.scaleX,1/k.scaleY)}else{if(this.strokeUniform){j.scale(1/this.scaleX,1/this.scaleY)}}this._setLineDash(j,this.strokeDashArray);this._setStrokeStyles(j,this);j.stroke();j.restore()},_applyPatternForTransformedGradient:function(k,m){var p=this._limitCacheSize(this._getCacheCanvasDimensions()),q=e.util.createCanvasElement(),l,o=this.canvas.getRetinaScaling(),n=p.x/this.scaleX/o,j=p.y/this.scaleY/o;q.width=n;q.height=j;l=q.getContext("2d");l.beginPath();l.moveTo(0,0);l.lineTo(n,0);l.lineTo(n,j);l.lineTo(0,j);l.closePath();l.translate(n/2,j/2);l.scale(p.zoomX/this.scaleX/o,p.zoomY/this.scaleY/o);this._applyPatternGradientTransform(l,m);l.fillStyle=m.toLive(k);l.fill();k.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2);k.scale(o*this.scaleX/p.zoomX,o*this.scaleY/p.zoomY);k.strokeStyle=l.createPattern(q,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var j=e.util.qrDecompose(this.transformMatrix);this.flipX=false;this.flipY=false;this.set("scaleX",j.scaleX);this.set("scaleY",j.scaleY);this.angle=j.angle;this.skewX=j.skewX;this.skewY=0}},_removeTransformMatrix:function(k){var j=this._findCenterFromElement();if(this.transformMatrix){this._assignTransformMatrixProps();j=e.util.transformPoint(j,this.transformMatrix)}this.transformMatrix=null;if(k){this.scaleX*=k.scaleX;this.scaleY*=k.scaleY;this.cropX=k.cropX;this.cropY=k.cropY;j.x+=k.offsetLeft;j.y+=k.offsetTop;this.width=k.width;this.height=k.height}this.setPositionByOrigin(j,"center","center")},clone:function(l,k){var j=this.toObject(k);if(this.constructor.fromObject){this.constructor.fromObject(j,l)}else{e.Object._fromObject("Object",j,l)}},cloneAsImage:function(l,j){var k=this.toCanvasElement(j);if(l){l(new e.Image(k))}return this},toCanvasElement:function(l){l||(l={});var z=e.util,A=z.saveObjectTransform(this),x=this.group,q=this.shadow,u=Math.abs,p=(l.multiplier||1)*(l.enableRetinaScaling?e.devicePixelRatio:1);delete this.group;if(l.withoutTransform){z.resetObjectTransform(this)}if(l.withoutShadow){this.shadow=null}var j=e.util.createCanvasElement(),s=this.getBoundingRect(true,true),o=this.shadow,t,r={x:0,y:0},v,y,w;if(o){v=o.blur;if(o.nonScaling){t={scaleX:1,scaleY:1}}else{t=this.getObjectScaling()}r.x=2*Math.round(u(o.offsetX)+v)*(u(t.scaleX));r.y=2*Math.round(u(o.offsetY)+v)*(u(t.scaleY))}y=s.width+r.x;w=s.height+r.y;j.width=Math.ceil(y);j.height=Math.ceil(w);var k=new e.StaticCanvas(j,{enableRetinaScaling:false,renderOnAddRemove:false,skipOffscreen:false,});if(l.format==="jpeg"){k.backgroundColor="#fff"}this.setPositionByOrigin(new e.Point(k.width/2,k.height/2),"center","center");var n=this.canvas;k.add(this);var m=k.toCanvasElement(p||1,l);this.shadow=q;this.set("canvas",n);if(x){this.group=x}this.set(A).setCoords();k._objects=[];k.dispose();k=null;return m},toDataURL:function(j){j||(j={});return e.util.toDataURL(this.toCanvasElement(j),j.format||"png",j.quality||1)},isType:function(j){return this.type===j},complexity:function(){return 1},toJSON:function(j){return this.toObject(j)},rotate:function(k){var j=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(j){this._setOriginToCenter()}this.set("angle",k);if(j){this._resetOrigin()}return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},getLocalPointer:function(k,l){l=l||this.canvas.getPointer(k);var j=new e.Point(l.x,l.y),m=this._getLeftTopCoords();if(this.angle){j=e.util.rotatePoint(j,m,c(-this.angle))}return{x:j.x-m.x,y:j.y-m.y}},_setupCompositeOperation:function(j){if(this.globalCompositeOperation){j.globalCompositeOperation=this.globalCompositeOperation}}});e.util.createAccessors&&e.util.createAccessors(e.Object);h(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object._fromObject=function(m,l,n,k){var j=e[m];l=i(l,true);e.util.enlivenPatterns([l.fill,l.stroke],function(o){if(typeof o[0]!=="undefined"){l.fill=o[0]}if(typeof o[1]!=="undefined"){l.stroke=o[1]}e.util.enlivenObjects([l.clipPath],function(q){l.clipPath=q[0];var p=k?new j(l[k],l):new j(l);n&&n(p)})})};e.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.degreesToRadians,c={left:-0.5,center:0,right:0.5},b={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(m,e,d,k,i){var l=m.x,j=m.y,h,f,g;if(typeof e==="string"){e=c[e]}else{e-=0.5}if(typeof k==="string"){k=c[k]}else{k-=0.5}h=k-e;if(typeof d==="string"){d=b[d]}else{d-=0.5}if(typeof i==="string"){i=b[i]}else{i-=0.5}f=i-d;if(h||f){g=this._getTransformedDimensions();l=m.x+h*g.x;j=m.y+f*g.y}return new fabric.Point(l,j)},translateToCenterPoint:function(d,f,e){var g=this.translateToGivenOrigin(d,f,e,"center","center");if(this.angle){return fabric.util.rotatePoint(g,d,a(this.angle))}return g},translateToOriginPoint:function(d,f,e){var g=this.translateToGivenOrigin(d,"center","center",f,e);if(this.angle){return fabric.util.rotatePoint(g,d,a(this.angle))}return g},getCenterPoint:function(){var d=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(d,this.originX,this.originY)},getPointByOrigin:function(f,e){var d=this.getCenterPoint();return this.translateToOriginPoint(d,f,e)},toLocalPoint:function(e,g,f){var d=this.getCenterPoint(),i,h;if(typeof g!=="undefined"&&typeof f!=="undefined"){i=this.translateToGivenOrigin(d,"center","center",g,f)}else{i=new fabric.Point(this.left,this.top)}h=new fabric.Point(e.x,e.y);if(this.angle){h=fabric.util.rotatePoint(h,d,-a(this.angle))}return h.subtractEquals(i)},setPositionByOrigin:function(h,g,f){var e=this.translateToCenterPoint(h,g,f),d=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",d.x);this.set("top",d.y)},adjustPosition:function(j){var i=a(this.angle),g=this.getScaledWidth(),f=fabric.util.cos(i)*g,d=fabric.util.sin(i)*g,h,e;if(typeof this.originX==="string"){h=c[this.originX]}else{h=this.originX-0.5}if(typeof j==="string"){e=c[j]}else{e=j-0.5}this.left+=f*(e-h);this.top+=d*(e-h);this.setCoords();this.originX=j},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var d=this.getCenterPoint();this.originX="center";this.originY="center";this.left=d.x;this.top=d.y},_resetOrigin:function(){var d=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=d.x;this.top=d.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},})})();(function(){function d(f){return[new fabric.Point(f.tl.x,f.tl.y),new fabric.Point(f.tr.x,f.tr.y),new fabric.Point(f.br.x,f.br.y),new fabric.Point(f.bl.x,f.bl.y)]}var a=fabric.util,b=a.degreesToRadians,c=a.multiplyTransformMatrices,e=a.transformPoint;a.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(g,f){if(f){return(g?this.calcACoords():this.calcLineCoords())}if(!this.aCoords||!this.lineCoords){this.setCoords(true)}return(g?this.aCoords:this.lineCoords)},getCoords:function(g,f){return d(this._getCoords(g,f))},intersectsWithRect:function(f,h,k,g){var i=this.getCoords(k,g),j=fabric.Intersection.intersectPolygonRectangle(i,f,h);return j.status==="Intersection"},intersectsWithObject:function(f,i,g){var h=fabric.Intersection.intersectPolygonPolygon(this.getCoords(i,g),f.getCoords(i,g));return h.status==="Intersection"||f.isContainedWithinObject(this,i,g)||this.isContainedWithinObject(f,i,g)},isContainedWithinObject:function(f,m,j){var k=this.getCoords(m,j),l=m?f.aCoords:f.lineCoords,h=0,g=f._getImageLines(l);for(;h<4;h++){if(!f.containsPoint(k[h],g)){return false}}return true},isContainedWithinRect:function(f,i,j,h){var g=this.getBoundingRect(j,h);return(g.left>=f.x&&g.left+g.width<=i.x&&g.top>=f.y&&g.top+g.height<=i.y)},containsPoint:function(f,h,k,i){var j=this._getCoords(k,i),h=h||this._getImageLines(j),g=this._findCrossPoints(f,h);return(g!==0&&g%2===1)},isOnScreen:function(h){if(!this.canvas){return false}var f=this.canvas.vptCoords.tl,g=this.canvas.vptCoords.br;var i=this.getCoords(true,h);if(i.some(function(j){return j.x<=g.x&&j.x>=f.x&&j.y<=g.y&&j.y>=f.y})){return true}if(this.intersectsWithRect(f,g,true,h)){return true}return this._containsCenterOfCanvas(f,g,h)},_containsCenterOfCanvas:function(f,h,g){var i={x:(f.x+h.x)/2,y:(f.y+h.y)/2};if(this.containsPoint(i,null,true,g)){return true}return false},isPartiallyOnScreen:function(i){if(!this.canvas){return false}var g=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;if(this.intersectsWithRect(g,h,true,i)){return true}var f=this.getCoords(true,i).every(function(j){return(j.x>=h.x||j.x<=g.x)&&(j.y>=h.y||j.y<=g.y)});return f&&this._containsCenterOfCanvas(g,h,i)},_getImageLines:function(g){var f={topline:{o:g.tl,d:g.tr},rightline:{o:g.tr,d:g.br},bottomline:{o:g.br,d:g.bl},leftline:{o:g.bl,d:g.tl}};return f},_findCrossPoints:function(m,o){var l,k,g,f,j,i=0,h;for(var n in o){h=o[n];if((h.o.y<m.y)&&(h.d.y<m.y)){continue}if((h.o.y>=m.y)&&(h.d.y>=m.y)){continue}if((h.o.x===h.d.x)&&(h.o.x>=m.x)){j=h.o.x}else{l=0;k=(h.d.y-h.o.y)/(h.d.x-h.o.x);g=m.y-l*m.x;f=h.o.y-k*h.o.x;j=-(g-f)/(l-k)}if(j>=m.x){i+=1}if(i===2){break}}return i},getBoundingRect:function(h,f){var g=this.getCoords(h,f);return a.makeBoundingBoxFromPoints(g)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(f){if(Math.abs(f)<this.minScaleLimit){if(f<0){return -this.minScaleLimit}else{return this.minScaleLimit}}else{if(f===0){return 0.0001}}return f},scale:function(f){this._set("scaleX",f);this._set("scaleY",f);return this.setCoords()},scaleToWidth:function(g,h){var f=this.getBoundingRect(h).width/this.getScaledWidth();return this.scale(g/this.width/f)},scaleToHeight:function(g,h){var f=this.getBoundingRect(h).height/this.getScaledHeight();return this.scale(g/this.height/f)},calcCoords:function(f){if(f){return this.calcACoords()}return this.calcOCoords()},calcLineCoords:function(){var k=this.getViewportTransform(),n=this.padding,h=b(this.angle),p=a.cos(h),m=a.sin(h),o=p*n,f=m*n,g=o+f,i=o-f,j=this.calcACoords();var l={tl:e(j.tl,k),tr:e(j.tr,k),bl:e(j.bl,k),br:e(j.br,k),};if(n){l.tl.x-=i;l.tl.y-=g;l.tr.x+=g;l.tr.y-=i;l.bl.x-=g;l.bl.y+=i;l.br.x+=i;l.br.y+=g}return l},calcOCoords:function(){var l=this._calcRotateMatrix(),h=this._calcTranslateMatrix(),k=this.getViewportTransform(),g=c(k,h),f=c(g,l),f=c(f,[1/k[0],0,0,1/k[3],0,0]),j=this._calculateCurrentDimensions(),i={};this.forEachControl(function(o,m,n){i[m]=o.positionHandler(j,f,n)});return i},calcACoords:function(){var l=this._calcRotateMatrix(),j=this._calcTranslateMatrix(),g=c(j,l),k=this._getTransformedDimensions(),f=k.x/2,i=k.y/2;return{tl:e({x:-f,y:-i},g),tr:e({x:f,y:-i},g),bl:e({x:-f,y:i},g),br:e({x:f,y:i},g)}},setCoords:function(f){this.aCoords=this.calcACoords();this.lineCoords=this.group?this.aCoords:this.calcLineCoords();if(f){return this}this.oCoords=this.calcOCoords();this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){return a.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var f=this.getCenterPoint();return[1,0,0,1,f.x,f.y]},transformMatrixKey:function(g){var f="_",h="";if(!g&&this.group){h=this.group.transformMatrixKey(g)+f}return h+this.top+f+this.left+f+this.scaleX+f+this.scaleY+f+this.skewX+f+this.skewY+f+this.angle+f+this.originX+f+this.originY+f+this.width+f+this.height+f+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(i){var g=this.calcOwnMatrix();if(i||!this.group){return g}var h=this.transformMatrixKey(i),f=this.matrixCache||(this.matrixCache={});if(f.key===h){return f.value}if(this.group){g=c(this.group.calcTransformMatrix(false),g)}f.key=h;f.value=g;return g},calcOwnMatrix:function(){var h=this.transformMatrixKey(true),f=this.ownMatrixCache||(this.ownMatrixCache={});if(f.key===h){return f.value}var i=this._calcTranslateMatrix(),g={angle:this.angle,translateX:i[4],translateY:i[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY,};f.key=h;f.value=a.composeMatrix(g);return f.value},_calcDimensionsTransformMatrix:function(g,f,h){return a.calcDimensionsMatrix({skewX:g,skewY:f,scaleX:this.scaleX*(h&&this.flipX?-1:1),scaleY:this.scaleY*(h&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var i=this.strokeWidth,f=this.width+i,g=this.height+i;return{x:f,y:g}},_getTransformedDimensions:function(i,h){if(typeof i==="undefined"){i=this.skewX}if(typeof h==="undefined"){h=this.skewY}var j=this._getNonTransformedDimensions(),g,f,k=i===0&&h===0;if(this.strokeUniform){g=this.width;f=this.height}else{g=j.x;f=j.y}if(k){return this._finalizeDimensions(g*this.scaleX,f*this.scaleY)}var l=a.sizeAfterTransform(g,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:h,});return this._finalizeDimensions(l.x,l.y)},_finalizeDimensions:function(g,f){return this.strokeUniform?{x:g+this.strokeWidth,y:f+this.strokeWidth}:{x:g,y:f}},_calculateCurrentDimensions:function(){var h=this.getViewportTransform(),g=this._getTransformedDimensions(),f=e(g,h,true);return f.scalarAdd(2*this.padding)},})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{if(this.canvas){this.canvas.sendToBack(this)}}return this},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{if(this.canvas){this.canvas.bringToFront(this)}}return this},sendBackwards:function(a){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a)}else{if(this.canvas){this.canvas.sendBackwards(this,a)}}return this},bringForward:function(a){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a)}else{if(this.canvas){this.canvas.bringForward(this,a)}}return this},moveTo:function(a){if(this.group&&this.group.type!=="activeSelection"){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a)}else{if(this.canvas){this.canvas.moveTo(this,a)}}return this}});(function(){function b(g,e){if(!e){return g+": none; "}else{if(e.toLive){return g+": url(#SVGID_"+e.id+"); "}else{var c=new fabric.Color(e),f=g+": "+c.toRgb()+"; ",d=c.getAlpha();if(d!==1){f+=g+"-opacity: "+d.toString()+"; "}return f}}}var a=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(j){var g=this.fillRule?this.fillRule:"nonzero",l=this.strokeWidth?this.strokeWidth:"0",k=this.strokeDashArray?this.strokeDashArray.join(" "):"none",e=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",i=typeof this.opacity!=="undefined"?this.opacity:"1",c=this.visible?"":" visibility: hidden;",d=j?"":this.getSvgFilter(),n=b("fill",this.fill),m=b("stroke",this.stroke);return[m,"stroke-width: ",l,"; ","stroke-dasharray: ",k,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",e,"; ","stroke-linejoin: ",h,"; ","stroke-miterlimit: ",f,"; ",n,"fill-rule: ",g,"; ","opacity: ",i,";",d,c].join("")},getSvgSpanStyles:function(c,j){var d="; ";var g=c.fontFamily?"font-family: "+(((c.fontFamily.indexOf("'")===-1&&c.fontFamily.indexOf('"')===-1)?"'"+c.fontFamily+"'":c.fontFamily))+d:"";var i=c.strokeWidth?"stroke-width: "+c.strokeWidth+d:"",g=g,n=c.fontSize?"font-size: "+c.fontSize+"px"+d:"",f=c.fontStyle?"font-style: "+c.fontStyle+d:"",h=c.fontWeight?"font-weight: "+c.fontWeight+d:"",l=c.fill?b("fill",c.fill):"",k=c.stroke?b("stroke",c.stroke):"",m=this.getSvgTextDecoration(c),e=c.deltaY?"baseline-shift: "+(-c.deltaY)+"; ":"";if(m){m="text-decoration: "+m+d}return[k,i,g,n,f,h,m,l,e,j?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(c){return["overline","underline","line-through"].filter(function(d){return c[d.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':"",].join("")},getSvgTransform:function(e,c){var d=e?this.calcTransformMatrix():this.calcOwnMatrix(),f='transform="'+fabric.util.matrixToSVG(d);return f+(c||"")+'" '},_setSVGBg:function(d){if(this.backgroundColor){var c=fabric.Object.NUM_FRACTION_DIGITS;d.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,c),'" y="',a(-this.height/2,c),'" width="',a(this.width,c),'" height="',a(this.height,c),'"></rect>\n')}},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(c),{reviver:c})},toClipPathSVG:function(c){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(c),{reviver:c})},_createBaseClipPathSVGMarkup:function(g,f){f=f||{};var c=f.reviver,d=f.additionalTransform||"",h=[this.getSvgTransform(true,d),this.getSvgCommons(),].join(""),e=g.indexOf("COMMON_PARTS");g[e]=h;return c?c(g.join("")):g.join("")},_createBaseSVGMarkup:function(d,s){s=s||{};var i=s.noStyle,l=s.reviver,h=i?"":'style="'+this.getSvgStyles()+'" ',g=s.withShadow?'style="'+this.getSvgFilter()+'" ':"",k=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=k&&k.absolutePositioned,r=this.stroke,q=this.fill,o=this.shadow,n,p=[],e,j=d.indexOf("COMMON_PARTS"),m=s.additionalTransform;if(k){k.clipPathId="CLIPPATH_"+fabric.Object.__uid++;e='<clipPath id="'+k.clipPathId+'" >\n'+k.toClipPathSVG(l)+"</clipPath>\n"}if(f){p.push("<g ",g,this.getSvgCommons()," >\n")}p.push("<g ",this.getSvgTransform(false),!f?g+this.getSvgCommons():""," >\n");n=[h,c,i?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':"",].join("");d[j]=n;if(q&&q.toLive){p.push(q.toSVG(this))}if(r&&r.toLive){p.push(r.toSVG(this))}if(o){p.push(o.toSVG(this))}if(k){p.push(e)}p.push(d.join(""));p.push("</g>\n");f&&p.push("</g>\n");return l?l(p.join("")):p.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})})();(function(){var d=fabric.util.object.extend,a="stateProperties";function c(g,e,h){var i={},f=true;h.forEach(function(j){i[j]=g[j]});d(g[e],i,f)}function b(f,j,l){if(f===j){return true}else{if(Array.isArray(f)){if(!Array.isArray(j)||f.length!==j.length){return false}for(var h=0,e=f.length;h<e;h++){if(!b(f[h],j[h])){return false}}return true}else{if(f&&typeof f==="object"){var k=Object.keys(f),g;if(!j||typeof j!=="object"||(!l&&k.length!==Object.keys(j).length)){return false}for(var h=0,e=k.length;h<e;h++){g=k[h];if(g==="canvas"||g==="group"){continue}if(!b(f[g],j[g])){return false}}return true}}}}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(e){e=e||a;var f="_"+e;if(Object.keys(this[f]).length<this[e].length){return true}return !b(this[f],this,true)},saveState:function(g){var f=g&&g.propertySet||a,e="_"+f;if(!this[e]){return this.setupState(g)}c(this,e,this[f]);if(g&&g.stateProperties){c(this,e,g.stateProperties)}return this},setupState:function(f){f=f||{};var e=f.propertySet||a;f.propertySet=e;this["_"+e]={};this.saveState(f);return this}})})();(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(b,d){if(!this.hasControls||this.group||(!this.canvas||this.canvas._activeObject!==this)){return false}var h=b.x,g=b.y,c,l,k=Object.keys(this.oCoords),e=k.length-1,f;this.__corner=0;for(;e>=0;e--){f=k[e];if(!this.isControlVisible(f)){continue}l=this._getImageLines(d?this.oCoords[f].touchCorner:this.oCoords[f].corner);c=this._findCrossPoints({x:h,y:g},l);if(c!==0&&c%2===1){this.__corner=f;return f}}return false},forEachControl:function(c){for(var b in this.controls){c(this.controls[b],b,this)}},_setCornerCoords:function(){var c=this.oCoords;for(var d in c){var b=this.controls[d];c[d].corner=b.calcCornerCoords(this.angle,this.cornerSize,c[d].x,c[d].y,false);c[d].touchCorner=b.calcCornerCoords(this.angle,this.touchCornerSize,c[d].x,c[d].y,true)}},drawSelectionBackground:function(d){if(!this.selectionBackgroundColor||(this.canvas&&!this.canvas.interactive)||(this.canvas&&this.canvas._activeObject!==this)){return this}d.save();var b=this.getCenterPoint(),c=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;d.translate(b.x,b.y);d.scale(1/e[0],1/e[3]);d.rotate(a(this.angle));d.fillStyle=this.selectionBackgroundColor;d.fillRect(-c.x/2,-c.y/2,c.x,c.y);d.restore();return this},drawBorders:function(e,g){g=g||{};var d=this._calculateCurrentDimensions(),i=this.borderScaleFactor,f=d.x+i,b=d.y+i,h=typeof g.hasControls!=="undefined"?g.hasControls:this.hasControls,c=false;e.save();e.strokeStyle=g.borderColor||this.borderColor;this._setLineDash(e,g.borderDashArray||this.borderDashArray);e.strokeRect(-f/2,-b/2,f,b);if(h){e.beginPath();this.forEachControl(function(l,j,k){if(l.withConnection&&l.getVisibility(k,j)){c=true;e.moveTo(l.x*f,l.y*b);e.lineTo(l.x*f+l.offsetX,l.y*b+l.offsetY)}});if(c){e.stroke()}}e.restore();return this},drawBordersInGroup:function(i,j,f){f=f||{};var h=fabric.util.sizeAfterTransform(this.width,this.height,j),e=this.strokeWidth,d=this.strokeUniform,b=this.borderScaleFactor,c=h.x+e*(d?this.canvas.getZoom():j.scaleX)+b,g=h.y+e*(d?this.canvas.getZoom():j.scaleY)+b;i.save();this._setLineDash(i,f.borderDashArray||this.borderDashArray);i.strokeStyle=f.borderColor||this.borderColor;i.strokeRect(-c/2,-g/2,c,g);i.restore();return this},drawControls:function(b,c){c=c||{};b.save();b.setTransform(this.canvas.getRetinaScaling(),0,0,this.canvas.getRetinaScaling(),0,0);b.strokeStyle=b.fillStyle=c.cornerColor||this.cornerColor;if(!this.transparentCorners){b.strokeStyle=c.cornerStrokeColor||this.cornerStrokeColor}this._setLineDash(b,c.cornerDashArray||this.cornerDashArray);this.setCoords();this.forEachControl(function(f,d,e){if(f.getVisibility(e,d)){f.render(b,e.oCoords[d].x,e.oCoords[d].y,c,e)}});b.restore();return this},isControlVisible:function(b){return this.controls[b]&&this.controls[b].getVisibility(this,b)},setControlVisible:function(b,c){if(!this._controlsVisibility){this._controlsVisibility={}}this._controlsVisibility[b]=c;return this},setControlsVisibility:function(b){b||(b={});for(var c in b){this.setControlVisible(c,b[c])}return this},onDeselect:function(){},onSelect:function(){}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.requestRenderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.requestRenderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(g){b.set("opacity",g);f.requestRenderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var e=[],d,b;for(d in arguments[0]){e.push(d)}for(var c=0,a=e.length;c<a;c++){d=e[c];b=c!==a-1;this._animate(d,arguments[0][d],arguments[1],b)}}else{this._animate.apply(this,arguments)}return this},_animate:function(f,e,i,a){var b=this,d;e=e.toString();if(!i){i={}}else{i=fabric.util.object.clone(i)}if(~f.indexOf(".")){d=f.split(".")}var c=b.colorProperties.indexOf(f)>-1||(d&&b.colorProperties.indexOf(d[1])>-1);var g=d?this.get(d[0])[d[1]]:this.get(f);if(!("from" in i)){i.from=g}if(!c){if(~e.indexOf("=")){e=g+parseFloat(e.replace("=",""))}else{e=parseFloat(e)}}var h={startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(b)},onChange:function(l,j,k){if(d){b[d[0]][d[1]]=l}else{b.set(f,l)}if(a){return}i.onChange&&i.onChange(l,j,k)},onComplete:function(l,j,k){if(a){return}b.setCoords();i.onComplete&&i.onComplete(l,j,k)}};if(c){fabric.util.animateColor(h.startValue,h.endValue,h.duration,h)}else{fabric.util.animate(h)}}});(function(b){var c=b.fabric||(b.fabric={}),f=c.util.object.extend,e=c.util.object.clone,a={x1:1,x2:1,y1:1,y2:1};if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,g){if(!h){h=[0,0,0,0]}this.callSuper("initialize",g);this.set("x1",h[0]);this.set("y1",h[1]);this.set("x2",h[2]);this.set("y2",h[3]);this._setWidthHeight(g)},_setWidthHeight:function(g){g||(g={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left" in g?g.left:this._getLeftToOriginX();this.top="top" in g?g.top:this._getTopToOriginY()},_set:function(g,h){this.callSuper("_set",g,h);if(typeof a[g]!=="undefined"){this._setWidthHeight()}return this},_getLeftToOriginX:d({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:d({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(g){g.beginPath();var h=this.calcLinePoints();g.moveTo(h.x1,h.y1);g.lineTo(h.x2,h.y2);g.lineWidth=this.strokeWidth;var i=g.strokeStyle;g.strokeStyle=this.stroke||g.fillStyle;this.stroke&&this._renderStroke(g);g.strokeStyle=i},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2,}},toObject:function(g){return f(this.callSuper("toObject",g),this.calcLinePoints())},_getNonTransformedDimensions:function(){var g=this.callSuper("_getNonTransformedDimensions");if(this.strokeLineCap==="butt"){if(this.width===0){g.y-=this.strokeWidth}if(this.height===0){g.x-=this.strokeWidth}}return g},calcLinePoints:function(){var l=this.x1<=this.x2?-1:1,k=this.y1<=this.y2?-1:1,h=(l*this.width*0.5),j=(k*this.height*0.5),g=(l*this.width*-0.5),i=(k*this.height*-0.5);return{x1:h,x2:g,y1:j,y2:i}},_toSVG:function(){var g=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',g.x1,'" y1="',g.y1,'" x2="',g.x2,'" y2="',g.y2,'" />\n']},});c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));c.Line.fromElement=function(h,k,g){g=g||{};var j=c.parseAttributes(h,c.Line.ATTRIBUTE_NAMES),i=[j.x1||0,j.y1||0,j.x2||0,j.y2||0];k(new c.Line(i,f(j,g)))};c.Line.fromObject=function(i,j){function g(k){delete k.points;j&&j(k)}var h=e(i,true);h.points=[i.x1,i.y1,i.x2,i.y2];c.Object._fromObject("Line",h,g,"points")};function d(h,m){var k=h.origin,n=h.axis1,l=h.axis2,j=h.dimension,i=m.nearest,g=m.center,o=m.farthest;return function(){switch(this.get(k)){case i:return Math.min(this.get(n),this.get(l));case g:return Math.min(this.get(n),this.get(l))+(0.5*this.get(j));case o:return Math.max(this.get(n),this.get(l))}}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:d*2,cacheProperties:b.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,f){this.callSuper("_set",e,f);if(e==="radius"){this.setRadius(f)}return this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,j=0,i=0,f=(this.endAngle-this.startAngle)%(2*d);if(f===0){e=["<circle ","COMMON_PARTS",'cx="'+j+'" cy="'+i+'" ','r="',this.radius,'" />\n']}else{var h=b.util.cos(this.startAngle)*this.radius,g=b.util.sin(this.startAngle)*this.radius,l=b.util.cos(this.endAngle)*this.radius,k=b.util.sin(this.endAngle)*this.radius,m=f>d?"1":"0";e=['<path d="M '+h+" "+g," A "+this.radius+" "+this.radius," 0 ",+m+" 1"," "+l+" "+k,'" ',"COMMON_PARTS"," />\n"]}return e},_render:function(e){e.beginPath();e.arc(0,0,this.radius,this.startAngle,this.endAngle,false);this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){this.radius=e;return this.set("width",e*2).set("height",e*2)},});b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));b.Circle.fromElement=function(e,g){var f=b.parseAttributes(e,b.Circle.ATTRIBUTE_NAMES);if(!c(f)){throw new Error("value of `r` attribute is required and can not be negative")}f.left=(f.left||0)-f.radius;f.top=(f.top||0)-f.radius;g(new b.Circle(f))};function c(e){return(("radius" in e)&&(e.radius>=0))}b.Circle.fromObject=function(e,f){b.Object._fromObject("Circle",e,f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",width:100,height:100,_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();this._renderPaintInOrder(c)},_toSVG:function(){var c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return["<polygon ","COMMON_PARTS",'points="',e,'" />']},});b.Triangle.fromObject=function(c,d){return b.Object._fromObject("Triangle",c,d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d);this.set("rx",d&&d.rx||0);this.set("ry",d&&d.ry||0)},_set:function(d,e){this.callSuper("_set",d,e);switch(d){case"rx":this.rx=e;this.set("width",e*2);break;case"ry":this.ry=e;this.set("height",e*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(d){d.beginPath();d.save();d.transform(1,0,0,this.ry/this.rx,0,0);d.arc(0,0,this.rx,0,c,false);d.restore();this._renderPaintInOrder(d)},});b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));b.Ellipse.fromElement=function(d,f){var e=b.parseAttributes(d,b.Ellipse.ATTRIBUTE_NAMES);e.left=(e.left||0)-e.rx;e.top=(e.top||0)-e.ry;f(new b.Ellipse(e))};b.Ellipse.fromObject=function(d,e){b.Object._fromObject("Ellipse",d,e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect){b.warn("fabric.Rect is already defined");return}b.Rect=b.util.createClass(b.Object,{stateProperties:b.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(n){var e=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,m=this.width,g=this.height,l=-this.width/2,i=-this.height/2,j=e!==0||d!==0,f=1-0.5522847498;n.beginPath();n.moveTo(l+e,i);n.lineTo(l+m-e,i);j&&n.bezierCurveTo(l+m-f*e,i,l+m,i+f*d,l+m,i+d);n.lineTo(l+m,i+g-d);j&&n.bezierCurveTo(l+m,i+g-f*d,l+m-f*e,i+g,l+m-e,i+g);n.lineTo(l+e,i+g);j&&n.bezierCurveTo(l+f*e,i+g,l,i+g-f*d,l,i+g-d);n.lineTo(l,i+d);j&&n.bezierCurveTo(l,i+f*d,l+f*e,i,l+e,i);n.closePath();this._renderPaintInOrder(n)},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){var d=-this.width/2,e=-this.height/2;return["<rect ","COMMON_PARTS",'x="',d,'" y="',e,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']},});b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));b.Rect.fromElement=function(e,h,d){if(!e){return h(null)}d=d||{};var g=b.parseAttributes(e,b.Rect.ATTRIBUTE_NAMES);g.left=g.left||0;g.top=g.top||0;g.height=g.height||0;g.width=g.width||0;var f=new b.Rect(c((d?b.util.object.clone(d):{}),g));f.visible=f.visible&&f.width>0&&f.height>0;h(f)};b.Rect.fromObject=function(d,e){return b.Object._fromObject("Rect",d,e)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(h,g){g=g||{};this.points=h||[];this.callSuper("initialize",g);this._setPositionDimensions(g)},_setPositionDimensions:function(i){var h=this._calcDimensions(i),g;this.width=h.width;this.height=h.height;if(!i.fromSVG){g=this.translateToGivenOrigin({x:h.left-this.strokeWidth/2,y:h.top-this.strokeWidth/2},"left","top",this.originX,this.originY)}if(typeof i.left==="undefined"){this.left=i.fromSVG?h.left:g.x}if(typeof i.top==="undefined"){this.top=i.fromSVG?h.top:g.y}this.pathOffset={x:h.left+this.width/2,y:h.top+this.height/2}},_calcDimensions:function(){var j=this.points,h=c(j,"x")||0,m=c(j,"y")||0,l=b(j,"x")||0,k=b(j,"y")||0,i=(l-h),g=(k-m);return{left:h,top:m,width:i,height:g}},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},_toSVG:function(){var m=[],j=this.pathOffset.x,h=this.pathOffset.y,l=e.Object.NUM_FRACTION_DIGITS;for(var k=0,g=this.points.length;k<g;k++){m.push(a(this.points[k].x-j,l),",",a(this.points[k].y-h,l)," ")}return["<"+this.type+" ","COMMON_PARTS",'points="',m.join(""),'" />\n']},commonRender:function(k){var j,h=this.points.length,g=this.pathOffset.x,m=this.pathOffset.y;if(!h||isNaN(this.points[h-1].y)){return false}k.beginPath();k.moveTo(this.points[0].x-g,this.points[0].y-m);for(var l=0;l<h;l++){j=this.points[l];k.lineTo(j.x-g,j.y-m)}return true},_render:function(g){if(!this.commonRender(g)){return}this._renderPaintInOrder(g)},complexity:function(){return this.get("points").length}});e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polyline.fromElementGenerator=function(g){return function(i,l,h){if(!i){return l(null)}h||(h={});var j=e.parsePointsAttribute(i.getAttribute("points")),k=e.parseAttributes(i,e[g].ATTRIBUTE_NAMES);k.fromSVG=true;l(new e[g](j,f(k,h)))}};e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline");e.Polyline.fromObject=function(g,h){return e.Object._fromObject("Polyline",g,h,"points")}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Polygon){b.warn("fabric.Polygon is already defined");return}b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(c){if(!this.commonRender(c)){return}c.closePath();this._renderPaintInOrder(c)},});b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat();b.Polygon.fromElement=b.Polyline.fromElementGenerator("Polygon");b.Polygon.fromObject=function(c,d){b.Object._fromObject("Polygon",c,d,"points")}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),c=e.util.array.min,b=e.util.array.max,g=e.util.object.extend,f=Object.prototype.toString,a=e.util.toFixed;if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(j,i){i=i||{};this.callSuper("initialize",i);if(!j){j=[]}var h=f.call(j)==="[object Array]";this.path=h?e.util.makePathSimpler(j):e.util.makePathSimpler(e.util.parsePath(j));if(!this.path){return}e.Polyline.prototype._setPositionDimensions.call(this,i)},_renderPathCommands:function(s){var n,u=0,r=0,p=0,o=0,h=0,v=0,j=-this.pathOffset.x,q=-this.pathOffset.y;s.beginPath();for(var k=0,m=this.path.length;k<m;++k){n=this.path[k];switch(n[0]){case"L":p=n[1];o=n[2];s.lineTo(p+j,o+q);break;case"M":p=n[1];o=n[2];u=p;r=o;s.moveTo(p+j,o+q);break;case"C":p=n[5];o=n[6];h=n[3];v=n[4];s.bezierCurveTo(n[1]+j,n[2]+q,h+j,v+q,p+j,o+q);break;case"Q":s.quadraticCurveTo(n[1]+j,n[2]+q,n[3]+j,n[4]+q);p=n[3];o=n[4];h=n[1];v=n[2];break;case"z":case"Z":p=u;o=r;s.closePath();break}}},_render:function(h){this._renderPathCommands(h);this._renderPaintInOrder(h)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(h){return g(this.callSuper("toObject",h),{path:this.path.map(function(i){return i.slice()}),})},toDatalessObject:function(i){var h=this.toObject(["sourcePath"].concat(i));if(h.sourcePath){delete h.path}return h},_toSVG:function(){var h=this.path.map(function(i){return i.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',h,'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var h=e.Object.NUM_FRACTION_DIGITS;return" translate("+a(-this.pathOffset.x,h)+", "+a(-this.pathOffset.y,h)+")"},toClipPathSVG:function(h){var i=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:h,additionalTransform:i})},toSVG:function(h){var i=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,additionalTransform:i})},complexity:function(){return this.path.length},_calcDimensions:function(){var r=[],p=[],t,z=0,w=0,v=0,u=0,j;for(var q=0,s=this.path.length;q<s;++q){t=this.path[q];switch(t[0]){case"L":v=t[1];u=t[2];j=[];break;case"M":v=t[1];u=t[2];z=v;w=u;j=[];break;case"C":j=e.util.getBoundsOfCurve(v,u,t[1],t[2],t[3],t[4],t[5],t[6]);v=t[5];u=t[6];break;case"Q":j=e.util.getBoundsOfCurve(v,u,t[1],t[2],t[1],t[2],t[3],t[4]);v=t[3];u=t[4];break;case"z":case"Z":v=z;u=w;break}j.forEach(function(i){r.push(i.x);p.push(i.y)});r.push(v);p.push(u)}var m=c(r)||0,l=c(p)||0,k=b(r)||0,h=b(p)||0,o=k-m,n=h-l;return{left:m,top:l,width:o,height:n}}});e.Path.fromObject=function(h,j){if(typeof h.sourcePath==="string"){var i=h.sourcePath;e.loadSVGFromURL(i,function(k){var l=k[0];l.setOptions(h);j&&j(l)})}else{e.Object._fromObject("Path",h,j,"path")}};e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]);e.Path.fromElement=function(i,k,h){var j=e.parseAttributes(i,e.Path.ATTRIBUTE_NAMES);j.fromSVG=true;k(new e.Path(j.d,g(j,h)))}})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),b=d.util.array.min,a=d.util.array.max;if(d.Group){return}d.Group=d.util.createClass(d.Object,d.Collection,{type:"group",strokeWidth:0,subTargetCheck:false,cacheProperties:[],useSetOnGroup:false,initialize:function(h,f,j){f=f||{};this._objects=[];j&&this.callSuper("initialize",f);this._objects=h||[];for(var g=this._objects.length;g--;){this._objects[g].group=this}if(!j){var e=f&&f.centerPoint;if(f.originX!==undefined){this.originX=f.originX}if(f.originY!==undefined){this.originY=f.originY}e||this._calcBounds();this._updateObjectsCoords(e);delete f.centerPoint;this.callSuper("initialize",f)}else{this._updateObjectsACoords()}this.setCoords()},_updateObjectsACoords:function(){var f=true;for(var e=this._objects.length;e--;){this._objects[e].setCoords(f)}},_updateObjectsCoords:function(e){var e=e||this.getCenterPoint();for(var f=this._objects.length;f--;){this._updateObjectCoords(this._objects[f],e)}},_updateObjectCoords:function(f,e){var g=f.left,i=f.top,h=true;f.set({left:g-e.x,top:i-e.y});f.group=this;f.setCoords(h)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){var f=!!this.group;this._restoreObjectsState();d.util.resetObjectTransform(this);if(e){if(f){d.util.removeTransformFromObject(e,this.group.calcTransformMatrix())}this._objects.push(e);e.group=this;e._set("canvas",this.canvas)}this._calcBounds();this._updateObjectsCoords();this.dirty=true;if(f){this.group.addWithUpdate()}else{this.setCoords()}return this},removeWithUpdate:function(e){this._restoreObjectsState();d.util.resetObjectTransform(this);this.remove(e);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this},_onObjectAdded:function(e){this.dirty=true;e.group=this;e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=true;delete e.group},_set:function(f,g){var e=this._objects.length;if(this.useSetOnGroup){while(e--){this._objects[e].setOnGroup(f,g)}}if(f==="canvas"){while(e--){this._objects[e]._set(f,g)}}d.Object.prototype._set.call(this,f,g)},toObject:function(h){var e=this.includeDefaultValues;var g=this._objects.filter(function(i){return !i.excludeFromExport}).map(function(j){var i=j.includeDefaultValues;j.includeDefaultValues=e;var k=j.toObject(h);j.includeDefaultValues=i;return k});var f=d.Object.prototype.toObject.call(this,h);f.objects=g;return f},toDatalessObject:function(i){var h,f=this.sourcePath;if(f){h=f}else{var e=this.includeDefaultValues;h=this._objects.map(function(k){var j=k.includeDefaultValues;k.includeDefaultValues=e;var l=k.toDatalessObject(i);k.includeDefaultValues=j;return l})}var g=d.Object.prototype.toDatalessObject.call(this,i);g.objects=h;return g},render:function(e){this._transformDone=true;this.callSuper("render",e);this._transformDone=false},shouldCache:function(){var g=d.Object.prototype.shouldCache.call(this);if(g){for(var f=0,e=this._objects.length;f<e;f++){if(this._objects[f].willDrawShadow()){this.ownCaching=false;return false}}}return g},willDrawShadow:function(){if(d.Object.prototype.willDrawShadow.call(this)){return true}for(var f=0,e=this._objects.length;f<e;f++){if(this._objects[f].willDrawShadow()){return true}}return false},isOnACache:function(){return this.ownCaching||(this.group&&this.group.isOnACache())},drawObject:function(f){for(var g=0,e=this._objects.length;g<e;g++){this._objects[g].render(f)}this._drawClipPath(f)},isCacheDirty:function(g){if(this.callSuper("isCacheDirty",g)){return true}if(!this.statefullCache){return false}for(var h=0,f=this._objects.length;h<f;h++){if(this._objects[h].isCacheDirty(true)){if(this._cacheCanvas){var e=this.cacheWidth/this.zoomX,j=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-j/2,e,j)}return true}}return false},_restoreObjectsState:function(){var e=this.calcOwnMatrix();this._objects.forEach(function(f){d.util.addTransformToObject(f,e);delete f.group;f.setCoords()});return this},realizeTransform:function(e,f){d.util.addTransformToObject(e,f);return e},destroy:function(){this._objects.forEach(function(e){e.set("dirty",true)});return this._restoreObjectsState()},toActiveSelection:function(){if(!this.canvas){return}var g=this._objects,f=this.canvas;this._objects=[];var e=this.toObject();delete e.objects;var h=new d.ActiveSelection([]);h.set(e);h.type="activeSelection";f.remove(this);g.forEach(function(i){i.group=h;i.dirty=true;f.add(i)});h.canvas=f;h._objects=g;f._activeObject=h;h.setCoords();return h},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var e=true;this.forEachObject(function(f){f.setCoords(e)});return this},_calcBounds:function(h){var m=[],l=[],f,e,q,p=["tr","br","bl","tl"],n=0,g=this._objects.length,k,r=p.length;for(;n<g;++n){f=this._objects[n];q=f.calcACoords();for(k=0;k<r;k++){e=p[k];m.push(q[e].x);l.push(q[e].y)}f.aCoords=q}this._getBounds(m,l,h)},_getBounds:function(i,h,f){var j=new d.Point(b(i),b(h)),l=new d.Point(a(i),a(h)),k=j.y||0,g=j.x||0,e=(l.x-j.x)||0,m=(l.y-j.y)||0;this.width=e;this.height=m;if(!f){this.setPositionByOrigin({x:g,y:k},"left","top")}},_toSVG:function(f){var h=["<g ","COMMON_PARTS"," >\n"];for(var g=0,e=this._objects.length;g<e;g++){h.push("\t\t",this._objects[g].toSVG(f))}h.push("</g>\n");return h},getSvgStyles:function(){var f=typeof this.opacity!=="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",e=this.visible?"":" visibility: hidden;";return[f,this.getSvgFilter(),e].join("")},toClipPathSVG:function(f){var h=[];for(var g=0,e=this._objects.length;g<e;g++){h.push("\t",this._objects[g].toClipPathSVG(f))}return this._createBaseClipPathSVGMarkup(h,{reviver:f})},});d.Group.fromObject=function(f,h){var g=f.objects,e=d.util.object.clone(f,true);delete e.objects;if(typeof g==="string"){d.loadSVGFromURL(g,function(i){var j=d.util.groupSVGElements(i,f,g);j.set(e);h&&h(j)});return}d.util.enlivenObjects(g,function(i){d.util.enlivenObjects([f.clipPath],function(j){var k=d.util.object.clone(f,true);k.clipPath=j[0];delete k.objects;h&&h(new d.Group(i,k,true))})})}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.ActiveSelection){return}b.ActiveSelection=b.util.createClass(b.Group,{type:"activeSelection",initialize:function(e,c){c=c||{};this._objects=e||[];for(var d=this._objects.length;d--;){this._objects[d].group=this}if(c.originX){this.originX=c.originX}if(c.originY){this.originY=c.originY}this._calcBounds();this._updateObjectsCoords();b.Object.prototype.initialize.call(this,c);this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var d=b.Object.prototype.toObject.call(this);var f=new b.Group([]);delete d.type;f.set(d);e.forEach(function(g){g.canvas.remove(g);g.group=f});f._objects=e;if(!this.canvas){return f}var c=this.canvas;c.add(f);c._activeObject=f;f.setCoords();return f},onDeselect:function(){this.destroy();return false},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return false},isOnACache:function(){return false},_renderControls:function(d,g,f){d.save();d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper("_renderControls",d,g);f=f||{};if(typeof f.hasControls==="undefined"){f.hasControls=false}f.forActiveSelection=true;for(var e=0,c=this._objects.length;e<c;e++){this._objects[e]._renderControls(d,f)}d.restore()},});b.ActiveSelection.fromObject=function(c,d){b.util.enlivenObjects(c.objects,function(e){delete c.objects;d&&d(new b.ActiveSelection(e,c,true))})}})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",strokeWidth:0,srcFromAttribute:false,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:0.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:fabric.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:true,initialize:function(d,c){c||(c={});this.filters=[];this.cacheKey="texture"+fabric.Object.__uid++;this.callSuper("initialize",c);this._initElement(d,c)},getElement:function(){return this._element||{}},setElement:function(d,c){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+"_filtered");this._element=d;this._originalElement=d;this._initConfig(c);if(this.filters.length!==0){this.applyFilters()}if(this.resizeFilter){this.applyResizeFilters()}return this},removeTexture:function(d){var c=fabric.filterBackend;if(c&&c.evictCachesForKey){c.evictCachesForKey(d)}},dispose:function(){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+"_filtered");this._cacheContext=undefined;["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(c){fabric.util.cleanUpJsdomNode(this[c]);this[c]=undefined}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var c=this.getElement();return{width:c.naturalWidth||c.width,height:c.naturalHeight||c.height}},_stroke:function(d){if(!this.stroke||this.strokeWidth===0){return}var c=this.width/2,e=this.height/2;d.beginPath();d.moveTo(-c,-e);d.lineTo(c,-e);d.lineTo(c,e);d.lineTo(-c,e);d.lineTo(-c,-e);d.closePath()},toObject:function(e){var d=[];this.filters.forEach(function(f){if(f){d.push(f.toObject())}});var c=b(this.callSuper("toObject",["cropX","cropY"].concat(e)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:d,});if(this.resizeFilter){c.resizeFilter=this.resizeFilter.toObject()}return c},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var c=[],g=[],f,e=this._element,k=-this.width/2,j=-this.height/2,i="",h="";if(!e){return[]}if(this.hasCrop()){var l=fabric.Object.__uid++;c.push('<clipPath id="imageCrop_'+l+'">\n','\t<rect x="'+k+'" y="'+j+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n");i=' clip-path="url(#imageCrop_'+l+')" '}if(!this.imageSmoothing){h='" image-rendering="optimizeSpeed'}g.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(true),'" x="',k-this.cropX,'" y="',j-this.cropY,'" width="',e.width||e.naturalWidth,'" height="',e.height||e.height,h,'"',i,"></image>\n");if(this.stroke||this.strokeDashArray){var d=this.fill;this.fill=null;f=["\t<rect ",'x="',k,'" y="',j,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'];this.fill=d}if(this.paintFirst!=="fill"){c=c.concat(f,g)}else{c=c.concat(g,f)}return c},getSrc:function(c){var d=c?this._element:this._originalElement;if(d){if(d.toDataURL){return d.toDataURL()}if(this.srcFromAttribute){return d.getAttribute("src")}else{return d.src}}else{return this.src||""}},setSrc:function(d,e,c){fabric.util.loadImage(d,function(f,g){this.setElement(f,c);this._setWidthHeight();e&&e(this,g)},this,c&&c.crossOrigin);return this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,c=this.minimumScaleTrigger,h=this.getTotalObjectScaling(),l=h.scaleX,k=h.scaleY,i=this._filteredEl||this._originalElement;if(this.group){this.set("dirty",true)}if(!e||(l>c&&k>c)){this._element=i;this._filterScalingX=1;this._filterScalingY=1;this._lastScaleX=l;this._lastScaleY=k;return}if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend()}var g=fabric.util.createCanvasElement(),j=this._filteredEl?(this.cacheKey+"_filtered"):this.cacheKey,d=i.width,f=i.height;g.width=d;g.height=f;this._element=g;this._lastScaleX=e.scaleX=l;this._lastScaleY=e.scaleY=k;fabric.filterBackend.applyFilters([e],i,d,f,this._element,j);this._filterScalingX=g.width/this._originalElement.width;this._filterScalingY=g.height/this._originalElement.height},applyFilters:function(e){e=e||this.filters||[];e=e.filter(function(h){return h&&!h.isNeutralState()});this.set("dirty",true);this.removeTexture(this.cacheKey+"_filtered");if(e.length===0){this._element=this._originalElement;this._filteredEl=null;this._filterScalingX=1;this._filterScalingY=1;return this}var g=this._originalElement,c=g.naturalWidth||g.width,f=g.naturalHeight||g.height;if(this._element===this._originalElement){var d=fabric.util.createCanvasElement();d.width=c;d.height=f;this._element=d;this._filteredEl=d}else{this._element=this._filteredEl;this._filteredEl.getContext("2d").clearRect(0,0,c,f);this._lastScaleX=1;this._lastScaleY=1}if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend()}fabric.filterBackend.applyFilters(e,this._originalElement,c,f,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height){this._filterScalingX=this._element.width/this._originalElement.width;this._filterScalingY=this._element.height/this._originalElement.height}return this},_render:function(c){fabric.util.setImageSmoothing(c,this.imageSmoothing);if(this.isMoving!==true&&this.resizeFilter&&this._needsResize()){this.applyResizeFilters()}this._stroke(c);this._renderPaintInOrder(c)},drawCacheOnCanvas:function(c){fabric.util.setImageSmoothing(c,this.imageSmoothing);fabric.Object.prototype.drawCacheOnCanvas.call(this,c)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(p){var g=this._element;if(!g){return}var z=this._filterScalingX,v=this._filterScalingY,k=this.width,u=this.height,r=Math.min,t=Math.max,s=t(this.cropX,0),q=t(this.cropY,0),n=g.naturalWidth||g.width,m=g.naturalHeight||g.height,e=s*z,d=q*v,f=r(k*z,n-e),o=r(u*v,m-d),j=-k/2,i=-u/2,c=r(k,n/z-s),l=r(u,m/v-q);g&&p.drawImage(g,e,d,f,o,j,i,c,l)},_needsResize:function(){var c=this.getTotalObjectScaling();return(c.scaleX!==this._lastScaleX||c.scaleY!==this._lastScaleY)},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(d,c){this.setElement(fabric.util.getById(d),c);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c)},_initFilters:function(c,d){if(c&&c.length){fabric.util.enlivenObjects(c,function(e){d&&d(e)},"fabric.Image.filters")}else{d&&d()}},_setWidthHeight:function(c){c||(c={});var d=this.getElement();this.width=c.width||d.naturalWidth||d.width||0;this.height=c.height||d.naturalHeight||d.height||0},parsePreserveAspectRatioAttribute:function(){var c=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),k=this._element.width,o=this._element.height,l=1,i=1,f=0,d=0,n=0,m=0,g,e=this.width,j=this.height,h={width:e,height:j};if(c&&(c.alignX!=="none"||c.alignY!=="none")){if(c.meetOrSlice==="meet"){l=i=fabric.util.findScaleToFit(this._element,h);g=(e-k*l)/2;if(c.alignX==="Min"){f=-g}if(c.alignX==="Max"){f=g}g=(j-o*i)/2;if(c.alignY==="Min"){d=-g}if(c.alignY==="Max"){d=g}}if(c.meetOrSlice==="slice"){l=i=fabric.util.findScaleToCover(this._element,h);g=k-e/l;if(c.alignX==="Mid"){n=g/2}if(c.alignX==="Max"){n=g}g=o-j/i;if(c.alignY==="Mid"){m=g/2}if(c.alignY==="Max"){m=g}k=e/l;o=j/i}}else{l=e/k;i=j/o}return{width:k,height:o,scaleX:l,scaleY:i,offsetLeft:f,offsetTop:d,cropX:n,cropY:m}}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(d,e){var c=fabric.util.object.clone(d);fabric.util.loadImage(c.src,function(f,g){if(g){e&&e(null,true);return}fabric.Image.prototype._initFilters.call(c,c.filters,function(h){c.filters=h||[];fabric.Image.prototype._initFilters.call(c,[c.resizeFilter],function(i){c.resizeFilter=i[0];fabric.util.enlivenObjects([c.clipPath],function(j){c.clipPath=j[0];var k=new fabric.Image(f,c);e(k,false)})})})},null,c.crossOrigin)};fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f,g){e&&e(new fabric.Image(f,d),g)},null,d&&d.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" "));fabric.Image.fromElement=function(d,f,c){var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],f,b((c?fabric.util.object.clone(c):{}),e))}})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;if(a>0){return Math.round((a-1)/90)*90}return Math.round(a/90)*90},straighten:function(){this.rotate(this._getAngleValueForStraighten());return this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.rotate(f);a()},onComplete:function(){e.setCoords();d()},});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.requestRenderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.requestRenderAllBound});return this}});(function(){function a(f,d){var e="precision "+d+" float;\nvoid main(){}";var c=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(c,e);f.compileShader(c);if(!f.getShaderParameter(c,f.COMPILE_STATUS)){return false}return true}fabric.isWebglSupported=function(g){if(fabric.isLikelyNode){return false}g=g||fabric.WebglFilterBackend.prototype.tileSize;var d=document.createElement("canvas");var h=d.getContext("webgl")||d.getContext("experimental-webgl");var f=false;if(h){fabric.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE);f=fabric.maxTextureSize>=g;var c=["highp","mediump","lowp"];for(var e=0;e<3;e++){if(a(h,c[e])){fabric.webGlPrecision=c[e];break}}}this.isSupported=f;return f};fabric.WebglFilterBackend=b;function b(c){if(c&&c.tileSize){this.tileSize=c.tileSize}this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo()}b.prototype={tileSize:2048,resources:{},setupGLContext:function(d,c){this.dispose();this.createWebGLCanvas(d,c);this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(d,c)},chooseFastestCopyGLTo2DMethod:function(c,o){var n=typeof window.performance!=="undefined",i;try{new ImageData(1,1);i=true}catch(g){i=false}var f=typeof ArrayBuffer!=="undefined";var j=typeof Uint8ClampedArray!=="undefined";if(!(n&&i&&f&&j)){return}var k=fabric.util.createCanvasElement();var p=new ArrayBuffer(c*o*4);if(fabric.forceGLPutImageData){this.imageBuffer=p;this.copyGLTo2D=copyGLTo2DPutImageData;return}var m={imageBuffer:p,destinationWidth:c,destinationHeight:o,targetCanvas:k};var d,h,l;k.width=c;k.height=o;d=window.performance.now();copyGLTo2DDrawImage.call(m,this.gl,m);h=window.performance.now()-d;d=window.performance.now();copyGLTo2DPutImageData.call(m,this.gl,m);l=window.performance.now()-d;if(h>l){this.imageBuffer=p;this.copyGLTo2D=copyGLTo2DPutImageData}else{this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(f,d){var e=fabric.util.createCanvasElement();e.width=f;e.height=d;var c={alpha:true,premultipliedAlpha:false,depth:false,stencil:false,antialias:false},g=e.getContext("webgl",c);if(!g){g=e.getContext("experimental-webgl",c)}if(!g){return}g.clearColor(0,0,0,0);this.canvas=e;this.gl=g},applyFilters:function(f,c,d,l,k,j){var g=this.gl;var i;if(j){i=this.getCachedTexture(j,c)}var e={originalWidth:c.width||c.originalWidth,originalHeight:c.height||c.originalHeight,sourceWidth:d,sourceHeight:l,destinationWidth:d,destinationHeight:l,context:g,sourceTexture:this.createTexture(g,d,l,!i&&c),targetTexture:this.createTexture(g,d,l),originalTexture:i||this.createTexture(g,d,l,!i&&c),passes:f.length,webgl:true,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:k};var h=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,h);f.forEach(function(m){m&&m.applyTo(e)});resizeCanvasIfNeeded(e);this.copyGLTo2D(g,e);g.bindTexture(g.TEXTURE_2D,null);g.deleteTexture(e.sourceTexture);g.deleteTexture(e.targetTexture);g.deleteFramebuffer(h);k.getContext("2d").setTransform(1,0,0,1,0,0);return e},dispose:function(){if(this.canvas){this.canvas=null;this.gl=null}this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={};this.textureCache={}},createTexture:function(f,d,c,g){var e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);if(g){f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,g)}else{f.texImage2D(f.TEXTURE_2D,0,f.RGBA,d,c,0,f.RGBA,f.UNSIGNED_BYTE,null)}return e},getCachedTexture:function(e,d){if(this.textureCache[e]){return this.textureCache[e]}else{var c=this.createTexture(this.gl,d.width,d.height,d);this.textureCache[e]=c;return c}},evictCachesForKey:function(c){if(this.textureCache[c]){this.gl.deleteTexture(this.textureCache[c]);delete this.textureCache[c]}},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo){return this.gpuInfo}var f=this.gl,e={renderer:"",vendor:""};if(!f){return e}var c=f.getExtension("WEBGL_debug_renderer_info");if(c){var d=f.getParameter(c.UNMASKED_RENDERER_WEBGL);var g=f.getParameter(c.UNMASKED_VENDOR_WEBGL);if(d){e.renderer=d.toLowerCase()}if(g){e.vendor=g.toLowerCase()}}this.gpuInfo=e;return e},}})();function resizeCanvasIfNeeded(d){var c=d.targetCanvas,e=c.width,a=c.height,b=d.destinationWidth,f=d.destinationHeight;if(e!==b||a!==f){c.width=b;c.height=f}}function copyGLTo2DDrawImage(f,d){var c=f.canvas,b=d.targetCanvas,a=b.getContext("2d");a.translate(0,b.height);a.scale(1,-1);var e=c.height-b.height;a.drawImage(c,0,e,b.width,b.height,0,0,b.width,b.height)}function copyGLTo2DPutImageData(f,d){var h=d.targetCanvas,j=h.getContext("2d"),g=d.destinationWidth,e=d.destinationHeight,a=g*e*4;var i=new Uint8Array(this.imageBuffer,0,a);var c=new Uint8ClampedArray(this.imageBuffer,0,a);f.readPixels(0,0,g,e,f.RGBA,f.UNSIGNED_BYTE,i);var b=new ImageData(c,g,e);j.putImageData(b,0,0)}(function(){var a=function(){};fabric.Canvas2dFilterBackend=b;function b(){}b.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(g,d,e,i,j){var k=j.getContext("2d");k.drawImage(d,0,0,e,i);var c=k.getImageData(0,0,e,i);var h=k.getImageData(0,0,e,i);var f={sourceWidth:e,sourceHeight:i,imageData:c,originalEl:d,originalImageData:h,canvasEl:j,ctx:k,filterBackend:this,};g.forEach(function(l){l.applyTo(f)});if(f.imageData.width!==e||f.imageData.height!==i){j.width=f.imageData.width;j.height=f.imageData.height}k.putImageData(f.imageData,0,0);return f},}})();fabric.Image=fabric.Image||{};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(a){if(a){this.setOptions(a)}},setOptions:function(a){for(var b in a){this[b]=a[b]}},createProgram:function(g,d,h){d=d||this.fragmentSource;h=h||this.vertexSource;if(fabric.webGlPrecision!=="highp"){d=d.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float")}var f=g.createShader(g.VERTEX_SHADER);g.shaderSource(f,h);g.compileShader(f);if(!g.getShaderParameter(f,g.COMPILE_STATUS)){throw new Error("Vertex shader compile error for "+this.type+": "+g.getShaderInfoLog(f))}var b=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(b,d);g.compileShader(b);if(!g.getShaderParameter(b,g.COMPILE_STATUS)){throw new Error("Fragment shader compile error for "+this.type+": "+g.getShaderInfoLog(b))}var c=g.createProgram();g.attachShader(c,f);g.attachShader(c,b);g.linkProgram(c);if(!g.getProgramParameter(c,g.LINK_STATUS)){throw new Error('Shader link error for "${this.type}" '+g.getProgramInfoLog(c))}var a=this.getAttributeLocations(g,c);var e=this.getUniformLocations(g,c)||{};e.uStepW=g.getUniformLocation(c,"uStepW");e.uStepH=g.getUniformLocation(c,"uStepH");return{program:c,attributeLocations:a,uniformLocations:e}},getAttributeLocations:function(b,a){return{aPosition:b.getAttribLocation(a,"aPosition"),}},getUniformLocations:function(){return{}},sendAttributeData:function(e,b,d){var c=b.aPosition;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a);e.enableVertexAttribArray(c);e.vertexAttribPointer(c,2,e.FLOAT,false,0,0);e.bufferData(e.ARRAY_BUFFER,d,e.STATIC_DRAW)},_setupFrameBuffer:function(b){var d=b.context,c,a;if(b.passes>1){c=b.destinationWidth;a=b.destinationHeight;if(b.sourceWidth!==c||b.sourceHeight!==a){d.deleteTexture(b.targetTexture);b.targetTexture=b.filterBackend.createTexture(d,c,a)}d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,b.targetTexture,0)}else{d.bindFramebuffer(d.FRAMEBUFFER,null);d.finish()}},_swapTextures:function(b){b.passes--;b.pass++;var a=b.targetTexture;b.targetTexture=b.sourceTexture;b.sourceTexture=a},isNeutralState:function(){var a=this.mainParameter,b=fabric.Image.filters[this.type].prototype;if(a){if(Array.isArray(b[a])){for(var c=b[a].length;c--;){if(this[a][c]!==b[a][c]){return false}}return true}else{return b[a]===this[a]}}else{return false}},applyTo:function(a){if(a.webgl){this._setupFrameBuffer(a);this.applyToWebGL(a);this._swapTextures(a)}else{this.applyTo2d(a)}},retrieveShader:function(a){if(!a.programCache.hasOwnProperty(this.type)){a.programCache[this.type]=this.createProgram(a.context)}return a.programCache[this.type]},applyToWebGL:function(a){var c=a.context;var b=this.retrieveShader(a);if(a.pass===0&&a.originalTexture){c.bindTexture(c.TEXTURE_2D,a.originalTexture)}else{c.bindTexture(c.TEXTURE_2D,a.sourceTexture)}c.useProgram(b.program);this.sendAttributeData(c,b.attributeLocations,a.aPosition);c.uniform1f(b.uniformLocations.uStepW,1/a.sourceWidth);c.uniform1f(b.uniformLocations.uStepH,1/a.sourceHeight);this.sendUniformData(c,b.uniformLocations);c.viewport(0,0,a.destinationWidth,a.destinationHeight);c.drawArrays(c.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(c,b,a){c.activeTexture(a);c.bindTexture(c.TEXTURE_2D,b);c.activeTexture(c.TEXTURE0)},unbindAdditionalTexture:function(b,a){b.activeTexture(a);b.bindTexture(b.TEXTURE_2D,null);b.activeTexture(b.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var b=document.createElement("canvas");b.width=a.sourceWidth;b.height=a.sourceHeight;a.helpLayer=b}},toObject:function(){var a={type:this.type},b=this.mainParameter;if(b){a[b]=this[b]}return a},toJSON:function(){return this.toObject()}});fabric.Image.filters.BaseFilter.fromObject=function(a,c){var b=new fabric.Image.filters[a.type](a);c&&c(b);return b};(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.ColorMatrix=d(a.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:true,initialize:function(e){this.callSuper("initialize",e);this.matrix=this.matrix.slice(0)},applyTo2d:function(s){var e=s.imageData,l=e.data,h=l.length,j=this.matrix,f,n,o,p,k,q=this.colorsOnly;for(k=0;k<h;k+=4){f=l[k];n=l[k+1];o=l[k+2];if(q){l[k]=f*j[0]+n*j[1]+o*j[2]+j[4]*255;l[k+1]=f*j[5]+n*j[6]+o*j[7]+j[9]*255;l[k+2]=f*j[10]+n*j[11]+o*j[12]+j[14]*255}else{p=l[k+3];l[k]=f*j[0]+n*j[1]+o*j[2]+p*j[3]+j[4]*255;l[k+1]=f*j[5]+n*j[6]+o*j[7]+p*j[8]+j[9]*255;l[k+2]=f*j[10]+n*j[11]+o*j[12]+p*j[13]+j[14]*255;l[k+3]=f*j[15]+n*j[16]+o*j[17]+p*j[18]+j[19]*255}}},getUniformLocations:function(f,e){return{uColorMatrix:f.getUniformLocation(e,"uColorMatrix"),uConstants:f.getUniformLocation(e,"uConstants"),}},sendUniformData:function(i,h){var e=this.matrix,f=[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]],g=[e[4],e[9],e[14],e[19]];i.uniformMatrix4fv(h.uColorMatrix,false,f);i.uniform4fv(h.uConstants,g)},});c.Image.filters.ColorMatrix.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Brightness=d(a.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(f){if(this.brightness===0){return}var k=f.imageData,h=k.data,g,e=h.length,j=Math.round(this.brightness*255);for(g=0;g<e;g+=4){h[g]=h[g]+j;h[g+1]=h[g+1]+j;h[g+2]=h[g+2]+j}},getUniformLocations:function(f,e){return{uBrightness:f.getUniformLocation(e,"uBrightness"),}},sendUniformData:function(f,e){f.uniform1f(e.uBrightness,this.brightness)},});c.Image.filters.Brightness.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a=c.Image.filters,d=c.util.createClass;a.Convolute=d(a.BaseFilter,{type:"Convolute",opaque:false,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",},retrieveShader:function(f){var g=Math.sqrt(this.matrix.length);var h=this.type+"_"+g+"_"+(this.opaque?1:0);var i=this.fragmentSource[h];if(!f.programCache.hasOwnProperty(h)){f.programCache[h]=this.createProgram(f.context,i)}return f.programCache[h]},applyTo2d:function(k){var A=k.imageData,F=A.data,B=this.matrix,h=Math.round(Math.sqrt(B.length)),l=Math.floor(h/2),t=A.width,E=A.height,m=k.ctx.createImageData(t,E),G=m.data,q=this.opaque?1:0,s,z,C,D,u,w,v,p,f,o,n,j,i;for(n=0;n<E;n++){for(o=0;o<t;o++){u=(n*t+o)*4;s=0;z=0;C=0;D=0;for(i=0;i<h;i++){for(j=0;j<h;j++){v=n+i-l;w=o+j-l;if(v<0||v>=E||w<0||w>=t){continue}p=(v*t+w)*4;f=B[i*h+j];s+=F[p]*f;z+=F[p+1]*f;C+=F[p+2]*f;if(!q){D+=F[p+3]*f}}}G[u]=s;G[u+1]=z;G[u+2]=C;if(!q){G[u+3]=D}else{G[u+3]=F[u+3]}}}k.imageData=m},getUniformLocations:function(g,f){return{uMatrix:g.getUniformLocation(f,"uMatrix"),uOpaque:g.getUniformLocation(f,"uOpaque"),uHalfSize:g.getUniformLocation(f,"uHalfSize"),uSize:g.getUniformLocation(f,"uSize"),}},sendUniformData:function(g,f){g.uniform1fv(f.uMatrix,this.matrix)},toObject:function(){return e(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Grayscale=d(a.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}",},mode:"average",mainParameter:"mode",applyTo2d:function(f){var l=f.imageData,j=l.data,g,e=j.length,h,k=this.mode;for(g=0;g<e;g+=4){if(k==="average"){h=(j[g]+j[g+1]+j[g+2])/3}else{if(k==="lightness"){h=(Math.min(j[g],j[g+1],j[g+2])+Math.max(j[g],j[g+1],j[g+2]))/2}else{if(k==="luminosity"){h=0.21*j[g]+0.72*j[g+1]+0.07*j[g+2]}}}j[g]=h;j[g+1]=h;j[g+2]=h}},retrieveShader:function(e){var f=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(f)){var g=this.fragmentSource[this.mode];e.programCache[f]=this.createProgram(e.context,g)}return e.programCache[f]},getUniformLocations:function(f,e){return{uMode:f.getUniformLocation(e,"uMode"),}},sendUniformData:function(g,e){var f=1;g.uniform1i(e.uMode,f)},isNeutralState:function(){return false},});c.Image.filters.Grayscale.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Invert=d(a.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:true,mainParameter:"invert",applyTo2d:function(f){var j=f.imageData,h=j.data,g,e=h.length;for(g=0;g<e;g+=4){h[g]=255-h[g];h[g+1]=255-h[g+1];h[g+2]=255-h[g+2]}},isNeutralState:function(){return !this.invert},getUniformLocations:function(f,e){return{uInvert:f.getUniformLocation(e,"uInvert"),}},sendUniformData:function(f,e){f.uniform1i(e.uInvert,this.invert)},});c.Image.filters.Invert.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a=c.Image.filters,d=c.util.createClass;a.Noise=d(a.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(h){if(this.noise===0){return}var m=h.imageData,l=m.data,j,f=l.length,g=this.noise,k;for(j=0,f=l.length;j<f;j+=4){k=(0.5-Math.random())*g;l[j]+=k;l[j+1]+=k;l[j+2]+=k}},getUniformLocations:function(g,f){return{uNoise:g.getUniformLocation(f,"uNoise"),uSeed:g.getUniformLocation(f,"uSeed"),}},sendUniformData:function(g,f){g.uniform1f(f.uNoise,this.noise/255);g.uniform1f(f.uSeed,Math.random())},toObject:function(){return e(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Pixelate=d(a.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(x){var f=x.imageData,n=f.data,h=f.height,w=f.width,q,o,m,e,p,t,u,l,k,v,s;for(o=0;o<h;o+=this.blocksize){for(m=0;m<w;m+=this.blocksize){q=(o*4)*w+(m*4);e=n[q];p=n[q+1];t=n[q+2];u=n[q+3];v=Math.min(o+this.blocksize,h);s=Math.min(m+this.blocksize,w);for(l=o;l<v;l++){for(k=m;k<s;k++){q=(l*4)*w+(k*4);n[q]=e;n[q+1]=p;n[q+2]=t;n[q+3]=u}}}}},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(f,e){return{uBlocksize:f.getUniformLocation(e,"uBlocksize"),uStepW:f.getUniformLocation(e,"uStepW"),uStepH:f.getUniformLocation(e,"uStepH"),}},sendUniformData:function(f,e){f.uniform1f(e.uBlocksize,this.blocksize)},});c.Image.filters.Pixelate.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a=c.Image.filters,d=c.util.createClass;a.RemoveColor=d(a.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:0.02,useAlpha:false,applyTo2d:function(s){var h=s.imageData,l=h.data,m,k=this.distance*255,j,n,p,f=new c.Color(this.color).getSource(),o=[f[0]-k,f[1]-k,f[2]-k,],q=[f[0]+k,f[1]+k,f[2]+k,];for(m=0;m<l.length;m+=4){j=l[m];n=l[m+1];p=l[m+2];if(j>o[0]&&n>o[1]&&p>o[2]&&j<q[0]&&n<q[1]&&p<q[2]){l[m+3]=0}}},getUniformLocations:function(g,f){return{uLow:g.getUniformLocation(f,"uLow"),uHigh:g.getUniformLocation(f,"uHigh"),}},sendUniformData:function(j,g){var i=new c.Color(this.color).getSource(),k=parseFloat(this.distance),h=[0+i[0]/255-k,0+i[1]/255-k,0+i[2]/255-k,1],f=[i[0]/255+k,i[1]/255+k,i[2]/255+k,1];j.uniform4fv(g.uLow,h);j.uniform4fv(g.uHigh,f)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,distance:this.distance})}});c.Image.filters.RemoveColor.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),c=e.Image.filters,f=e.util.createClass;var a={Brownie:[0.5997,0.34553,-0.27082,0,0.186,-0.0377,0.86095,0.15059,0,-0.1449,0.24113,-0.07441,0.44972,0,-0.02965,0,0,0,1,0],Vintage:[0.62793,0.32021,-0.03965,0,0.03784,0.02578,0.64411,0.03259,0,0.02926,0.0466,-0.08512,0.52416,0,0.02023,0,0,0,1,0],Kodachrome:[1.12855,-0.39673,-0.03992,0,0.24991,-0.16404,1.08352,-0.05498,0,0.09698,-0.16786,-0.56034,1.60148,0,0.13972,0,0,0,1,0],Technicolor:[1.91252,-0.85453,-0.09155,0,0.04624,-0.30878,1.76589,-0.10601,0,-0.27589,-0.2311,-0.75018,1.84759,0,0.12137,0,0,0,1,0],Polaroid:[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0],Sepia:[0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0,]};for(var b in a){c[b]=f(c.ColorMatrix,{type:b,matrix:a[b],mainParameter:false,colorsOnly:true,});e.Image.filters[b].fromObject=e.Image.filters.BaseFilter.fromObject}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric,a=c.Image.filters,d=c.util.createClass;a.BlendColor=d(a.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n",},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var f=this.type+"_"+this.mode,g;if(!e.programCache.hasOwnProperty(f)){g=this.buildSource(this.mode);e.programCache[f]=this.createProgram(e.context,g)}return e.programCache[f]},applyTo2d:function(t){var f=t.imageData,n=f.data,k=n.length,p,j,l,h,o,q,e,s=1-this.alpha;e=new c.Color(this.color).getSource();p=e[0]*this.alpha;j=e[1]*this.alpha;l=e[2]*this.alpha;for(var m=0;m<k;m+=4){h=n[m];o=n[m+1];q=n[m+2];switch(this.mode){case"multiply":n[m]=h*p/255;n[m+1]=o*j/255;n[m+2]=q*l/255;break;case"screen":n[m]=255-(255-h)*(255-p)/255;n[m+1]=255-(255-o)*(255-j)/255;n[m+2]=255-(255-q)*(255-l)/255;break;case"add":n[m]=h+p;n[m+1]=o+j;n[m+2]=q+l;break;case"diff":case"difference":n[m]=Math.abs(h-p);n[m+1]=Math.abs(o-j);n[m+2]=Math.abs(q-l);break;case"subtract":n[m]=h-p;n[m+1]=o-j;n[m+2]=q-l;break;case"darken":n[m]=Math.min(h,p);n[m+1]=Math.min(o,j);n[m+2]=Math.min(q,l);break;case"lighten":n[m]=Math.max(h,p);n[m+1]=Math.max(o,j);n[m+2]=Math.max(q,l);break;case"overlay":n[m]=p<128?(2*h*p/255):(255-2*(255-h)*(255-p)/255);n[m+1]=j<128?(2*o*j/255):(255-2*(255-o)*(255-j)/255);n[m+2]=l<128?(2*q*l/255):(255-2*(255-q)*(255-l)/255);break;case"exclusion":n[m]=p+h-((2*p*h)/255);n[m+1]=j+o-((2*j*o)/255);n[m+2]=l+q-((2*l*q)/255);break;case"tint":n[m]=p+h*s;n[m+1]=j+o*s;n[m+2]=l+q*s}}},getUniformLocations:function(f,e){return{uColor:f.getUniformLocation(e,"uColor"),}},sendUniformData:function(g,e){var f=new c.Color(this.color).getSource();f[0]=this.alpha*f[0]/255;f[1]=this.alpha*f[1]/255;f[2]=this.alpha*f[2]/255;f[3]=this.alpha;g.uniform4fv(e.uColor,f)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}});c.Image.filters.BlendColor.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric,a=c.Image.filters,d=c.util.createClass;a.BlendImage=d(a.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}",},retrieveShader:function(e){var f=this.type+"_"+this.mode;var g=this.fragmentSource[this.mode];if(!e.programCache.hasOwnProperty(f)){e.programCache[f]=this.createProgram(e.context,g)}return e.programCache[f]},applyToWebGL:function(e){var g=e.context,f=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(g,f,g.TEXTURE1);this.callSuper("applyToWebGL",e);this.unbindAdditionalTexture(g,g.TEXTURE1)},createTexture:function(e,f){return e.getCachedTexture(f.cacheKey,f._element)},calculateMatrix:function(){var g=this.image,f=g._element.width,e=g._element.height;return[1/g.scaleX,0,0,0,1/g.scaleY,0,-g.left/f,-g.top/e,1]},applyTo2d:function(j){var x=j.imageData,w=j.filterBackend.resources,A=x.data,t=A.length,s=x.width,q=x.height,e,k,l,m,o,v,y,z,h,f,p=this.image,n;if(!w.blendImage){w.blendImage=c.util.createCanvasElement()}h=w.blendImage;f=h.getContext("2d");if(h.width!==s||h.height!==q){h.width=s;h.height=q}else{f.clearRect(0,0,s,q)}f.setTransform(p.scaleX,0,0,p.scaleY,p.left,p.top);f.drawImage(p._element,0,0,s,q);n=f.getImageData(0,0,s,q).data;for(var u=0;u<t;u+=4){o=A[u];v=A[u+1];y=A[u+2];z=A[u+3];e=n[u];k=n[u+1];l=n[u+2];m=n[u+3];switch(this.mode){case"multiply":A[u]=o*e/255;A[u+1]=v*k/255;A[u+2]=y*l/255;A[u+3]=z*m/255;break;case"mask":A[u+3]=m;break}}},getUniformLocations:function(f,e){return{uTransformMatrix:f.getUniformLocation(e,"uTransformMatrix"),uImage:f.getUniformLocation(e,"uImage"),}},sendUniformData:function(g,f){var e=this.calculateMatrix();g.uniform1i(f.uImage,1);g.uniformMatrix3fv(f.uTransformMatrix,false,e)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}});c.Image.filters.BlendImage.fromObject=function(e,f){c.Image.fromObject(e.image,function(h){var g=c.util.object.clone(e);g.image=h;f(new c.Image.filters.BlendImage(g))})}})(typeof exports!=="undefined"?exports:this);(function(b){var d=b.fabric||(b.fabric={}),f=Math.pow,e=Math.floor,h=Math.sqrt,k=Math.abs,j=Math.round,g=Math.sin,i=Math.ceil,c=d.Image.filters,a=d.util.createClass;c.Resize=a(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(m,l){return{uDelta:m.getUniformLocation(l,"uDelta"),uTaps:m.getUniformLocation(l,"uTaps"),}},sendUniformData:function(m,l){m.uniform2fv(l.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);m.uniform1fv(l.uTaps,this.taps)},retrieveShader:function(n){var m=this.getFilterWindow(),o=this.type+"_"+m;if(!n.programCache.hasOwnProperty(o)){var l=this.generateShader(m);n.programCache[o]=this.createProgram(n.context,l)}return n.programCache[o]},getFilterWindow:function(){var l=this.tempScale;return Math.ceil(this.lanczosLobes/l)},getTaps:function(){var m=this.lanczosCreate(this.lanczosLobes),o=this.tempScale,l=this.getFilterWindow(),p=new Array(l);for(var n=1;n<=l;n++){p[n-1]=m(n*o)}return p},generateShader:function(m){var o=new Array(m),l=this.fragmentSourceTOP,m;for(var n=1;n<=m;n++){o[n-1]=n+".0 * uDelta"}l+="uniform float uTaps["+m+"];\n";l+="void main() {\n";l+="  vec4 color = texture2D(uTexture, vTexCoord);\n";l+="  float sum = 1.0;\n";o.forEach(function(q,p){l+="  color += texture2D(uTexture, vTexCoord + "+q+") * uTaps["+p+"];\n";l+="  color += texture2D(uTexture, vTexCoord - "+q+") * uTaps["+p+"];\n";l+="  sum += 2.0 * uTaps["+p+"];\n"});l+="  gl_FragColor = color / sum;\n";l+="}";return l},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(l){if(l.webgl){l.passes++;this.width=l.sourceWidth;this.horizontal=true;this.dW=Math.round(this.width*this.scaleX);this.dH=l.sourceHeight;this.tempScale=this.dW/this.width;this.taps=this.getTaps();l.destinationWidth=this.dW;this._setupFrameBuffer(l);this.applyToWebGL(l);this._swapTextures(l);l.sourceWidth=l.destinationWidth;this.height=l.sourceHeight;this.horizontal=false;this.dH=Math.round(this.height*this.scaleY);this.tempScale=this.dH/this.height;this.taps=this.getTaps();l.destinationHeight=this.dH;this._setupFrameBuffer(l);this.applyToWebGL(l);this._swapTextures(l);l.sourceHeight=l.destinationHeight}else{this.applyTo2d(l)}},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(l){return function(m){if(m>=l||m<=-l){return 0}if(m<1.1920929e-7&&m>-1.1920929e-7){return 1}m*=Math.PI;var n=m/l;return(g(m)/m)*g(n)/n}},applyTo2d:function(t){var l=t.imageData,r=this.scaleX,q=this.scaleY;this.rcpScaleX=1/r;this.rcpScaleY=1/q;var p=l.width,n=l.height,o=j(p*r),m=j(n*q),s;if(this.resizeType==="sliceHack"){s=this.sliceByTwo(t,p,n,o,m)}else{if(this.resizeType==="hermite"){s=this.hermiteFastResize(t,p,n,o,m)}else{if(this.resizeType==="bilinear"){s=this.bilinearFiltering(t,p,n,o,m)}else{if(this.resizeType==="lanczos"){s=this.lanczosResize(t,p,n,o,m)}}}}t.imageData=s},sliceByTwo:function(o,C,r,p,v){var A=o.imageData,q=0.5,w=false,B=false,u=C*q,y=r*q,z=d.filterBackend.resources,l,x,t=0,s=0,n=C,m=0;if(!z.sliceByTwo){z.sliceByTwo=document.createElement("canvas")}l=z.sliceByTwo;if(l.width<C*1.5||l.height<r){l.width=C*1.5;l.height=r}x=l.getContext("2d");x.clearRect(0,0,C*1.5,r);x.putImageData(A,0,0);p=e(p);v=e(v);while(!w||!B){C=u;r=y;if(p<e(u*q)){u=e(u*q)}else{u=p;w=true}if(v<e(y*q)){y=e(y*q)}else{y=v;B=true}x.drawImage(l,t,s,C,r,n,m,u,y);t=n;s=m;m+=y}return x.getImageData(t,s,p,v)},lanczosResize:function(o,C,s,q,u){function w(Q){var P,I,J,O,M,E,G,N,F,L,K;B.x=(Q+0.5)*n;y.x=e(B.x);for(P=0;P<u;P++){B.y=(P+0.5)*m;y.y=e(B.y);M=0;E=0;G=0;N=0;F=0;for(I=y.x-r;I<=y.x+r;I++){if(I<0||I>=C){continue}L=e(1000*k(I-B.x));if(!l[L]){l[L]={}}for(var H=y.y-p;H<=y.y+p;H++){if(H<0||H>=s){continue}K=e(1000*k(H-B.y));if(!l[L][K]){l[L][K]=t(h(f(L*x,2)+f(K*v,2))/1000)}J=l[L][K];if(J>0){O=(H*C+I)*4;M+=J;E+=J*A[O];G+=J*A[O+1];N+=J*A[O+2];F+=J*A[O+3]}}}O=(P*q+Q)*4;z[O]=E/M;z[O+1]=G/M;z[O+2]=N/M;z[O+3]=F/M}if(++Q<q){return w(Q)}else{return D}}var A=o.imageData.data,D=o.ctx.createImageData(q,u),z=D.data,t=this.lanczosCreate(this.lanczosLobes),n=this.rcpScaleX,m=this.rcpScaleY,x=2/this.rcpScaleX,v=2/this.rcpScaleY,r=i(n*this.lanczosLobes/2),p=i(m*this.lanczosLobes/2),l={},B={},y={};return w(0)},bilinearFiltering:function(n,L,q,o,B){var K,J,I,H,A,v,F,E,G,w,u,D,r=0,t,m=this.rcpScaleX,l=this.rcpScaleY,s=4*(L-1),M=n.imageData,C=M.data,p=n.ctx.createImageData(o,B),z=p.data;for(F=0;F<B;F++){for(E=0;E<o;E++){A=e(m*E);v=e(l*F);G=m*E-A;w=l*F-v;t=4*(v*L+A);for(u=0;u<4;u++){K=C[t+u];J=C[t+4+u];I=C[t+s+u];H=C[t+s+4+u];D=K*(1-G)*(1-w)+J*G*(1-w)+I*w*(1-G)+H*G*w;z[r++]=D}}}return p},hermiteFastResize:function(n,N,p,o,G){var m=this.rcpScaleX,B=this.rcpScaleY,I=i(m/2),E=i(B/2),Q=n.imageData,P=Q.data,O=n.ctx.createImageData(o,G),q=O.data;for(var J=0;J<G;J++){for(var K=0;K<o;K++){var L=(K+J*o)*4,F=0,M=0,u=0,l=0,s=0,x=0,y=0,t=(J+0.5)*B;for(var H=e(J*B);H<(J+1)*B;H++){var A=k(t-(H+0.5))/E,v=(K+0.5)*m,D=A*A;for(var r=e(K*m);r<(K+1)*m;r++){var C=k(v-(r+0.5))/I,z=h(D+C*C);if(z>1&&z<-1){continue}F=2*z*z*z-3*z*z+1;if(F>0){C=4*(r+H*N);y+=F*P[C+3];u+=F;if(P[C+3]<255){F=F*P[C+3]/250}l+=F*P[C];s+=F*P[C+1];x+=F*P[C+2];M+=F}}}q[L]=l/M;q[L+1]=s/M;q[L+2]=x/M;q[L+3]=y/u}}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});d.Image.filters.Resize.fromObject=d.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Contrast=d(a.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(f){if(this.contrast===0){return}var l=f.imageData,g,e,k=l.data,e=k.length,j=Math.floor(this.contrast*255),h=259*(j+255)/(255*(259-j));for(g=0;g<e;g+=4){k[g]=h*(k[g]-128)+128;k[g+1]=h*(k[g+1]-128)+128;k[g+2]=h*(k[g+2]-128)+128}},getUniformLocations:function(f,e){return{uContrast:f.getUniformLocation(e,"uContrast"),}},sendUniformData:function(f,e){f.uniform1f(e.uContrast,this.contrast)},});c.Image.filters.Contrast.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Saturation=d(a.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(g){if(this.saturation===0){return}var l=g.imageData,j=l.data,f=j.length,k=-this.saturation,h,e;for(h=0;h<f;h+=4){e=Math.max(j[h],j[h+1],j[h+2]);j[h]+=e!==j[h]?(e-j[h])*k:0;j[h+1]+=e!==j[h+1]?(e-j[h+1])*k:0;j[h+2]+=e!==j[h+2]?(e-j[h+2])*k:0}},getUniformLocations:function(f,e){return{uSaturation:f.getUniformLocation(e,"uSaturation"),}},sendUniformData:function(f,e){f.uniform1f(e.uSaturation,-this.saturation)},});c.Image.filters.Saturation.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Vibrance=d(a.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(n){if(this.vibrance===0){return}var e=n.imageData,g=e.data,k=g.length,m=-this.vibrance,h,l,j,f;for(h=0;h<k;h+=4){l=Math.max(g[h],g[h+1],g[h+2]);j=(g[h]+g[h+1]+g[h+2])/3;f=((Math.abs(l-j)*2/255)*m);g[h]+=l!==g[h]?(l-g[h])*f:0;g[h+1]+=l!==g[h+1]?(l-g[h+1])*f:0;g[h+2]+=l!==g[h+2]?(l-g[h+2])*f:0}},getUniformLocations:function(f,e){return{uVibrance:f.getUniformLocation(e,"uVibrance"),}},sendUniformData:function(f,e){f.uniform1f(e.uVibrance,-this.vibrance)},});c.Image.filters.Vibrance.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Blur=d(a.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){if(e.webgl){this.aspectRatio=e.sourceWidth/e.sourceHeight;e.passes++;this._setupFrameBuffer(e);this.horizontal=true;this.applyToWebGL(e);this._swapTextures(e);this._setupFrameBuffer(e);this.horizontal=false;this.applyToWebGL(e);this._swapTextures(e)}else{this.applyTo2d(e)}},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(u){var k=u.filterBackend.resources,f,e,g=u.imageData.width,s=u.imageData.height;if(!k.blurLayer1){k.blurLayer1=c.util.createCanvasElement();k.blurLayer2=c.util.createCanvasElement()}f=k.blurLayer1;e=k.blurLayer2;if(f.width!==g||f.height!==s){e.width=f.width=g;e.height=f.height=s}var p=f.getContext("2d"),o=e.getContext("2d"),q=15,h,r,m,n,l=this.blur*0.06*0.5;p.putImageData(u.imageData,0,0);o.clearRect(0,0,g,s);for(n=-q;n<=q;n++){h=(Math.random()-0.5)/4;r=n/q;m=l*r*g+h;o.globalAlpha=1-Math.abs(r);o.drawImage(f,m,h);p.drawImage(e,0,0);o.globalAlpha=1;o.clearRect(0,0,e.width,e.height)}for(n=-q;n<=q;n++){h=(Math.random()-0.5)/4;r=n/q;m=l*r*s+h;o.globalAlpha=1-Math.abs(r);o.drawImage(f,h,m);p.drawImage(e,0,0);o.globalAlpha=1;o.clearRect(0,0,e.width,e.height)}u.ctx.drawImage(f,0,0);var t=u.ctx.getImageData(0,0,f.width,f.height);p.globalAlpha=1;p.clearRect(0,0,f.width,f.height);return t},getUniformLocations:function(f,e){return{delta:f.getUniformLocation(e,"uDelta"),}},sendUniformData:function(f,e){var g=this.chooseRightDelta();f.uniform2fv(e.delta,g)},chooseRightDelta:function(){var e=1,g=[0,0],f;if(this.horizontal){if(this.aspectRatio>1){e=1/this.aspectRatio}}else{if(this.aspectRatio<1){e=this.aspectRatio}}f=e*this.blur*0.12;if(this.horizontal){g[0]=f}else{g[1]=f}return g},});a.Blur.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Gamma=d(a.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1];a.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(n){var e=n.imageData,h=e.data,f=this.gamma,j=h.length,l=1/f[0],k=1/f[1],m=1/f[2],g;if(!this.rVals){this.rVals=new Uint8Array(256);this.gVals=new Uint8Array(256);this.bVals=new Uint8Array(256)}for(g=0,j=256;g<j;g++){this.rVals[g]=Math.pow(g/255,l)*255;this.gVals[g]=Math.pow(g/255,k)*255;this.bVals[g]=Math.pow(g/255,m)*255}for(g=0,j=h.length;g<j;g+=4){h[g]=this.rVals[h[g]];h[g+1]=this.gVals[h[g+1]];h[g+2]=this.bVals[h[g+2]]}},getUniformLocations:function(f,e){return{uGamma:f.getUniformLocation(e,"uGamma"),}},sendUniformData:function(f,e){f.uniform3fv(e.uGamma,this.gamma)},});c.Image.filters.Gamma.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Composed=d(a.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e);this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1;this.subFilters.forEach(function(f){f.applyTo(e)})},toObject:function(){return c.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()}),})},isNeutralState:function(){return !this.subFilters.some(function(e){return !e.isNeutralState()})}});c.Image.filters.Composed.fromObject=function(g,i){var h=g.subFilters||[],f=h.map(function(j){return new c.Image.filters[j.type](j)}),e=new c.Image.filters.Composed({subFilters:f});i&&i(e);return e}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.HueRotation=d(a.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,j=c.util.cos(e),i=c.util.sin(e),h=1/3,g=Math.sqrt(h)*i,f=1-j;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=j+f/3;this.matrix[1]=h*f-g;this.matrix[2]=h*f+g;this.matrix[5]=h*f+g;this.matrix[6]=j+h*f;this.matrix[7]=h*f-g;this.matrix[10]=h*f-g;this.matrix[11]=h*f+g;this.matrix[12]=j+h*f},isNeutralState:function(e){this.calculateMatrix();return a.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix();a.BaseFilter.prototype.applyTo.call(this,e)},});c.Image.filters.HueRotation.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=b.util.object.clone;if(b.Text){b.warn("fabric.Text is already defined");return}var c=("fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles path").split(" ");b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:false,overline:false,linethrough:false,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:0.6,baseline:-0.35},subscript:{size:0.6,baseline:0.11},textBackgroundColor:"",stateProperties:b.Object.prototype.stateProperties.concat(c),cacheProperties:b.Object.prototype.cacheProperties.concat(c),stroke:null,shadow:null,path:null,startOffset:0,_fontSizeFraction:0.222,offsets:{underline:0.1,linethrough:-0.315,overline:-0.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor",],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(f,e){this.styles=e?(e.styles||{}):{};this.text=f;this.__skipDimension=true;this.callSuper("initialize",e);if(this.path){this.setPathInfo()}this.__skipDimension=false;this.initDimensions();this.setCoords();this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var e=this.path;if(e){e.segmentsInfo=b.util.getPathSegmentsInfo(e.path)}},getMeasuringContext:function(){if(!b._measuringContext){b._measuringContext=this.canvas&&this.canvas.contextCache||b.util.createCanvasElement().getContext("2d")}return b._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);this.textLines=e.lines;this._textLines=e.graphemeLines;this._unwrappedTextLines=e._unwrappedLines;this._text=e.graphemeText;return e},initDimensions:function(){if(this.__skipDimension){return}this._splitText();this._clearCache();if(this.path){this.width=this.path.width;this.height=this.path.height}else{this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH;this.height=this.calcTextHeight()}if(this.textAlign.indexOf("justify")!==-1){this.enlargeSpaces()}this.saveState({propertySet:"_dimensionAffectingProps"})},enlargeSpaces:function(){var m,e,k,n,q,o,l;for(var g=0,h=this._textLines.length;g<h;g++){if(this.textAlign!=="justify"&&(g===h-1||this.isEndOfWrapping(g))){continue}n=0;q=this._textLines[g];e=this.getLineWidth(g);if(e<this.width&&(l=this.textLines[g].match(this._reSpacesAndTabs))){k=l.length;m=(this.width-e)/k;for(var f=0,p=q.length;f<=p;f++){o=this.__charBounds[g][f];if(this._reSpaceAndTab.test(q[f])){o.width+=m;o.kernedWidth+=m;o.left+=n;n+=m}else{o.left+=n}}}}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var f=this.callSuper("_getCacheCanvasDimensions");var e=this.fontSize;f.width+=e*f.zoomX;f.height+=e*f.zoomY;return f},_render:function(e){this._setTextStyles(e);this._renderTextLinesBackground(e);this._renderTextDecoration(e,"underline");this._renderText(e);this._renderTextDecoration(e,"overline");this._renderTextDecoration(e,"linethrough")},_renderText:function(e){if(this.paintFirst==="stroke"){this._renderTextStroke(e);this._renderTextFill(e)}else{this._renderTextFill(e);this._renderTextStroke(e)}},_setTextStyles:function(f,e,g){f.textBaseline="alphabetic";f.font=this._getFontDeclaration(e,g)},calcTextWidth:function(){var g=this.getLineWidth(0);for(var f=1,e=this._textLines.length;f<e;f++){var h=this.getLineWidth(f);if(h>g){g=h}}return g},_renderTextLine:function(j,f,e,h,g,i){this._renderChars(j,f,e,h,g,i)},_renderTextLinesBackground:function(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor")){return}var q,p,e=t.fillStyle,n,f,m=this._getLeftOffset(),l=this._getTopOffset(),x=0,k=0,h,o,s=this.path,g;for(var v=0,w=this._textLines.length;v<w;v++){q=this.getHeightOfLine(v);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",v)){l+=q;continue}n=this._textLines[v];p=this._getLineLeftOffset(v);k=0;x=0;f=this.getValueOfPropertyAt(v,0,"textBackgroundColor");for(var u=0,r=n.length;u<r;u++){h=this.__charBounds[v][u];o=this.getValueOfPropertyAt(v,u,"textBackgroundColor");if(s){t.save();t.translate(h.renderLeft,h.renderTop);t.rotate(h.angle);t.fillStyle=o;o&&t.fillRect(-h.width/2,-q/this.lineHeight*(1-this._fontSizeFraction),h.width,q/this.lineHeight);t.restore()}else{if(o!==f){g=m+p+x;if(this.direction==="rtl"){g=this.width-g-k}t.fillStyle=f;f&&t.fillRect(g,l,k,q/this.lineHeight);x=h.left;k=h.width;f=o}else{k+=h.kernedWidth}}}if(o&&!s){g=m+p+x;if(this.direction==="rtl"){g=this.width-g-k}t.fillStyle=o;t.fillRect(g,l,k,q/this.lineHeight)}l+=q}t.fillStyle=e;this._removeShadow(t)},getFontCache:function(f){var e=f.fontFamily.toLowerCase();if(!b.charWidthsCache[e]){b.charWidthsCache[e]={}}var g=b.charWidthsCache[e],h=f.fontStyle.toLowerCase()+"_"+(f.fontWeight+"").toLowerCase();if(!g[h]){g[h]={}}return g[h]},_measureChar:function(r,m,l,g){var h=this.getFontCache(m),j=this._getFontDeclaration(m),q=this._getFontDeclaration(g),o=l+r,f=j===q,e,p,n,k=m.fontSize/this.CACHE_FONT_SIZE,i;if(l&&h[l]!==undefined){n=h[l]}if(h[r]!==undefined){i=e=h[r]}if(f&&h[o]!==undefined){p=h[o];i=p-n}if(e===undefined||n===undefined||p===undefined){var s=this.getMeasuringContext();this._setTextStyles(s,m,true)}if(e===undefined){i=e=s.measureText(r).width;h[r]=e}if(n===undefined&&f&&l){n=s.measureText(l).width;h[l]=n}if(f&&p===undefined){p=s.measureText(o).width;h[o]=p;i=p-n}return{width:e*k,kernedWidth:i*k}},getHeightOfChar:function(e,f){return this.getValueOfPropertyAt(e,f,"fontSize")},measureLine:function(f){var e=this._measureLine(f);if(this.charSpacing!==0){e.width-=this._getWidthOfCharSpacing()}if(e.width<0){e.width=0}return e},_measureLine:function(o){var f=0,m,q,r=this._textLines[o],l,e,h=0,n=new Array(r.length),j=0,k,g,p=this.path;this.__charBounds[o]=n;for(m=0;m<r.length;m++){q=r[m];e=this._getGraphemeBox(q,o,m,l);n[m]=e;f+=e.kernedWidth;l=q}n[m]={left:e?e.left+e.width:0,width:0,kernedWidth:0,height:this.fontSize};if(p){g=p.segmentsInfo[p.segmentsInfo.length-1].length;k=b.util.getPointOnPath(p.path,0,p.segmentsInfo);k.x+=p.pathOffset.x;k.y+=p.pathOffset.y;switch(this.textAlign){case"center":j=(g-f)/2;break;case"right":j=(g-f);break}j+=this.startOffset}if(p){for(m=0;m<r.length;m++){e=n[m];if(j>g){j%=g}else{if(j<0){j+=g}}this._setGraphemeOnPath(j,e,k);j+=e.kernedWidth}}return{width:f,numOfSpaces:h}},_setGraphemeOnPath:function(g,h,f){var e=g+h.kernedWidth/2,j=this.path;var i=b.util.getPointOnPath(j.path,e,j.segmentsInfo);h.renderLeft=i.x-f.x;h.renderTop=i.y-f.y;h.angle=i.angle},_getGraphemeBox:function(q,p,e,l,i){var f=this.getCompleteStyleDeclaration(p,e),o=l?this.getCompleteStyleDeclaration(p,e-1):{},h=this._measureChar(q,f,l,o),k=h.kernedWidth,g=h.width,n;if(this.charSpacing!==0){n=this._getWidthOfCharSpacing();g+=n;k+=n}var m={width:g,left:0,height:f.fontSize,kernedWidth:k,deltaY:f.deltaY,};if(e>0&&!i){var j=this.__charBounds[p][e-1];m.left=j.left+j.width+h.kernedWidth-h.width}return m},getHeightOfLine:function(j){if(this.__lineHeights[j]){return this.__lineHeights[j]}var f=this._textLines[j],h=this.getHeightOfChar(j,0);for(var g=1,e=f.length;g<e;g++){h=Math.max(this.getHeightOfChar(j,g),h)}return this.__lineHeights[j]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){var h,f=0;for(var g=0,e=this._textLines.length;g<e;g++){h=this.getHeightOfLine(g);f+=(g===e-1?h/this.lineHeight:h)}return f},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return -this.height/2},_renderTextCommon:function(o,e){o.save();var l=0,h=this._getLeftOffset(),m=this._getTopOffset();for(var j=0,k=this._textLines.length;j<k;j++){var g=this.getHeightOfLine(j),n=g/this.lineHeight,f=this._getLineLeftOffset(j);this._renderTextLine(e,o,this._textLines[j],h+f,m+l+n,j);l+=g}o.restore()},_renderTextFill:function(e){if(!this.fill&&!this.styleHas("fill")){return}this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(e)}e.save();this._setLineDash(e,this.strokeDashArray);e.beginPath();this._renderTextCommon(e,"strokeText");e.closePath();e.restore()},_renderChars:function(g,r,n,h,o,q){var f=this.getHeightOfLine(q),y=this.textAlign.indexOf("justify")!==-1,z,v,j="",k,l=0,m,p=this.path,w=!y&&this.charSpacing===0&&this.isEmptyStyles(q)&&!p,e=this.direction==="ltr",x=this.direction==="ltr"?1:-1,s;r.save();o-=f*this._fontSizeFraction/this.lineHeight;if(w){r.canvas.setAttribute("dir",e?"ltr":"rtl");r.direction=e?"ltr":"rtl";r.textAlign=e?"left":"right";this._renderChar(g,r,q,0,n.join(""),h,o,f);r.restore();return}for(var t=0,u=n.length-1;t<=u;t++){m=t===u||this.charSpacing||p;j+=n[t];k=this.__charBounds[q][t];if(l===0){h+=x*(k.kernedWidth-k.width);l+=k.width}else{l+=k.kernedWidth}if(y&&!m){if(this._reSpaceAndTab.test(n[t])){m=true}}if(!m){z=z||this.getCompleteStyleDeclaration(q,t);v=this.getCompleteStyleDeclaration(q,t+1);m=this._hasStyleChanged(z,v)}if(m){if(p){r.save();r.translate(k.renderLeft,k.renderTop);r.rotate(k.angle);this._renderChar(g,r,q,t,j,-l/2,0,f);r.restore()}else{s=h;r.canvas.setAttribute("dir",e?"ltr":"rtl");r.direction=e?"ltr":"rtl";r.textAlign=e?"left":"right";this._renderChar(g,r,q,t,j,s,o,f)}j="";z=v;h+=x*l;l=0}}r.restore()},_applyPatternGradientTransformText:function(g){var i=b.util.createCanvasElement(),f,h=this.width+this.strokeWidth,e=this.height+this.strokeWidth;i.width=h;i.height=e;f=i.getContext("2d");f.beginPath();f.moveTo(0,0);f.lineTo(h,0);f.lineTo(h,e);f.lineTo(0,e);f.closePath();f.translate(h/2,e/2);f.fillStyle=g.toLive(f);this._applyPatternGradientTransform(f,g);f.fill();return f.createPattern(i,"no-repeat")},handleFiller:function(f,h,g){var e,i;if(g.toLive){if(g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform){e=-this.width/2;i=-this.height/2;f.translate(e,i);f[h]=this._applyPatternGradientTransformText(g);return{offsetX:e,offsetY:i}}else{f[h]=g.toLive(f,this);return this._applyPatternGradientTransform(f,g)}}else{f[h]=g}return{offsetX:0,offsetY:0}},_setStrokeStyles:function(f,e){f.lineWidth=e.strokeWidth;f.lineCap=this.strokeLineCap;f.lineDashOffset=this.strokeDashOffset;f.lineJoin=this.strokeLineJoin;f.miterLimit=this.strokeMiterLimit;return this.handleFiller(f,"strokeStyle",e.stroke)},_setFillStyles:function(f,e){return this.handleFiller(f,"fillStyle",e.fill)},_renderChar:function(e,q,p,f,n,g,k){var l=this._getStyleDeclaration(p,f),o=this.getCompleteStyleDeclaration(p,f),i=e==="fillText"&&o.fill,m=e==="strokeText"&&o.stroke&&o.strokeWidth,j,h;if(!m&&!i){return}q.save();i&&(j=this._setFillStyles(q,o));m&&(h=this._setStrokeStyles(q,o));q.font=this._getFontDeclaration(o);if(l&&l.textBackgroundColor){this._removeShadow(q)}if(l&&l.deltaY){k+=l.deltaY}i&&q.fillText(n,g-j.offsetX,k-j.offsetY);m&&q.strokeText(n,g-h.offsetX,k-h.offsetY);q.restore()},setSuperscript:function(f,e){return this._setScript(f,e,this.superscript)},setSubscript:function(f,e){return this._setScript(f,e,this.subscript)},_setScript:function(k,f,h){var j=this.get2DCursorLocation(k,true),i=this.getValueOfPropertyAt(j.lineIndex,j.charIndex,"fontSize"),e=this.getValueOfPropertyAt(j.lineIndex,j.charIndex,"deltaY"),g={fontSize:i*h.size,deltaY:e+i*h.baseline};this.setSelectionStyles(g,k,f);return this},_hasStyleChanged:function(e,f){return e.fill!==f.fill||e.stroke!==f.stroke||e.strokeWidth!==f.strokeWidth||e.fontSize!==f.fontSize||e.fontFamily!==f.fontFamily||e.fontWeight!==f.fontWeight||e.fontStyle!==f.fontStyle||e.deltaY!==f.deltaY},_hasStyleChangedForSvg:function(e,f){return this._hasStyleChanged(e,f)||e.overline!==f.overline||e.underline!==f.underline||e.linethrough!==f.linethrough},_getLineLeftOffset:function(k){var f=this.getLineWidth(k),e=this.width-f,g=this.textAlign,j=this.direction,h,i=0,h=this.isEndOfWrapping(k);if(g==="justify"||(g==="justify-center"&&!h)||(g==="justify-right"&&!h)||(g==="justify-left"&&!h)){return 0}if(g==="center"){i=e/2}if(g==="right"){i=e}if(g==="justify-center"){i=e/2}if(g==="justify-right"){i=e}if(j==="rtl"){i-=e}return i},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;e||(e=this.hasStateChanged("_dimensionAffectingProps"));if(e){this.dirty=true;this._forceClearCache=false}return e},getLineWidth:function(h){if(this.__lineWidths[h]){return this.__lineWidths[h]}var g,f=this._textLines[h],e;if(f===""){g=0}else{e=this.measureLine(h);g=e.width}this.__lineWidths[h]=g;return g},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.charSpacing/1000}return 0},getValueOfPropertyAt:function(h,g,f){var e=this._getStyleDeclaration(h,g);if(e&&typeof e[f]!=="undefined"){return e[f]}return this[f]},_renderTextDecoration:function(B,h){if(!this[h]&&!this.styleHas(h)){return}var v,y,k,u,s,e,r,g,q=this._getLeftOffset(),C=this._getTopOffset(),x,H,p,o,t,A,l,m,z=this.path,f=this._getWidthOfCharSpacing(),G=this.offsets[h];for(var E=0,F=this._textLines.length;E<F;E++){v=this.getHeightOfLine(E);if(!this[h]&&!this.styleHas(h,E)){C+=v;continue}r=this._textLines[E];A=v/this.lineHeight;u=this._getLineLeftOffset(E);H=0;p=0;g=this.getValueOfPropertyAt(E,0,h);m=this.getValueOfPropertyAt(E,0,"fill");x=C+A*(1-this._fontSizeFraction);y=this.getHeightOfChar(E,0);s=this.getValueOfPropertyAt(E,0,"deltaY");for(var D=0,w=r.length;D<w;D++){o=this.__charBounds[E][D];t=this.getValueOfPropertyAt(E,D,h);l=this.getValueOfPropertyAt(E,D,"fill");k=this.getHeightOfChar(E,D);e=this.getValueOfPropertyAt(E,D,"deltaY");if(z&&t&&l){B.save();B.fillStyle=m;B.translate(o.renderLeft,o.renderTop);B.rotate(o.angle);B.fillRect(-o.kernedWidth/2,G*k+e,o.kernedWidth,this.fontSize/15);B.restore()}else{if((t!==g||l!==m||k!==y||e!==s)&&p>0){var n=q+u+H;if(this.direction==="rtl"){n=this.width-n-p}if(g&&m){B.fillStyle=m;B.fillRect(n,x+G*y+s,p,this.fontSize/15)}H=o.left;p=o.width;g=t;m=l;y=k;s=e}else{p+=o.kernedWidth}}}var n=q+u+H;if(this.direction==="rtl"){n=this.width-n-p}B.fillStyle=l;t&&l&&B.fillRect(n,x+G*y+s,p-f,this.fontSize/15);C+=v}this._removeShadow(B)},_getFontDeclaration:function(f,j){var h=f||this,g=this.fontFamily,i=b.Text.genericFonts.indexOf(g.toLowerCase())>-1;var e=g===undefined||g.indexOf("'")>-1||g.indexOf(",")>-1||g.indexOf('"')>-1||i?h.fontFamily:'"'+h.fontFamily+'"';return[(b.isLikelyNode?h.fontWeight:h.fontStyle),(b.isLikelyNode?h.fontStyle:h.fontWeight),j?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",e].join(" ")},render:function(e){if(!this.visible){return}if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return}if(this._shouldClearDimensionCache()){this.initDimensions()}this.callSuper("render",e)},_splitTextIntoLines:function(j){var e=j.split(this._reNewline),f=new Array(e.length),k=["\n"],h=[];for(var g=0;g<e.length;g++){f[g]=b.util.string.graphemeSplit(e[g]);h=h.concat(f[g],k)}h.pop();return{_unwrappedLines:f,lines:e,graphemeText:h,graphemeLines:f}},toObject:function(g){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing","path","direction",].concat(g);var f=this.callSuper("toObject",e);f.styles=d(this.styles,true);f.path=this.path&&this.path.toObject();return f},set:function(g,i){this.callSuper("set",g,i);var e=false;var f=false;if(typeof g==="object"){for(var h in g){if(h==="path"){this.setPathInfo()}e=e||this._dimensionAffectingProps.indexOf(h)!==-1;f=f||h==="path"}}else{e=this._dimensionAffectingProps.indexOf(g)!==-1;f=g==="path"}if(f){this.setPathInfo()}if(e){this.initDimensions();this.setCoords()}return this},complexity:function(){return 1}});b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" "));b.Text.DEFAULT_SVG_FONT_SIZE=16;b.Text.fromElement=function(e,n,r){if(!e){return n(null)}var k=b.parseAttributes(e,b.Text.ATTRIBUTE_NAMES),o=k.textAnchor||"left";r=b.util.object.extend((r?d(r):{}),k);r.top=r.top||0;r.left=r.left||0;if(k.textDecoration){var q=k.textDecoration;if(q.indexOf("underline")!==-1){r.underline=true}if(q.indexOf("overline")!==-1){r.overline=true}if(q.indexOf("line-through")!==-1){r.linethrough=true}delete r.textDecoration}if("dx" in k){r.left+=k.dx}if("dy" in k){r.top+=k.dy}if(!("fontSize" in r)){r.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE}var g="";if(!("textContent" in e)){if("firstChild" in e&&e.firstChild!==null){if("data" in e.firstChild&&e.firstChild.data!==null){g=e.firstChild.data}}}else{g=e.textContent}g=g.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var p=r.strokeWidth;r.strokeWidth=0;var m=new b.Text(g,r),j=m.getScaledHeight()/m.height,f=(m.height+m.strokeWidth)*m.lineHeight-m.height,h=f*j,i=m.getScaledHeight()+h,l=0;if(o==="center"){l=m.getScaledWidth()/2}if(o==="right"){l=m.getScaledWidth()}m.set({left:m.left-l,top:m.top-(i-m.fontSize*(0.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:typeof p!=="undefined"?p:1,});n(m)};b.Text.fromObject=function(e,h){var f=d(e),g=e.path;delete f.path;return b.Object._fromObject("Text",f,function(i){if(g){b.Object._fromObject("Path",g,function(j){i.set("path",j);h(i)},"path")}else{h(i)}},"text")};b.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"];b.util.createAccessors&&b.util.createAccessors(b.Text)})(typeof exports!=="undefined"?exports:this);(function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(e){if(!this.styles){return true}if(typeof e!=="undefined"&&!this.styles[e]){return true}var c=typeof e==="undefined"?this.styles:{line:this.styles[e]};for(var d in c){for(var b in c[d]){for(var a in c[d][b]){return false}}}return true},styleHas:function(a,e){if(!this.styles||!a||a===""){return false}if(typeof e!=="undefined"&&!this.styles[e]){return false}var c=typeof e==="undefined"?this.styles:{0:this.styles[e]};for(var d in c){for(var b in c[d]){if(typeof c[d][b][a]!=="undefined"){return true}}}return false},cleanStyle:function(h){if(!this.styles||!h||h===""){return false}var b=this.styles,m=0,f,j,l=true,c=0,e;for(var k in b){f=0;for(var g in b[k]){var e=b[k][g],d=e.hasOwnProperty(h);m++;if(d){if(!j){j=e[h]}else{if(e[h]!==j){l=false}}if(e[h]===this[h]){delete e[h]}}else{l=false}if(Object.keys(e).length!==0){f++}else{delete b[k][g]}}if(f===0){delete b[k]}}for(var a=0;a<this._textLines.length;a++){c+=this._textLines[a].length}if(l&&m===c){this[h]=j;this.removeStyle(h)}},removeStyle:function(b){if(!this.styles||!b||b===""){return}var c=this.styles,a,d,e;for(d in c){a=c[d];for(e in a){delete a[e][b];if(Object.keys(a[e]).length===0){delete a[e]}}if(Object.keys(a).length===0){delete c[d]}}},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);if(!this._getLineStyle(c.lineIndex)){this._setLineStyle(c.lineIndex)}if(!this._getStyleDeclaration(c.lineIndex,c.charIndex)){this._setStyleDeclaration(c.lineIndex,c.charIndex,{})}fabric.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),b)},get2DCursorLocation:function(d,e){if(typeof d==="undefined"){d=this.selectionStart}var b=e?this._unwrappedTextLines:this._textLines,a=b.length;for(var c=0;c<a;c++){if(d<=b[c].length){return{lineIndex:c,charIndex:d}}d-=b[c].length+this.missingNewlineOffset(c)}return{lineIndex:c-1,charIndex:b[c-1].length<d?b[c-1].length:d}},getSelectionStyles:function(e,d,a){if(typeof e==="undefined"){e=this.selectionStart||0}if(typeof d==="undefined"){d=this.selectionEnd||e}var c=[];for(var b=e;b<d;b++){c.push(this.getStyleAtPosition(b,a))}return c},getStyleAtPosition:function(a,b){var d=this.get2DCursorLocation(a),c=b?this.getCompleteStyleDeclaration(d.lineIndex,d.charIndex):this._getStyleDeclaration(d.lineIndex,d.charIndex);return c||{}},setSelectionStyles:function(b,d,c){if(typeof d==="undefined"){d=this.selectionStart||0}if(typeof c==="undefined"){c=this.selectionEnd||d}for(var a=d;a<c;a++){this._extendStyles(a,b)}this._forceClearCache=true;return this},_getStyleDeclaration:function(c,b){var a=this.styles&&this.styles[c];if(!a){return null}return a[b]},getCompleteStyleDeclaration:function(e,d){var c=this._getStyleDeclaration(e,d)||{},a={},f;for(var b=0;b<this._styleProperties.length;b++){f=this._styleProperties[b];a[f]=typeof c[f]==="undefined"?this[f]:c[f]}return a},_setStyleDeclaration:function(c,b,a){this.styles[c][b]=a},_deleteStyleDeclaration:function(b,a){delete this.styles[b][a]},_getLineStyle:function(a){return !!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}})})();(function(){function a(b){if(b.textDecoration){b.textDecoration.indexOf("underline")>-1&&(b.underline=true);b.textDecoration.indexOf("line-through")>-1&&(b.linethrough=true);b.textDecoration.indexOf("overline")>-1&&(b.overline=true);delete b.textDecoration}}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:false,editable:true,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1000,cursorDuration:600,caching:true,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,__widthOfSpace:[],inCompositionMode:false,initialize:function(c,b){this.callSuper("initialize",c,b);this.initBehavior()},setSelectionStart:function(b){b=Math.max(b,0);this._updateAndFire("selectionStart",b)},setSelectionEnd:function(b){b=Math.min(b,this.text.length);this._updateAndFire("selectionEnd",b)},_updateAndFire:function(c,b){if(this[c]!==b){this._fireSelectionChanged();this[c]=b}this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper("initDimensions")},render:function(b){this.clearContextTop();this.callSuper("render",b);this.cursorOffsetCache={};this.renderCursorOrSelection()},_render:function(b){this.callSuper("_render",b)},clearContextTop:function(d){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return}var b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(b);this._clearTextArea(b);d||b.restore()},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return}var c=this._getCursorBoundaries(),b=this.canvas.contextTop;this.clearContextTop(true);if(this.selectionStart===this.selectionEnd){this.renderCursor(c,b)}else{this.renderSelection(c,b)}b.restore()},_clearTextArea:function(c){var d=this.width+4,b=this.height+4;c.clearRect(-d/2,-b/2,d,b)},_getCursorBoundaries:function(b){if(typeof b==="undefined"){b=this.selectionStart}var e=this._getLeftOffset(),d=this._getTopOffset(),c=this._getCursorBoundariesOffsets(b);return{left:e,top:d,leftOffset:c.left,topOffset:c.top}},_getCursorBoundariesOffsets:function(k){if(this.cursorOffsetCache&&"top" in this.cursorOffsetCache){return this.cursorOffsetCache}var h,l,b,j=0,d=0,e,c=this.get2DCursorLocation(k);b=c.charIndex;l=c.lineIndex;for(var g=0;g<l;g++){j+=this.getHeightOfLine(g)}h=this._getLineLeftOffset(l);var f=this.__charBounds[l][b];f&&(d=f.left);if(this.charSpacing!==0&&b===this._textLines[l].length){d-=this._getWidthOfCharSpacing()}e={top:j,left:h+(d>0?d:0),};if(this.direction==="rtl"){e.left*=-1}this.cursorOffsetCache=e;return this.cursorOffsetCache},renderCursor:function(c,j){var f=this.get2DCursorLocation(),i=f.lineIndex,b=f.charIndex>0?f.charIndex-1:0,d=this.getValueOfPropertyAt(i,b,"fontSize"),h=this.scaleX*this.canvas.getZoom(),k=this.cursorWidth/h,e=c.topOffset,g=this.getValueOfPropertyAt(i,b,"deltaY");e+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-d*(1-this._fontSizeFraction);if(this.inCompositionMode){this.renderSelection(c,j)}j.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,b,"fill");j.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;j.fillRect(c.left+c.leftOffset-k/2,e+c.top+g,k,d)},renderSelection:function(v,o){var n=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,d=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,w=this.textAlign.indexOf("justify")!==-1,j=this.get2DCursorLocation(n),h=this.get2DCursorLocation(d),p=j.lineIndex,l=h.lineIndex,e=j.charIndex<0?0:j.charIndex,r=h.charIndex<0?0:h.charIndex;for(var q=p;q<=l;q++){var u=this._getLineLeftOffset(q)||0,g=this.getHeightOfLine(q),f=0,x=0,t=0;if(q===p){x=this.__charBounds[p][e].left}if(q>=p&&q<l){t=w&&!this.isEndOfWrapping(q)?this.width:this.getLineWidth(q)||5}else{if(q===l){if(r===0){t=this.__charBounds[l][r].left}else{var b=this._getWidthOfCharSpacing();t=this.__charBounds[l][r-1].left+this.__charBounds[l][r-1].width-b}}}f=g;if(this.lineHeight<1||(q===l&&this.lineHeight>1)){g/=this.lineHeight}var k=v.left+u+x,s=t-x,m=g,c=0;if(this.inCompositionMode){o.fillStyle=this.compositionColor||"black";m=1;c=g}else{o.fillStyle=this.selectionColor}if(this.direction==="rtl"){k=this.width-k-s}o.fillRect(k,v.top+v.topOffset+c,s,m);v.topOffset+=f}},getCurrentCharFontSize:function(){var b=this._getCurrentCharIndex();return this.getValueOfPropertyAt(b.l,b.c,"fontSize")},getCurrentCharColor:function(){var b=this._getCurrentCharIndex();return this.getValueOfPropertyAt(b.l,b.c,"fill")},_getCurrentCharIndex:function(){var b=this.get2DCursorLocation(this.selectionStart,true),c=b.charIndex>0?b.charIndex-1:0;return{l:b.lineIndex,c:c}}});fabric.IText.fromObject=function(c,e){a(c);if(c.styles){for(var d in c.styles){for(var b in c.styles[d]){a(c.styles[d][b])}}}fabric.Object._fromObject("IText",c,e,"text")}})();(function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=false},initAddedHandler:function(){var b=this;this.on("added",function(){var c=b.canvas;if(c){if(!c._hasITextHandlers){c._hasITextHandlers=true;b._initCanvasHandlers(c)}c._iTextInstances=c._iTextInstances||[];c._iTextInstances.push(b)}})},initRemovedHandler:function(){var b=this;this.on("removed",function(){var c=b.canvas;if(c){c._iTextInstances=c._iTextInstances||[];fabric.util.removeFromArray(c._iTextInstances,b);if(c._iTextInstances.length===0){c._hasITextHandlers=false;b._removeCanvasHandlers(c)}}})},_initCanvasHandlers:function(b){b._mouseUpITextHandler=function(){if(b._iTextInstances){b._iTextInstances.forEach(function(c){c.__isMousedown=false})}};b.on("mouse:up",b._mouseUpITextHandler)},_removeCanvasHandlers:function(b){b.off("mouse:up",b._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,c,d,f){var b;b={isAborted:false,abort:function(){this.isAborted=true},};e.animate("_currentCursorOpacity",c,{duration:d,onComplete:function(){if(!b.isAborted){e[f]()}},onChange:function(){if(e.canvas&&e.selectionStart===e.selectionEnd){e.renderCursorOrSelection()}},abort:function(){return b.isAborted}});return b},_onTickComplete:function(){var b=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1)}this._cursorTimeout1=setTimeout(function(){b._currentTickCompleteState=b._animateCursor(b,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(b){var d=this,c=b?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){d._tick()},c)},abortCursorAnimation:function(){var c=this._currentTickState||this._currentTickCompleteState,b=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;if(c&&b){b.clearContext(b.contextTop||b.contextContainer)}},selectAll:function(){this.selectionStart=0;this.selectionEnd=this._text.length;this._fireSelectionChanged();this._updateTextarea();return this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this._text[b])){while(this._reSpace.test(this._text[b])){d++;b--}}while(/\S/.test(this._text[b])&&b>-1){d++;b--}return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this._text[b])){while(this._reSpace.test(this._text[b])){d++;b++}}while(/\S/.test(this._text[b])&&b<this._text.length){d++;b++}return c+d},findLineBoundaryLeft:function(c){var d=0,b=c-1;while(!/\n/.test(this._text[b])&&b>-1){d++;b--}return c-d},findLineBoundaryRight:function(c){var d=0,b=c;while(!/\n/.test(this._text[b])&&b<this._text.length){d++;b++}return c+d},searchWordBoundary:function(e,f){var g=this._text,d=this._reSpace.test(g[e])?e-1:e,c=g[d],b=fabric.reNonWord;while(!b.test(c)&&d>0&&d<g.length){d+=f;c=g[d]}if(b.test(c)){d+=f===1?0:1}return d},selectWord:function(d){d=d||this.selectionStart;var b=this.searchWordBoundary(d,-1),c=this.searchWordBoundary(d,1);this.selectionStart=b;this.selectionEnd=c;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()},selectLine:function(d){d=d||this.selectionStart;var b=this.findLineBoundaryLeft(d),c=this.findLineBoundaryRight(d);this.selectionStart=b;this.selectionEnd=c;this._fireSelectionChanged();this._updateTextarea();return this},enterEditing:function(b){if(this.isEditing||!this.editable){return}if(this.canvas){this.canvas.calcOffset();this.exitEditingOnOthers(this.canvas)}this.isEditing=true;this.initHiddenTextarea(b);this.hiddenTextarea.focus();this.hiddenTextarea.value=this.text;this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire("editing:entered");this._fireSelectionChanged();if(!this.canvas){return this}this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();this.canvas.requestRenderAll();return this},exitEditingOnOthers:function(b){if(b._iTextInstances){b._iTextInstances.forEach(function(c){c.selected=false;if(c.isEditing){c.exitEditing()}})}},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(c){if(!this.__isMousedown||!this.isEditing){return}var b=this.getSelectionStartFromPointer(c.e),e=this.selectionStart,d=this.selectionEnd;if((b!==this.__selectionStartOnMouseDown||e===d)&&(e===b||d===b)){return}if(b>this.__selectionStartOnMouseDown){this.selectionStart=this.__selectionStartOnMouseDown;this.selectionEnd=b}else{this.selectionStart=b;this.selectionEnd=this.__selectionStartOnMouseDown}if(this.selectionStart!==e||this.selectionEnd!==d){this.restartCursorIfNeeded();this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()}},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor="text"}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true},fromStringToGraphemeSelection:function(h,b,f){var d=f.slice(0,h),g=fabric.util.string.graphemeSplit(d).length;if(h===b){return{selectionStart:g,selectionEnd:g}}var e=f.slice(h,b),c=fabric.util.string.graphemeSplit(e).length;return{selectionStart:g,selectionEnd:g+c}},fromGraphemeToStringSelection:function(h,b,e){var d=e.slice(0,h),g=d.join("").length;if(h===b){return{selectionStart:g,selectionEnd:g}}var f=e.slice(h,b),c=f.join("").length;return{selectionStart:g,selectionEnd:g+c}},_updateTextarea:function(){this.cursorOffsetCache={};if(!this.hiddenTextarea){return}if(!this.inCompositionMode){var b=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=b.selectionStart;this.hiddenTextarea.selectionEnd=b.selectionEnd}this.updateTextareaPosition()},updateFromTextArea:function(){if(!this.hiddenTextarea){return}this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=b.selectionEnd;if(!this.inCompositionMode){this.selectionStart=b.selectionStart}this.updateTextareaPosition()},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var b=this._calcTextareaPosition();this.hiddenTextarea.style.left=b.left;this.hiddenTextarea.style.top=b.top}},_calcTextareaPosition:function(){if(!this.canvas){return{x:1,y:1}}var i=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(i),k=this.get2DCursorLocation(i),t=k.lineIndex,b=k.charIndex,f=this.getValueOfPropertyAt(t,b,"fontSize")*this.lineHeight,d=e.leftOffset,g=this.calcTransformMatrix(),c={x:e.left+d,y:e.top+e.topOffset+f},j=this.canvas.getRetinaScaling(),n=this.canvas.upperCanvasEl,s=n.width/j,h=n.height/j,r=s-f,q=h-f,o=n.clientWidth/s,l=n.clientHeight/h;c=fabric.util.transformPoint(c,g);c=fabric.util.transformPoint(c,this.canvas.viewportTransform);c.x*=o;c.y*=l;if(c.x<0){c.x=0}if(c.x>r){c.x=r}if(c.y<0){c.y=0}if(c.y>q){c.y=q}c.x+=this.canvas._offset.left;c.y+=this.canvas._offset.top;return{left:c.x+"px",top:c.y+"px",fontSize:f+"px",charHeight:f}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.hoverCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.selectable=this._savedProps.selectable;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor}},exitEditing:function(){var c=(this._textBeforeEdit!==this.text);var b=this.hiddenTextarea;this.selected=false;this.isEditing=false;this.selectionEnd=this.selectionStart;if(b){b.blur&&b.blur();b.parentNode&&b.parentNode.removeChild(b)}this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}this.fire("editing:exited");c&&this.fire("modified");if(this.canvas){this.canvas.off("mouse:move",this.mouseMoveHandler);this.canvas.fire("text:editing:exited",{target:this});c&&this.canvas.fire("object:modified",{target:this})}return this},_removeExtraneousStyles:function(){for(var b in this.styles){if(!this._textLines[b]){delete this.styles[b]}}},removeStyleFromTo:function(c,e){var n=this.get2DCursorLocation(c,true),o=this.get2DCursorLocation(e,true),h=n.lineIndex,j=n.charIndex,f=o.lineIndex,m=o.charIndex,g,b;if(h!==f){if(this.styles[h]){for(g=j;g<this._unwrappedTextLines[h].length;g++){delete this.styles[h][g]}}if(this.styles[f]){for(g=m;g<this._unwrappedTextLines[f].length;g++){b=this.styles[f][g];if(b){this.styles[h]||(this.styles[h]={});this.styles[h][j+g-m]=b}}}for(g=h+1;g<=f;g++){delete this.styles[g]}this.shiftLineStyles(f,h-f)}else{if(this.styles[h]){b=this.styles[h];var l=m-j,d,k;for(g=j;g<m;g++){delete b[g]}for(k in this.styles[h]){d=parseInt(k,10);if(d>=m){b[d-l]=b[k];delete b[k]}}}}},shiftLineStyles:function(f,e){var d=a(this.styles);for(var b in this.styles){var c=parseInt(b,10);if(c>f){this.styles[c+e]=d[c];if(!d[c-e]){delete this.styles[c]}}}},restartCursorIfNeeded:function(){if(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted){this.initDelayedCursor()}},insertNewlineStyleObject:function(l,b,k,h){var d,i={},g=false,j=this._unwrappedTextLines[l].length===b;k||(k=1);this.shiftLineStyles(l,k);if(this.styles[l]){d=this.styles[l][b===0?b:b-1]}for(var e in this.styles[l]){var f=parseInt(e,10);if(f>=b){g=true;i[f-b]=this.styles[l][e];if(!(j&&b===0)){delete this.styles[l][e]}}}var c=false;if(g&&!j){this.styles[l+k]=i;c=true}if(c){k--}while(k>0){if(h&&h[k-1]){this.styles[l+k]={0:a(h[k-1])}}else{if(d){this.styles[l+k]={0:a(d)}}else{delete this.styles[l+k]}}k--}this._forceClearCache=true},insertCharStyleObject:function(j,b,e,i){if(!this.styles){this.styles={}}var g=this.styles[j],c=g?a(g):{};e||(e=1);for(var h in c){var d=parseInt(h,10);if(d>=b){g[d+e]=c[d];if(!c[d-e]){delete g[d]}}}this._forceClearCache=true;if(i){while(e--){if(!Object.keys(i[e]).length){continue}if(!this.styles[j]){this.styles[j]={}}this.styles[j][b+e]=a(i[e])}return}if(!g){return}var f=g[b?b-1:1];while(f&&e--){this.styles[j][b+e]=a(f)}},insertNewStyleBlock:function(g,h,e){var f=this.get2DCursorLocation(h,true),c=[0],b=0;for(var d=0;d<g.length;d++){if(g[d]==="\n"){b++;c[b]=0}else{c[b]++}}if(c[0]>0){this.insertCharStyleObject(f.lineIndex,f.charIndex,c[0],e);e=e&&e.slice(c[0]+1)}b&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+c[0],b);for(var d=1;d<b;d++){if(c[d]>0){this.insertCharStyleObject(f.lineIndex+d,0,c[d],e)}else{if(e){this.styles[f.lineIndex+d][0]=e[0]}}e=e&&e.slice(c[d]+1)}if(c[d]>0){this.insertCharStyleObject(f.lineIndex+d,0,c[d],e)}},setSelectionStartEndWithShift:function(d,c,b){if(b<=d){if(c===d){this._selectionDirection="left"}else{if(this._selectionDirection==="right"){this._selectionDirection="left";this.selectionEnd=d}}this.selectionStart=b}else{if(b>d&&b<c){if(this._selectionDirection==="right"){this.selectionEnd=b}else{this.selectionStart=b}}else{if(c===d){this._selectionDirection="right"}else{if(this._selectionDirection==="left"){this._selectionDirection="right";this.selectionStart=c}}this.selectionEnd=b}}},setSelectionInBoundaries:function(){var b=this.text.length;if(this.selectionStart>b){this.selectionStart=b}else{if(this.selectionStart<0){this.selectionStart=0}}if(this.selectionEnd>b){this.selectionEnd=b}else{if(this.selectionEnd<0){this.selectionEnd=0}}}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(!this.canvas){return}this.__newClickTime=+new Date();var b=a.pointer;if(this.isTripleClick(b)){this.fire("tripleclick",a);this._stopEvent(a.e)}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=b;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},doubleClickHandler:function(a){if(!this.isEditing){return}this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){if(!this.isEditing){return}this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler);this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){if(!this.canvas||!this.editable||(a.e.button&&a.e.button!==1)){return}this.__isMousedown=true;if(this.selected){this.inCompositionMode=false;this.setCursorByClick(a.e)}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;if(this.selectionStart===this.selectionEnd){this.abortCursorAnimation()}this.renderCursorOrSelection()}},_mouseDownHandlerBefore:function(a){if(!this.canvas||!this.editable||(a.e.button&&a.e.button!==1)){return}this.selected=this===this.canvas._activeObject},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler);this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){this.__isMousedown=false;if(!this.editable||this.group||(a.transform&&a.transform.actionPerformed)||(a.e.button&&a.e.button!==1)){return}if(this.canvas){var b=this.canvas._activeObject;if(b&&b!==this){return}}if(this.__lastSelected&&!this.__corner){this.selected=false;this.__lastSelected=false;this.enterEditing(a.e);if(this.selectionStart===this.selectionEnd){this.initDelayedCursor(true)}else{this.renderCursorOrSelection()}}else{this.selected=true}},setCursorByClick:function(c){var a=this.getSelectionStartFromPointer(c),d=this.selectionStart,b=this.selectionEnd;if(c.shiftKey){this.setSelectionStartEndWithShift(d,b,a)}else{this.selectionStart=a;this.selectionEnd=a}if(this.isEditing){this._fireSelectionChanged();this._updateTextarea()}},getSelectionStartFromPointer:function(k){var f=this.getLocalPointer(k),l=0,b=0,n=0,a=0,o=0,g,p;for(var d=0,h=this._textLines.length;d<h;d++){if(n<=f.y){n+=this.getHeightOfLine(d)*this.scaleY;o=d;if(d>0){a+=this._textLines[d-1].length+this.missingNewlineOffset(d-1)}}else{break}}g=this._getLineLeftOffset(o);b=g*this.scaleX;p=this._textLines[o];if(this.direction==="rtl"){f.x=this.width*this.scaleX-f.x+b}for(var c=0,m=p.length;c<m;c++){l=b;b+=this.__charBounds[o][c].kernedWidth*this.scaleX;if(b<=f.x){a++}else{break}}return this._getNewSelectionStartFromOffset(f,l,b,a,m)},_getNewSelectionStartFromOffset:function(d,g,a,f,i){var e=d.x-g,h=a-d.x,c=h>e||h<0?0:1,b=f+c;if(this.flipX){b=i-b}if(b>this._text.length){b=this._text.length}return b}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.setAttribute("autocorrect","off");this.hiddenTextarea.setAttribute("autocomplete","off");this.hiddenTextarea.setAttribute("spellcheck","false");this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea","");this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+a.fontSize+";";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this));this._clickHandlerInitialized=true}},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown",},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(!this.isEditing){return}var b=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(a.keyCode in b){this[b[a.keyCode]](a)}else{if((a.keyCode in this.ctrlKeysMapDown)&&(a.ctrlKey||a.metaKey)){this[this.ctrlKeysMapDown[a.keyCode]](a)}else{return}}a.stopImmediatePropagation();a.preventDefault();if(a.keyCode>=33&&a.keyCode<=40){this.inCompositionMode=false;this.clearContextTop();this.renderCursorOrSelection()}else{this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=false;return}if((a.keyCode in this.ctrlKeysMapUp)&&(a.ctrlKey||a.metaKey)){this[this.ctrlKeysMapUp[a.keyCode]](a)}else{return}a.stopImmediatePropagation();a.preventDefault();this.canvas&&this.canvas.requestRenderAll()},onInput:function(i){var f=this.fromPaste;this.fromPaste=false;i&&i.stopPropagation();if(!this.isEditing){return}var q=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,a=this._text.length,h=q.length,d,b,j=h-a,o=this.selectionStart,p=this.selectionEnd,n=o!==p,l,m,c;if(this.hiddenTextarea.value===""){this.styles={};this.updateFromTextArea();this.fire("changed");if(this.canvas){this.canvas.fire("text:changed",{target:this});this.canvas.requestRenderAll()}return}var k=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);var g=o>k.selectionStart;if(n){d=this._text.slice(o,p);j+=p-o}else{if(h<a){if(g){d=this._text.slice(p+j,p)}else{d=this._text.slice(o,o-j)}}}b=q.slice(k.selectionEnd-j,k.selectionEnd);if(d&&d.length){if(b.length){l=this.getSelectionStyles(o,o+1,false);l=b.map(function(){return l[0]})}if(n){m=o;c=p}else{if(g){m=p-d.length;c=p}else{m=p;c=p+d.length}}this.removeStyleFromTo(m,c)}if(b.length){if(f&&b.join("")===fabric.copiedText&&!fabric.disableStyleCopyPaste){l=fabric.copiedTextStyle}this.insertNewStyleBlock(b,o,l)}this.updateFromTextArea();this.fire("changed");if(this.canvas){this.canvas.fire("text:changed",{target:this});this.canvas.requestRenderAll()}},onCompositionStart:function(){this.inCompositionMode=true},onCompositionEnd:function(){this.inCompositionMode=false},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart;this.compositionEnd=a.target.selectionEnd;this.updateTextareaPosition()},copy:function(){if(this.selectionStart===this.selectionEnd){return}fabric.copiedText=this.getSelectedText();if(!fabric.disableStyleCopyPaste){fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,true)}else{fabric.copiedTextStyle=null}this._copyDone=true},paste:function(){this.fromPaste=true},_getClipboardData:function(a){return(a&&a.clipboardData)||fabric.window.clipboardData},_getWidthBeforeCursor:function(d,c){var b=this._getLineLeftOffset(d),a;if(c>0){a=this.__charBounds[d][c-1];b+=a.left+a.width}return b},getDownCursorOffset:function(f,i){var d=this._getSelectionForOffset(f,i),g=this.get2DCursorLocation(d),j=g.lineIndex;if(j===this._textLines.length-1||f.metaKey||f.keyCode===34){return this._text.length-d}var a=g.charIndex,c=this._getWidthBeforeCursor(j,a),b=this._getIndexOnLine(j+1,c),h=this._textLines[j].slice(a);return h.length+b+1+this.missingNewlineOffset(j)},_getSelectionForOffset:function(b,a){if(b.shiftKey&&this.selectionStart!==this.selectionEnd&&a){return this.selectionEnd}else{return this.selectionStart}},getUpCursorOffset:function(g,j){var f=this._getSelectionForOffset(g,j),h=this.get2DCursorLocation(f),k=h.lineIndex;if(k===0||g.metaKey||g.keyCode===33){return -f}var a=h.charIndex,c=this._getWidthBeforeCursor(k,a),b=this._getIndexOnLine(k-1,c),d=this._textLines[k].slice(0,a),i=this.missingNewlineOffset(k-1);return -this._textLines[k-1].length+b-d.length+(1-i)},_getIndexOnLine:function(n,b){var o=this._textLines[n],g=this._getLineLeftOffset(n),e=g,m=0,h,i;for(var d=0,l=o.length;d<l;d++){h=this.__charBounds[n][d].width;e+=h;if(e>b){i=true;var a=e-h,k=e,f=Math.abs(a-b),c=Math.abs(k-b);m=c<f?d:(d-1);break}}if(!i){m=o.length-1}return m},moveCursorDown:function(a){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return}this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(c,b){var a="get"+c+"CursorOffset",d=this[a](b,this._selectionDirection==="right");if(b.shiftKey){this.moveCursorWithShift(d)}else{this.moveCursorWithoutShift(d)}if(d!==0){this.setSelectionInBoundaries();this.abortCursorAnimation();this._currentCursorOpacity=1;this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea()}},moveCursorWithShift:function(b){var a=this._selectionDirection==="left"?this.selectionStart+b:this.selectionEnd+b;this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a);return b!==0},moveCursorWithoutShift:function(a){if(a<0){this.selectionStart+=a;this.selectionEnd=this.selectionStart}else{this.selectionEnd+=a;this.selectionStart=this.selectionEnd}return a!==0},moveCursorLeft:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this._moveCursorLeftOrRight("Left",a)},_move:function(c,d,b){var a;if(c.altKey){a=this["findWordBoundary"+b](this[d])}else{if(c.metaKey||c.keyCode===35||c.keyCode===36){a=this["findLineBoundary"+b](this[d])}else{this[d]+=b==="Left"?-1:1;return true}}if(typeof a!==undefined&&this[d]!==a){this[d]=a;return true}},_moveLeft:function(a,b){return this._move(a,b,"Left")},_moveRight:function(a,b){return this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){var b=true;this._selectionDirection="left";if(this.selectionEnd===this.selectionStart&&this.selectionStart!==0){b=this._moveLeft(a,"selectionStart")}this.selectionEnd=this.selectionStart;return b},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd){return this._moveLeft(a,"selectionEnd")}else{if(this.selectionStart!==0){this._selectionDirection="left";return this._moveLeft(a,"selectionStart")}}},moveCursorRight:function(a){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return}this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(c,b){var a="moveCursor"+c+"With";this._currentCursorOpacity=1;if(b.shiftKey){a+="Shift"}else{a+="outShift"}if(this[a](b)){this.abortCursorAnimation();this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea()}},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){return this._moveRight(a,"selectionStart")}else{if(this.selectionEnd!==this._text.length){this._selectionDirection="right";return this._moveRight(a,"selectionEnd")}}},moveCursorRightWithoutShift:function(a){var b=true;this._selectionDirection="right";if(this.selectionStart===this.selectionEnd){b=this._moveRight(a,"selectionStart");this.selectionEnd=this.selectionStart}else{this.selectionStart=this.selectionEnd}return b},removeChars:function(b,a){if(typeof a==="undefined"){a=b+1}this.removeStyleFromTo(b,a);this._text.splice(b,a-b);this.text=this._text.join("");this.set("dirty",true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}this._removeExtraneousStyles()},insertChars:function(d,c,e,b){if(typeof b==="undefined"){b=e}if(b>e){this.removeStyleFromTo(e,b)}var a=fabric.util.string.graphemeSplit(d);this.insertNewStyleBlock(a,e,c);this._text=[].concat(this._text.slice(0,e),a,this._text.slice(b));this.text=this._text.join("");this.set("dirty",true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}this._removeExtraneousStyles()},});(function(){var a=fabric.util.toFixed,b=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var d=this._getSVGLeftTopOffsets(),c=this._getSVGTextAndBg(d.textTop,d.textLeft);return this._wrapSVGTextAndBg(c)},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(),{reviver:c,noStyle:true,withShadow:true})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(c){var d=true,e=this.getSvgTextDecoration(this);return[c.textBgRects.join(""),'\t\t<text xml:space="preserve" ',(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(e?'text-decoration="'+e+'" ':""),'style="',this.getSvgStyles(d),'"',this.addPaintOrder()," >",c.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,f){var k=[],j=[],d=e,g;this._setSVGBg(j);for(var h=0,c=this._textLines.length;h<c;h++){g=this._getLineLeftOffset(h);if(this.textBackgroundColor||this.styleHas("textBackgroundColor",h)){this._setSVGTextLineBg(j,h,f+g,d)}this._setSVGTextLineText(k,h,f+g,d);d+=this.getHeightOfLine(h)}return{textSpans:k,textBgRects:j}},_createTextCharSpan:function(g,j,c,f){var i=g!==g.trim()||g.match(b),h=this.getSvgSpanStyles(j,i),e=h?'style="'+h+'"':"",k=j.deltaY,d="",l=fabric.Object.NUM_FRACTION_DIGITS;if(k){d=' dy="'+a(k,l)+'" '}return['<tspan x="',a(c,l),'" y="',a(f,l),'" ',d,e,">",fabric.util.string.escapeXml(g),"</tspan>"].join("")},_setSVGTextLineText:function(e,p,g,m){var o=this.getHeightOfLine(p),n=this.textAlign.indexOf("justify")!==-1,c,s,k="",r,d,j=0,q=this._textLines[p],f;m+=o*(1-this._fontSizeFraction)/this.lineHeight;for(var h=0,l=q.length-1;h<=l;h++){f=h===l||this.charSpacing;k+=q[h];r=this.__charBounds[p][h];if(j===0){g+=r.kernedWidth-r.width;j+=r.width}else{j+=r.kernedWidth}if(n&&!f){if(this._reSpaceAndTab.test(q[h])){f=true}}if(!f){c=c||this.getCompleteStyleDeclaration(p,h);s=this.getCompleteStyleDeclaration(p,h+1);f=this._hasStyleChangedForSvg(c,s)}if(f){d=this._getStyleDeclaration(p,h)||{};e.push(this._createTextCharSpan(k,d,g,m));k="";c=s;g+=j;j=0}}},_pushTextBgRect:function(g,d,i,h,f,c){var e=fabric.Object.NUM_FRACTION_DIGITS;g.push("\t\t<rect ",this._getFillAttributes(d),' x="',a(i,e),'" y="',a(h,e),'" width="',a(f,e),'" height="',a(c,e),'"></rect>\n')},_setSVGTextLineBg:function(f,k,c,n){var q=this._textLines[k],d=this.getHeightOfLine(k)/this.lineHeight,l=0,m=0,p,h,e=this.getValueOfPropertyAt(k,0,"textBackgroundColor");for(var g=0,o=q.length;g<o;g++){p=this.__charBounds[k][g];h=this.getValueOfPropertyAt(k,g,"textBackgroundColor");if(h!==e){e&&this._pushTextBgRect(f,e,c+m,n,l,d);m=p.left;l=p.width;e=h}else{l+=p.kernedWidth}}h&&this._pushTextBgRect(f,h,c+m,n,l,d)},_getFillAttributes:function(c){var d=(c&&typeof c==="string")?new fabric.Color(c):"";if(!d||!d.getSource()||d.getAlpha()===1){return'fill="'+c+'"'}return'opacity="'+d.getAlpha()+'" fill="'+d.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(f){var e=0,d=0;for(var c=0;c<f;c++){e+=this.getHeightOfLine(c)}d=this.getHeightOfLine(c);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(d){var c=fabric.Object.prototype.getSvgStyles.call(this,d);return c+" white-space: pre;"},})})();(function(a){var b=a.fabric||(a.fabric={});b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:true,noScaleCache:false,_dimensionAffectingProps:b.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:false,initDimensions:function(){if(this.__skipDimension){return}this.isEditing&&this.initDelayedCursor();this.clearContextTop();this._clearCache();this.dynamicMinWidth=0;this._styleMap=this._generateStyleMap(this._splitText());if(this.dynamicMinWidth>this.width){this._set("width",this.dynamicMinWidth)}if(this.textAlign.indexOf("justify")!==-1){this.enlargeSpaces()}this.height=this.calcTextHeight();this.saveState({propertySet:"_dimensionAffectingProps"})},_generateStyleMap:function(c){var h=0,g=0,d=0,f={};for(var e=0;e<c.graphemeLines.length;e++){if(c.graphemeText[d]==="\n"&&e>0){g=0;d++;h++}else{if(!this.splitByGrapheme&&this._reSpaceAndTab.test(c.graphemeText[d])&&e>0){g++;d++}}f[e]={line:h,offset:g};d+=c.graphemeLines[e].length;g+=c.graphemeLines[e].length}return f},styleHas:function(c,e){if(this._styleMap&&!this.isWrapping){var d=this._styleMap[e];if(d){e=d.line}}return b.Text.prototype.styleHas.call(this,c,e)},isEmptyStyles:function(l){if(!this.styles){return true}var d=0,f=l+1,j,e,m=false,c=this._styleMap[l],g=this._styleMap[l+1];if(c){l=c.line;d=c.offset}if(g){f=g.line;m=f===l;j=g.offset}e=typeof l==="undefined"?this.styles:{line:this.styles[l]};for(var k in e){for(var i in e[k]){if(i>=d&&(!m||i<j)){for(var h in e[k][i]){return false}}}}return true},_getStyleDeclaration:function(e,d){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[e];if(!c){return null}e=c.line;d=c.offset+d}return this.callSuper("_getStyleDeclaration",e,d)},_setStyleDeclaration:function(f,e,c){var d=this._styleMap[f];f=d.line;e=d.offset+e;this.styles[f][e]=c},_deleteStyleDeclaration:function(e,d){var c=this._styleMap[e];e=c.line;d=c.offset+d;delete this.styles[e][d]},_getLineStyle:function(d){var c=this._styleMap[d];return !!this.styles[c.line]},_setLineStyle:function(d){var c=this._styleMap[d];this.styles[c.line]={}},_wrapText:function(c,e){var d=[],f;this.isWrapping=true;for(f=0;f<c.length;f++){d=d.concat(this._wrapLine(c[f],f,e))}this.isWrapping=false;return d},_measureWord:function(c,l,k){var d=0,f,e=true;k=k||0;for(var g=0,j=c.length;g<j;g++){var h=this._getGraphemeBox(c[g],l,g+k,f,e);d+=h.kernedWidth;f=c[g]}return d},_wrapLine:function(d,m,p,j){var c=0,t=this.splitByGrapheme,g=[],h=[],l=t?b.util.string.graphemeSplit(d):d.split(this._wordJoiners),s="",f=0,r=t?"":" ",u=0,n=0,k=0,e=true,o=this._getWidthOfCharSpacing(),j=j||0;if(l.length===0){l.push([])}p-=j;for(var q=0;q<l.length;q++){s=t?l[q]:b.util.string.graphemeSplit(l[q]);u=this._measureWord(s,m,f);f+=s.length;c+=n+u-o;if(c>p&&!e){g.push(h);h=[];c=u;e=true}else{c+=o}if(!e&&!t){h.push(r)}h=h.concat(s);n=t?0:this._measureWord([r],m,f);f++;e=false;if(u>k){k=u}}q&&g.push(h);if(k+j>this.dynamicMinWidth){this.dynamicMinWidth=k-o+j}return g},isEndOfWrapping:function(c){if(!this._styleMap[c+1]){return true}if(this._styleMap[c+1].line!==this._styleMap[c].line){return true}return false},missingNewlineOffset:function(c){if(this.splitByGrapheme){return this.isEndOfWrapping(c)?1:0}return 1},_splitTextIntoLines:function(g){var f=b.Text.prototype._splitTextIntoLines.call(this,g),d=this._wrapText(f.lines,this.width),c=new Array(d.length);for(var e=0;e<d.length;e++){c[e]=d[e].join("")}f.lines=c;f.graphemeLines=d;return f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var c={};for(var d in this._styleMap){if(this._textLines[d]){c[this._styleMap[d].line]=1}}for(var d in this.styles){if(!c[d]){delete this.styles[d]}}},toObject:function(c){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(c))}});b.Textbox.fromObject=function(c,d){return b.Object._fromObject("Textbox",c,d,"text")}})(typeof exports!=="undefined"?exports:this);(function(){var e=fabric.controlsUtils,b=e.scaleSkewCursorStyleHandler,f=e.scaleCursorStyleHandler,g=e.scalingEqually,i=e.scalingYOrSkewingX,c=e.scalingXOrSkewingY,a=e.scaleOrSkewActionName,d=fabric.Object.prototype.controls;d.ml=new fabric.Control({x:-0.5,y:0,cursorStyleHandler:b,actionHandler:c,getActionName:a,});d.mr=new fabric.Control({x:0.5,y:0,cursorStyleHandler:b,actionHandler:c,getActionName:a,});d.mb=new fabric.Control({x:0,y:0.5,cursorStyleHandler:b,actionHandler:i,getActionName:a,});d.mt=new fabric.Control({x:0,y:-0.5,cursorStyleHandler:b,actionHandler:i,getActionName:a,});d.tl=new fabric.Control({x:-0.5,y:-0.5,cursorStyleHandler:f,actionHandler:g});d.tr=new fabric.Control({x:0.5,y:-0.5,cursorStyleHandler:f,actionHandler:g});d.bl=new fabric.Control({x:-0.5,y:0.5,cursorStyleHandler:f,actionHandler:g});d.br=new fabric.Control({x:0.5,y:0.5,cursorStyleHandler:f,actionHandler:g});d.mtr=new fabric.Control({x:0,y:-0.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:true,actionName:"rotate",});if(fabric.Textbox){var h=fabric.Textbox.prototype.controls={};h.mtr=d.mtr;h.tr=d.tr;h.br=d.br;h.tl=d.tl;h.bl=d.bl;h.mt=d.mt;h.mb=d.mb;h.mr=new fabric.Control({x:0.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:b,actionName:"resizing",});h.ml=new fabric.Control({x:-0.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:b,actionName:"resizing",})}})();(function(){var d=fabric.StaticCanvas.prototype.__setBgOverlayColor;var i=fabric.StaticCanvas.prototype.__setBgOverlay;var k=fabric.StaticCanvas.prototype._setSVGBgOverlayColor;fabric.util.object.extend(fabric.StaticCanvas.prototype,{backgroundColor:undefined,overlayColor:undefined,__setBgOverlayColor:function(o,m,q,n){if(m&&m.isType&&m.isType("rect")){this[o]=m;m.set(n);q&&q(this[o])}else{var p=this;var l=function(){p[o]=new fabric.Rect(fabric.util.object.extend({width:p.width,height:p.height,fill:p[o],},n));q&&q(p[o])};d.call(this,o,m,l);if(m&&m.colorStops&&!(m instanceof fabric.Gradient)){l()}}return this},setBackgroundColor:function(l,n,m){return this.__setBgOverlayColor("backgroundColor",l,n,m)},setOverlayColor:function(n,m,l){return this.__setBgOverlayColor("overlayColor",n,m,l)},__setBgOverlay:function(n,m,l,p){var o=this;if((n==="backgroundColor"||n==="overlayColor")&&(m&&typeof m==="object"&&m.type==="rect")){fabric.util.enlivenObjects([m],function(q){o[n]=q[0];l[n]=true;p&&p()})}else{i.call(this,n,m,l,p)}},_setSVGBgOverlayColor:function(m,p,l){var o=this[p+"Color"];if(o&&o.isType&&o.isType("rect")){var n=o.excludeFromExport||(this[p]&&this[p].excludeFromExport);if(o&&!n&&o.toSVG){m.push(o.toSVG(l))}}else{k.call(this,m,p,l)}},_renderBackgroundOrOverlay:function(l,o){var p=this[o+"Color"],n=this[o+"Image"],m=this.viewportTransform,q=this[o+"Vpt"];if(!p&&!n){return}if(p||n){l.save();p&&p.render(l);if(q){l.transform(m[0],m[1],m[2],m[3],m[4],m[5])}n&&n.render(l);l.restore()}},});var j=fabric.Object.prototype._set;var h=fabric.Object.prototype.render;var c=fabric.Object.prototype.toObject;var e=fabric.Object.prototype._createBaseSVGMarkup;fabric.util.object.extend(fabric.Object.prototype,{erasable:true,getEraser:function(){return this.clipPath&&this.clipPath.eraser?this.clipPath:undefined},getClipPath:function(){var l=this.getEraser();return l?l._objects[0].clipPath:this.clipPath},setClipPath:function(l){var n=this.getEraser();var m=n?n._objects[0]:this;m.set("clipPath",l);this.set("dirty",true)},_updateEraserDimensions:function(p,l){var r=this.getEraser();if(r){var o=r._objects[0];var s={width:o.width,height:o.height};var n=this._getNonTransformedDimensions();var m=fabric.util.object.extend({width:n.x,height:n.y},p);if(s.width===m.width&&s.height===m.height){return}var q=new fabric.Point((s.width-m.width)/2,(s.height-m.height)/2);r.set(m);r.setPositionByOrigin(new fabric.Point(0,0),"center","center");o.set(m);r.set("dirty",true);if(!l){r.getObjects("path").forEach(function(t){t.setPositionByOrigin(t.getCenterPoint().add(q),"center","center")})}this.setCoords()}},_set:function(l,m){j.call(this,l,m);if(l==="width"||l==="height"){this._updateEraserDimensions()}return this},render:function(l){this._updateEraserDimensions();h.call(this,l)},toObject:function(l){return c.call(this,["erasable"].concat(l))},eraserToSVG:function(m){var p=this.getEraser();if(p){var o=p._objects[0].fill;p._objects[0].fill="white";p.clipPathId="CLIPPATH_"+fabric.Object.__uid++;var n=['id="'+p.clipPathId+'"',].join(" ");var l=["<defs>","<mask "+n+" >",p.toSVG(m.reviver),"</mask>","</defs>"];p._objects[0].fill=o;return l.join("\n")}return""},_createBaseSVGMarkup:function(o,n){var p=this.getEraser();if(p){var m=this.eraserToSVG(n);this.clipPath=null;var l=e.call(this,o,n);this.clipPath=p;return[m,l.replace(">",'mask="url(#'+p.clipPathId+')" >')].join("\n")}else{return e.call(this,o,n)}}});var a=fabric.Group.prototype._restoreObjectsState;var b=fabric.Group.prototype.toObject;var g=fabric.Group.prototype._getBounds;fabric.util.object.extend(fabric.Group.prototype,{_getBounds:function(m,l,n){if(this.eraser){this.width=this._objects[0].width;this.height=this._objects[0].height;return}g.call(this,m,l,n)},_addEraserPathToObjects:function(l){this._objects.forEach(function(m){fabric.EraserBrush.prototype._addPathToObjectEraser.call(fabric.EraserBrush.prototype,m,l)})},applyEraserToObjects:function(){var m=this;if(this.getEraser()){var l=m.calcTransformMatrix();m.getEraser().clone(function(o){var n=o._objects[0].clipPath;m.clipPath=n?n:undefined;o.getObjects("path").forEach(function(q){var p=fabric.util.multiplyTransformMatrices(l,q.calcTransformMatrix());fabric.util.applyTransformToObject(q,p);if(n){n.clone(function(r){fabric.EraserBrush.prototype.applyClipPathToPath.call(fabric.EraserBrush.prototype,q,r,l);m._addEraserPathToObjects(q)})}else{m._addEraserPathToObjects(q)}})})}},_restoreObjectsState:function(){this.erasable===true&&this.applyEraserToObjects();return a.call(this)},toObject:function(l){return b.call(this,["eraser"].concat(l))}});var f=fabric.Canvas.prototype._onResize;fabric.util.object.extend(fabric.Canvas.prototype,{isErasing:function(){return(this.isDrawingMode&&this.freeDrawingBrush&&this.freeDrawingBrush.type==="eraser"&&this.freeDrawingBrush._isErasing)},_onResize:function(){f.call(this);var l={width:this.width,height:this.height};var m=false;if(typeof this.backgroundColor==="object"&&this.backgroundColor.getEraser){this.backgroundColor.set(l);m=true}if(typeof this.overlayColor==="object"&&this.overlayColor.getEraser){this.overlayColor.set(l);m=true}m&&this.requestRenderAll()},renderAll:function(){if(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop);this.contextTopDirty=false}if(this.isErasing()){this.freeDrawingBrush._render();return}if(this.hasLostContext){this.renderTopLayer(this.contextTop)}var l=this.contextContainer;this.renderCanvas(l,this._chooseObjectsToRender());return this}});fabric.EraserBrush=fabric.util.createClass(fabric.PencilBrush,{type:"eraser",_ready:false,_drawOverlayOnTop:false,_isErasing:false,initialize:function(l){this.callSuper("initialize",l);this._renderBound=this._render.bind(this);this.render=this.render.bind(this)},hideObject:function(l){if(l){l._originalOpacity=l.opacity;l.set({opacity:0})}},restoreObjectVisibility:function(l){if(l&&l._originalOpacity){l.set({opacity:l._originalOpacity});l._originalOpacity=undefined}},_isErasable:function(l){return l.erasable!==false},prepareCanvasBackgroundForLayer:function(n){if(n==="overlay"){return}var m=this.canvas;var p=m.get("backgroundImage");var l=m.get("backgroundColor");var o=n==="top";if(p&&this._isErasable(p)===!o){this.hideObject(p)}if(l&&this._isErasable(l)===!o){this.hideObject(l)}},prepareCanvasOverlayForLayer:function(n){var m=this.canvas;var q=m.get("overlayImage");var l=m.get("overlayColor");if(n==="bottom"){this.hideObject(q);this.hideObject(l);return false}var o=n==="top";var p=(q&&!this._isErasable(q))||(l&&!this._isErasable(l));if(q&&this._isErasable(q)===!o){this.hideObject(q)}if(l&&this._isErasable(l)===!o){this.hideObject(l)}return p},restoreCanvasDrawables:function(){var l=this.canvas;this.restoreObjectVisibility(l.get("backgroundImage"));this.restoreObjectVisibility(l.get("backgroundColor"));this.restoreObjectVisibility(l.get("overlayImage"));this.restoreObjectVisibility(l.get("overlayColor"))},prepareCollectionTraversal:function(l){var m=this;l.forEachObject(function(n){if(n.forEachObject&&n.erasable==="deep"){m.prepareCollectionTraversal(n)}else{if(n.erasable){m.hideObject(n)}}})},restoreCollectionTraversal:function(l){var m=this;l.forEachObject(function(n){if(n.forEachObject&&n.erasable==="deep"){m.restoreCollectionTraversal(n)}else{m.restoreObjectVisibility(n)}})},prepareCanvasObjectsForLayer:function(l){if(l!=="bottom"){return}this.prepareCollectionTraversal(this.canvas)},restoreCanvasObjectsFromLayer:function(l){if(l!=="bottom"){return}this.restoreCollectionTraversal(this.canvas)},prepareCanvasForLayer:function(l){this.prepareCanvasBackgroundForLayer(l);this.prepareCanvasObjectsForLayer(l);return this.prepareCanvasOverlayForLayer(l)},restoreCanvasFromLayer:function(l){this.restoreCanvasDrawables();this.restoreCanvasObjectsFromLayer(l)},renderBottomLayer:function(){var l=this.canvas;this.prepareCanvasForLayer("bottom");l.renderCanvas(l.getContext(),l.getObjects().filter(function(m){return !m.erasable||m.forEachObject}));this.restoreCanvasFromLayer("bottom")},renderTopLayer:function(){var l=this.canvas;this._drawOverlayOnTop=this.prepareCanvasForLayer("top");l.renderCanvas(l.contextTop,l.getObjects());this.callSuper("_render");this.restoreCanvasFromLayer("top")},renderOverlay:function(){this.prepareCanvasForLayer("overlay");var m=this.canvas;var l=m.contextTop;this._saveAndTransform(l);m._renderOverlay(l);l.restore();this.restoreCanvasFromLayer("overlay")},_saveAndTransform:function(l){this.callSuper("_saveAndTransform",l);l.globalCompositeOperation="destination-out"},needsFullRender:function(){return this.callSuper("needsFullRender")||this._drawOverlayOnTop},onMouseDown:function(m,l){if(!this.canvas._isMainEvent(l.e)){return}this._prepareForDrawing(m);this._captureDrawingPath(m);this._isErasing=true;this.canvas.fire("erasing:start");this._ready=true;this._render()},_render:function(){if(!this._ready){return}this.isRendering=1;this.renderBottomLayer();this.renderTopLayer();this.renderOverlay();this.isRendering=0},render:function(){if(this._isErasing){if(this.isRendering){this.isRendering=fabric.util.requestAnimFrame(this._renderBound)}else{this._render()}return true}return false},applyClipPathToPath:function(p,n,o){var q=p.calcTransformMatrix();var l=n.calcTransformMatrix();var m=fabric.util.multiplyTransformMatrices(fabric.util.invertTransform(q),o);fabric.util.applyTransformToObject(n,fabric.util.multiplyTransformMatrices(m,l));p.clipPath=n;return p},clonePathWithClipPath:function(o,l,q){var m=l.calcTransformMatrix();var n=l.getClipPath();var p=this;o.clone(function(r){n.clone(function(s){q(p.applyClipPathToPath(r,s,m))})})},_addPathToObjectEraser:function(p,o){var r;var q=this;if(p.forEachObject&&p.erasable==="deep"){var l=p._objects.filter(function(s){return s.erasable});if(l.length>0&&p.clipPath){this.clonePathWithClipPath(o,p,function(s){l.forEach(function(t){q._addPathToObjectEraser(t,s)})})}else{if(l.length>0){l.forEach(function(s){q._addPathToObjectEraser(s,o)})}}return}if(!p.getEraser()){var m=p._getNonTransformedDimensions();var n=new fabric.Rect({width:m.x,height:m.y,clipPath:p.clipPath,originX:"center",originY:"center"});r=new fabric.Group([n],{eraser:true})}else{r=p.clipPath}o.clone(function(s){s.globalCompositeOperation="destination-out";var t=fabric.util.multiplyTransformMatrices(fabric.util.invertTransform(p.calcTransformMatrix()),s.calcTransformMatrix());fabric.util.applyTransformToObject(s,t);r.addWithUpdate(s);p.set({clipPath:r,dirty:true})})},applyEraserToCanvas:function(n){var m=this.canvas;var l={};["backgroundImage","backgroundColor","overlayImage","overlayColor",].forEach(function(p){var o=m[p];if(o&&o.erasable){this._addPathToObjectEraser(o,n);l[p]=o}},this);return l},_finalizeAndAddPath:function(){var n=this.canvas.contextTop,o=this.canvas;n.closePath();if(this.decimate){this._points=this.decimatePoints(this._points,this.decimate)}o.clearContext(o.contextTop);this._isErasing=false;var q=this._points&&this._points.length>1?this.convertPointsToSVGPath(this._points):null;if(!q||this._isEmptySVGPath(q)){o.fire("erasing:end");o.requestRenderAll();return}var p=this.createPath(q);o.fire("before:path:created",{path:p});var l=this.applyEraserToCanvas(p);var r=this;var m=[];o.forEachObject(function(s){if(s.erasable&&s.intersectsWithObject(p,true)){r._addPathToObjectEraser(s,p);m.push(s)}});o.fire("erasing:end",{path:p,targets:m,drawables:l});o.requestRenderAll();p.setCoords();this._resetShadow();o.fire("path:created",{path:p})}})})();