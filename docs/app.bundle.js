!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e){function n(t,e,n){var i,s,a,o,r;function c(){var l=Date.now()-o;l<e&&l>=0?i=setTimeout(c,e-l):(i=null,n||(r=t.apply(a,s),a=s=null))}null==e&&(e=100);var l=function(){a=this,s=arguments,o=Date.now();var l=n&&!i;return i||(i=setTimeout(c,e)),l&&(r=t.apply(a,s),a=s=null),r};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(r=t.apply(a,s),a=s=null,clearTimeout(i),i=null)},l}n.debounce=n,t.exports=n},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o}));var i=n(4),s=n(5);const a=e=>{const n=e.$canvas;var i=t("#save-canvas"),s=t("#refresh-canvas"),a=t("#zoom-100"),o=t("#show-svg"),r=t("#clear-canvas"),c=t("#undo"),l=t("#redo");c.on("click",()=>{n.undo()}),l.on("click",()=>{n.redo()}),r.on("click",()=>{console.log("cE-oC"),n.clear()}),i.on("click",()=>{console.log("sC-oC");const t=n.toJSON();console.log("Canvas JSON",t);const i={width:e.width,height:e.height,lastScale:e.lastScale,canvas:t};localStorage.setItem("infiniteCanvas",JSON.stringify(i))}),s.on("click",()=>{console.log("rC-oC");const t=JSON.parse(localStorage.getItem("infiniteCanvas")||"");console.log("rcoc, inf",t),n.loadFromJSON(t.canvas,()=>{e.width=e.scaledWidth=t.width,e.height=e.scaledHeight=t.height,e.lastScale=t.lastScale,n.setWidth(t.width),n.setHeight(t.height),e.$canvasContainer.width(t.width).height(t.height),n.renderAll()})}),a.on("click",()=>{console.log("zoom100"),e.resetZoom(),n.renderAll()}),o.on("click",()=>{console.log("showSVG");const n=e.$canvas.toSVG();t("#svgImage").html(""+n)}),t("#enlarge-left").on("click",()=>{const n=parseInt(t("#enlargeValue").val(),10);e.$canvas.transformCanvas("left",n)}),t("#enlarge-top").on("click",()=>{const n=parseInt(t("#enlargeValue").val(),10);e.$canvas.transformCanvas("top",n)}),t("#enlarge-right").on("click",()=>{const n=parseInt(t("#enlargeValue").val(),10);e.$canvas.transformCanvas("right",n)}),t("#enlarge-bottom").on("click",()=>{const n=parseInt(t("#enlargeValue").val(),10);e.$canvas.transformCanvas("bottom",n)})},o=e=>{t("#pen-1").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="black",e.freeDrawingBrush.width=2,e.isDrawingMode=!0}),t("#pen-2").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="red",e.freeDrawingBrush.width=2,e.isDrawingMode=!0}),t("#pen-3").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="green",e.freeDrawingBrush.width=2,e.isDrawingMode=!0}),t("#pen-4").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="blue",e.freeDrawingBrush.width=2,e.isDrawingMode=!0}),t("#marker-1").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="rgba(255, 255, 0, 0.5)",e.freeDrawingBrush.width=10,e.isDrawingMode=!0}),t("#marker-2").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="rgba(241,229,170, 0.5)",e.freeDrawingBrush.width=10,e.isDrawingMode=!0}),t("#marker-3").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="rgba(51,204,0, 0.5)",e.freeDrawingBrush.width=10,e.isDrawingMode=!0}),t("#marker-4").on("click",()=>{e.freeDrawingBrush=new fabric.PencilBrush(e),e.freeDrawingBrush.color="rgba(75,141,242, 0.5)",e.freeDrawingBrush.width=10,e.isDrawingMode=!0}),t("#eraser").on("click",()=>{const{EraserBrush:t}=Object(i.a)(fabric),n=new t(e);n.width=10,n.color="rgb(236,195,195)",e.freeDrawingBrush=n,e.isDrawingMode=!0}),t("#eraser-path").on("click",()=>{const{EraserBrushPath:t}=Object(s.a)(fabric),n=new t(e);n.width=8,n.color="rgba(236,195,220, 20)",e.freeDrawingBrush=n,e.isDrawingMode=!0}),t("#text-1").on("click",()=>{e.add(new fabric.IText("Tap and Type",{fontFamily:"arial black",left:100,top:100})),e.isDrawingMode=!1})}}).call(this,n(2))},function(t,e){t.exports=jQuery},function(t,e,n){(function(e){var n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,r="object"==typeof e&&e&&e.Object===Object&&e,c="object"==typeof self&&self&&self.Object===Object&&self,l=r||c||Function("return this")(),h=Object.prototype.toString,d=Math.max,u=Math.min,g=function(){return l.Date.now()};function f(t,e,n){var i,s,a,o,r,c,l=0,h=!1,f=!1,w=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function b(e){var n=i,a=s;return i=s=void 0,l=e,o=t.apply(a,n)}function m(t){return l=t,r=setTimeout(C,e),h?b(t):o}function P(t){var n=t-c;return void 0===c||n>=e||n<0||f&&t-l>=a}function C(){var t=g();if(P(t))return D(t);r=setTimeout(C,function(t){var n=e-(t-c);return f?u(n,a-(t-l)):n}(t))}function D(t){return r=void 0,w&&i?b(t):(i=s=void 0,o)}function B(){var t=g(),n=P(t);if(i=arguments,s=this,c=t,n){if(void 0===r)return m(c);if(f)return r=setTimeout(C,e),b(c)}return void 0===r&&(r=setTimeout(C,e)),o}return e=v(e)||0,p(n)&&(h=!!n.leading,a=(f="maxWait"in n)?d(v(n.maxWait)||0,e):a,w="trailing"in n?!!n.trailing:w),B.cancel=function(){void 0!==r&&clearTimeout(r),l=0,i=c=s=r=void 0},B.flush=function(){return void 0===r?o:D(g())},B}function p(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function v(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==h.call(t)}(t))return NaN;if(p(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=p(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(n,"");var r=s.test(t);return r||a.test(t)?o(t.slice(2),r?2:8):i.test(t)?NaN:+t}t.exports=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return p(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),f(t,e,{leading:i,maxWait:e,trailing:s})}}).call(this,n(7))},function(t,e,n){"use strict";e.a=t=>{const e=t.util.createClass(t.Group,{original:null,erasedPath:null,initialize:function(t,e,n,i){this.original=t,this.erasedPath=e,this.callSuper("initialize",[this.original,this.erasedPath],n,i)},_calcBounds:function(t){const e=[],n=[],i=["tr","br","bl","tl"],s=i.length;let a=this.original;a.setCoords(!0);for(let t=0;t<s;t++){const s=i[t];e.push(a.oCoords[s].x),n.push(a.oCoords[s].y)}console.log("_calcBounds",e,n,i,s,t),this._getBounds(e,n,t)}}),n=t.util.createClass(t.PencilBrush,{_finalizeAndAddPath:async function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var n=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===n)return void this.canvas.requestRenderAll();var s=this.createPath(n);s.globalCompositeOperation="destination-out",s.selectable=!1,s.evented=!1,s.absolutePositioned=!0;const a=this.canvas.getObjects().filter(e=>!(e instanceof t.Textbox)&&(!(e instanceof t.Text)&&(!(e instanceof t.IText)&&!!e.intersectsWithObject(s,!0))));for(const t of a){const n=_.cloneDeep(s),a=new e(t,n),o=a.toDataURL({withoutTransform:!0}),r=await i(o);console.log(n,a,"fabricimage",r),console.image(o),r.set({left:a.left,top:a.top}),this.canvas.remove(t),this.canvas.add(r)}this.canvas.renderAll(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow()}}),i=(e,n)=>new Promise(i=>{t.Image.fromURL(e,i,n)});return{EraserBrush:n,ErasedGroup:e}}},function(t,e,n){"use strict";e.a=t=>({EraserBrushPath:t.util.createClass(t.PencilBrush,{_finalizeAndAddPath:async function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===e)return void this.canvas.requestRenderAll();var n=this.createPath(e);n.globalCompositeOperation="destination-out",n.selectable=!1,n.evented=!1,n.absolutePositioned=!0;const i=this.canvas.getObjects().filter(e=>!(e instanceof t.Textbox)&&(!(e instanceof t.Text)&&(!(e instanceof t.IText)&&!!e.intersectsWithObject(n,!0))));for(const t of i)this.canvas.remove(t);this.canvas.renderAll(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow()}})})},function(t,e,n){"use strict";n.r(e),function(t){var e=n(3),i=n.n(e),s=n(0),a=n.n(s),o=n(1);class r{constructor(t,e,n){this.$canvas=t,this.$canvasContainer=n,this.$parent=e,this.isDragging,this.selection,this.lastPosX,this.lastPosY,this.startPosX=0,this.startPosY=0,this.numberOfPanEvents,this.lastScale=1,this.fonts=["Times New Roman","Arial","Verdana","Calibri","Consolas","Comic Sans MS"],this.width=this.scaledWidth=1500,this.height=this.scaledHeight=1500,this.state={IDLE:"idle",INTERACTING:"interacting",DRAGGING:"dragging",PANNING:"panning",SELECTING:"selecting",PINCH_ZOOMING:"pinch_zooming",SELECTED:"selected,"},this.handlePointerEventBefore=this.handlePointerEventBefore.bind(this),this.resizeCanvas=this.resizeCanvas.bind(this),this.handlePinch=this.handlePinch.bind(this),this.handlePinchEnd=this.handlePinchEnd.bind(this),this.handlePanStart=this.handlePanStart.bind(this),this.handlePanning=this.handlePanning.bind(this),this.handlePanEnd=this.handlePanEnd.bind(this),this.transformCanvas=this.transformCanvas.bind(this),this.resetZoom=this.resetZoom.bind(this)}initFabric(){const t=this.$canvas.get(0);this.canvasElement=t;const e=new fabric.Canvas(t,{isDrawingMode:!0,allowTouchScrolling:!0});this.$canvas=e,fabric.Object.prototype.transparentCorners=!1,this.addDemoContent(e),this.addBg(e),Object(o.a)(this),Object(o.b)(e),e.on("mouse:down:before",this.handlePointerEventBefore);var n=new Hammer.Manager(e.upperCanvasEl),s=new Hammer.Pinch,r=new Hammer.Pan;return n.add([s,r]),n.on("pinchmove",i()(this.handlePinch,20)),n.on("pinchend",a()(this.handlePinchEnd,200)),n.on("panstart",this.handlePanStart),n.on("pan",this.handlePanning),n.on("panend",this.handlePanEnd),e.transformCanvas=this.transformCanvas,e}transformCanvas(t,e){const n=this.$canvas,i=n.getObjects();for(let s=0;s<i.length;s++){const i=n.item(s).setCoords();console.log("tc, item",i),"top"===t&&(i.top=i.top+e),"left"===t&&(i.left=i.left+e)}this.resetZoom();let s=this.scaledWidth,a=this.scaledHeight;"top"===t||"bottom"===t?a=this.scaledHeight+e:"left"!==t&&"right"!==t||(s=this.scaledWidth+e),this.scaledWidth=this.width=s,this.scaledHeight=this.height=a,n.setWidth(s),n.setHeight(a),this.$canvasContainer.width(s).height(a),n.renderAll(),console.log("called tc",t,e)}resetZoom(){const t=this.$canvas;t.setZoom(1),t.setWidth(this.width),t.setHeight(this.height),this.scaledWidth=this.width,this.scaledHeight=this.height,this.lastScale=1,this.$canvasContainer.width(this.width).height(this.height)}addDemoContent(t){var e=new fabric.Text("I'm in Comic Sans",{fontFamily:"Comic Sans MS",left:100,top:100});t.add(e);var n=new fabric.Line([30,30,150,210],{fill:"green",stroke:"blue",strokeWidth:5,selectable:!1,evented:!1});t.add(n)}addBg(t){var e=new fabric.Rect({width:1500,height:1500,stroke:"Fuchsia",strokeWidth:10,fill:"",evented:!1,selectable:!1});e.fill=new fabric.Pattern({source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAASElEQVQ4y2NkYGD4z0A6+M3AwMBKrGJWBgYGZiibEQ0zIInDaCaoelYyHYcX/GeitomjBo4aOGrgQBj4b7RwGFwGsjAwMDAAAD2/BjgezgsZAAAAAElFTkSuQmCC"},(function(){e.dirty=!0,t.requestRenderAll()})),e.canvas=t,t.backgroundImage=e}handlePointerEventBefore(t){const e=this.$canvas;console.log("mdb",t,t.e),"touch"===this.recognizeInput(t.e)?(console.log("mdb touch"),e.isDrawingMode=!1,e.selection=!1,t.target&&e&&e.deactivateAll().renderAll()):"pen"===this.recognizeInput(t.e)?(console.log("mdb pen"),e.isDrawingMode=!0):(console.log("mdb mouse"),console.log("DRAW mouse intention"))}handlePinch(t){console.log("hp",t);const e=this.$canvas;console.log("pinch",t,"pinchingi scale",this.lastScale,t.scale);let n=null;n=new fabric.Point(0,0),e.zoomToPoint(n,this.lastScale*t.scale)}handlePinchEnd(t){const e=this.$canvas;console.log("hpe",t),this.lastScale=this.lastScale*t.scale,console.log("pinchend",this.lastScale,t.scale,t),this.scaledWidth=this.scaledWidth*t.scale,this.scaledHeight=this.scaledHeight*t.scale,e.setWidth(this.scaledWidth),e.setHeight(this.scaledHeight),this.$canvasContainer.width(this.scaledWidth).height(this.scaledHeight)}handlePanStart(e){const n=this.$canvas;if(console.log("panstart",e),"touch"===e.pointerType){n.isDrawingMode=!1,n.isDragging=!0,n.selection=!1,this.selection=!1;var i=t("#parentContainer").get(0);this.startPosX=i.scrollLeft,this.startPosY=i.scrollTop}}handlePanning(e){const n=this.$canvas;if(console.log("panning",e),"touch"===e.pointerType&&(console.log("pan",e),n.isDragging)){const s=1,a=this.startPosX-e.deltaX*s,o=this.startPosY-e.deltaY*s;var i=t("#parentContainer");i.scrollLeft(a),i.scrollTop(o),n.requestRenderAll()}}async handlePanEnd(e){const n=this.$canvas;if(console.log("panend",e),"touch"===e.pointerType){n.isDragging=!1,n.selection=!0;var i=t("#parentContainer").get(0);this.startPosX=i.scrollLeft,this.startPosY=i.scrollTop}}recognizeInput(t){if(console.log("recognizeInput Touchevent",t),!t.touches)return console.log("recognizeInput","mouse"),"mouse";if(t.touches.length>1)return console.log("recognizeInput","touch"),"touch";if(1===t.touches.length){const e=t.touches[0]||{};return console.log("recognizeInput Touchevent",e),.5===e.radiusX&&.5===e.radiusY?(console.log("recognizeInput","pen"),"pen"):(console.log("recognizeInput","touch"),"touch")}}resizeCanvas(){const t=this.$canvas,e=this.$parent.width(),n=this.$parent.height();console.log(`setting canvas to ${e} x ${n}px`),t.setWidth(1500),t.setHeight(1500),t.renderAll()}}setTimeout(()=>{const e=new r(t(".canvasElement"),t("#parentContainer"),t("#canvasContainer")),n=e.initFabric();n.setWidth(e.width),n.setHeight(e.height),n.on("after:render",a()((function(){console.log("after:render outside")}),1e3)),window.fabric=fabric,window.myCanvas=n},1e3)}.call(this,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}]);